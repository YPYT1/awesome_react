# åˆæˆäº‹ä»¶ç³»ç»Ÿ

## å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬ç« å­¦ä¹ ï¼Œä½ å°†æ·±å…¥ç†è§£ï¼š

- Reactåˆæˆäº‹ä»¶ç³»ç»Ÿçš„åŸç†
- åˆæˆäº‹ä»¶ä¸åŸç”Ÿäº‹ä»¶çš„åŒºåˆ«
- äº‹ä»¶æ± æœºåˆ¶ï¼ˆReact 17å‰ï¼‰
- äº‹ä»¶å§”æ‰˜çš„å®ç°åŸç†
- æ•è·å’Œå†’æ³¡é˜¶æ®µ
- åŸç”Ÿäº‹ä»¶ä¸Reactäº‹ä»¶çš„æ··ç”¨
- React 19çš„äº‹ä»¶ç³»ç»Ÿä¼˜åŒ–

## ç¬¬ä¸€éƒ¨åˆ†ï¼šåˆæˆäº‹ä»¶ç³»ç»Ÿæ¦‚è¿°

### 1.1 ä»€ä¹ˆæ˜¯åˆæˆäº‹ä»¶

åˆæˆäº‹ä»¶ï¼ˆSyntheticEventï¼‰æ˜¯Reactå¯¹æµè§ˆå™¨åŸç”Ÿäº‹ä»¶çš„è·¨æµè§ˆå™¨åŒ…è£…å™¨ã€‚

#### åˆæˆäº‹ä»¶çš„ä¼˜åŠ¿

```jsx
// åŸç”Ÿäº‹ä»¶çš„é—®é¢˜
// 1. æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜
element.addEventListener('click', (e) => {
  e.stopPropagation();  // æŸäº›æ—§æµè§ˆå™¨å¯èƒ½ä¸æ”¯æŒ
});

// 2. äº‹ä»¶å¯¹è±¡å±æ€§ä¸ä¸€è‡´
// IE: window.event
// ç°ä»£æµè§ˆå™¨: å‚æ•°ä¼ é€’

// Reactåˆæˆäº‹ä»¶çš„ä¼˜åŠ¿
function SyntheticEventAdvantages() {
  const handleClick = (e) => {
    // 1. è·¨æµè§ˆå™¨ä¸€è‡´çš„API
    e.stopPropagation();  // æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒ
    
    // 2. ç»Ÿä¸€çš„äº‹ä»¶å¯¹è±¡å±æ€§
    console.log(e.target);
    console.log(e.currentTarget);
    
    // 3. æ€§èƒ½ä¼˜åŒ–ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰
    // 4. ä¸Reactç”Ÿæ€é›†æˆ
  };
  
  return <button onClick={handleClick}>ç‚¹å‡»</button>;
}
```

### 1.2 åˆæˆäº‹ä»¶çš„ç»“æ„

```jsx
function SyntheticEventStructure() {
  const handleClick = (e) => {
    console.log('åˆæˆäº‹ä»¶å¯¹è±¡:', e);
    
    // åˆæˆäº‹ä»¶çš„å±æ€§
    console.log('bubbles:', e.bubbles);
    console.log('cancelable:', e.cancelable);
    console.log('currentTarget:', e.currentTarget);
    console.log('defaultPrevented:', e.defaultPrevented);
    console.log('eventPhase:', e.eventPhase);
    console.log('isTrusted:', e.isTrusted);
    console.log('nativeEvent:', e.nativeEvent);  // åŸç”Ÿäº‹ä»¶å¯¹è±¡
    console.log('target:', e.target);
    console.log('timeStamp:', e.timeStamp);
    console.log('type:', e.type);
    
    // æ–¹æ³•
    e.preventDefault();
    e.stopPropagation();
    e.persist();  // React 17+å·²åºŸå¼ƒ
    
    // è®¿é—®åŸç”Ÿäº‹ä»¶
    console.log('åŸç”Ÿäº‹ä»¶:', e.nativeEvent);
  };
  
  return <button onClick={handleClick}>æŸ¥çœ‹åˆæˆäº‹ä»¶</button>;
}
```

### 1.3 åˆæˆäº‹ä»¶vsåŸç”Ÿäº‹ä»¶

```jsx
function SyntheticVsNative() {
  const buttonRef = useRef(null);
  
  useEffect(() => {
    const button = buttonRef.current;
    
    // åŸç”Ÿäº‹ä»¶ç›‘å¬
    const nativeHandler = (e) => {
      console.log('åŸç”Ÿäº‹ä»¶:', e);
      console.log('æ˜¯åŸç”ŸEventå¯¹è±¡:', e instanceof Event);
    };
    
    button.addEventListener('click', nativeHandler);
    
    return () => {
      button.removeEventListener('click', nativeHandler);
    };
  }, []);
  
  // Reactåˆæˆäº‹ä»¶
  const handleClick = (e) => {
    console.log('åˆæˆäº‹ä»¶:', e);
    console.log('æ˜¯åˆæˆEventå¯¹è±¡:', e instanceof Event);  // false
    console.log('æœ‰nativeEvent:', e.nativeEvent instanceof Event);  // true
  };
  
  return <button ref={buttonRef} onClick={handleClick}>ç‚¹å‡»æµ‹è¯•</button>;
}

// å¯¹æ¯”æ€»ç»“
/*
åŸç”Ÿäº‹ä»¶:
- æµè§ˆå™¨åŸç”ŸEventå¯¹è±¡
- å¯èƒ½æœ‰å…¼å®¹æ€§é—®é¢˜
- ç›´æ¥æ“ä½œDOM
- æ¯ä¸ªå…ƒç´ éƒ½æœ‰ç›‘å¬å™¨

åˆæˆäº‹ä»¶:
- Reactçš„SyntheticEventå¯¹è±¡
- è·¨æµè§ˆå™¨ä¸€è‡´
- é€šè¿‡Reactäº‹ä»¶ç³»ç»Ÿ
- è‡ªåŠ¨äº‹ä»¶å§”æ‰˜
*/
```

## ç¬¬äºŒéƒ¨åˆ†ï¼šäº‹ä»¶å§”æ‰˜æœºåˆ¶

### 2.1 Reactçš„äº‹ä»¶å§”æ‰˜

```jsx
// React 17ä¹‹å‰ï¼šäº‹ä»¶å§”æ‰˜åˆ°document
// React 17+ï¼šäº‹ä»¶å§”æ‰˜åˆ°æ ¹å®¹å™¨

function EventDelegation() {
  // å³ä½¿æœ‰1000ä¸ªæŒ‰é’®
  const buttons = Array(1000).fill(0).map((_, i) => i);
  
  return (
    <div>
      {buttons.map(i => (
        <button key={i} onClick={() => console.log(i)}>
          æŒ‰é’® {i}
        </button>
      ))}
    </div>
  );
  
  // Reactä¸ä¼šä¸ºæ¯ä¸ªæŒ‰é’®æ·»åŠ ç›‘å¬å™¨
  // è€Œæ˜¯åœ¨æ ¹å…ƒç´ æ·»åŠ ä¸€ä¸ªç›‘å¬å™¨
  // é€šè¿‡äº‹ä»¶å†’æ³¡å¤„ç†æ‰€æœ‰ç‚¹å‡»
}

// åŸç†æ¼”ç¤º
function DelegationPrinciple() {
  // Reactå†…éƒ¨ç±»ä¼¼è¿™æ ·å®ç°ï¼š
  useEffect(() => {
    const root = document.getElementById('root');
    
    const handleClick = (nativeEvent) => {
      // æ‰¾åˆ°è§¦å‘äº‹ä»¶çš„Reactç»„ä»¶
      const targetFiber = findFiberFromDOM(nativeEvent.target);
      
      // åˆ›å»ºåˆæˆäº‹ä»¶
      const syntheticEvent = createSyntheticEvent(nativeEvent);
      
      // è°ƒç”¨Reactç»„ä»¶çš„onClickå¤„ç†å™¨
      if (targetFiber.props.onClick) {
        targetFiber.props.onClick(syntheticEvent);
      }
    };
    
    root.addEventListener('click', handleClick);
    
    return () => {
      root.removeEventListener('click', handleClick);
    };
  }, []);
  
  return <div>{/* ... */}</div>;
}
```

### 2.2 äº‹ä»¶å§”æ‰˜çš„å¥½å¤„

```jsx
// 1. æ€§èƒ½ä¼˜åŠ¿
function PerformanceAdvantage() {
  const [items] = useState(Array(10000).fill(0).map((_, i) => ({
    id: i,
    name: `Item ${i}`
  })));
  
  const handleClick = (id) => {
    console.log('ç‚¹å‡»:', id);
  };
  
  // Reactåªåœ¨rootæ·»åŠ ä¸€ä¸ªç›‘å¬å™¨
  // è€Œä¸æ˜¯10000ä¸ª
  return (
    <ul>
      {items.map(item => (
        <li key={item.id} onClick={() => handleClick(item.id)}>
          {item.name}
        </li>
      ))}
    </ul>
  );
}

// 2. åŠ¨æ€å…ƒç´ æ”¯æŒ
function DynamicElements() {
  const [items, setItems] = useState([]);
  
  const addItem = () => {
    setItems([...items, { id: Date.now(), name: 'New' }]);
  };
  
  const handleClick = (id) => {
    console.log(id);
  };
  
  return (
    <div>
      <button onClick={addItem}>æ·»åŠ </button>
      <ul>
        {items.map(item => (
          <li key={item.id} onClick={() => handleClick(item.id)}>
            {item.name}
          </li>
        ))}
      </ul>
      {/* æ–°æ·»åŠ çš„å…ƒç´ è‡ªåŠ¨æœ‰äº‹ä»¶å¤„ç† */}
    </div>
  );
}
```

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šäº‹ä»¶å†’æ³¡å’Œæ•è·

### 3.1 äº‹ä»¶ä¼ æ’­é˜¶æ®µ

```jsx
function EventPhases() {
  const handleCapture = (phase) => (e) => {
    console.log(`${phase} æ•è·é˜¶æ®µ`);
  };
  
  const handleBubble = (phase) => (e) => {
    console.log(`${phase} å†’æ³¡é˜¶æ®µ`);
  };
  
  return (
    <div
      onClickCapture={handleCapture('å¤–å±‚')}
      onClick={handleBubble('å¤–å±‚')}
    >
      <div
        onClickCapture={handleCapture('ä¸­å±‚')}
        onClick={handleBubble('ä¸­å±‚')}
      >
        <button
          onClickCapture={handleCapture('å†…å±‚')}
          onClick={handleBubble('å†…å±‚')}
        >
          ç‚¹å‡»æµ‹è¯•
        </button>
      </div>
    </div>
  );
  
  // ç‚¹å‡»æŒ‰é’®ï¼Œè¾“å‡ºé¡ºåºï¼š
  // å¤–å±‚ æ•è·é˜¶æ®µ
  // ä¸­å±‚ æ•è·é˜¶æ®µ
  // å†…å±‚ æ•è·é˜¶æ®µ
  // å†…å±‚ å†’æ³¡é˜¶æ®µ
  // ä¸­å±‚ å†’æ³¡é˜¶æ®µ
  // å¤–å±‚ å†’æ³¡é˜¶æ®µ
}
```

### 3.2 é˜»æ­¢ä¼ æ’­

```jsx
function StopPropagationDemo() {
  const handleOuter = () => console.log('å¤–å±‚');
  const handleInner = (e) => {
    e.stopPropagation();
    console.log('å†…å±‚');
  };
  
  return (
    <div onClick={handleOuter}>
      <button onClick={handleInner}>
        ç‚¹å‡»ï¼ˆä¸ä¼šè§¦å‘å¤–å±‚ï¼‰
      </button>
    </div>
  );
}

// stopPropagationè¯¦è§£
function StopPropagationDetails() {
  const handleDocument = () => console.log('Document');
  const handleOuter = () => console.log('å¤–å±‚Div');
  const handleMiddle = () => console.log('ä¸­å±‚Div');
  const handleButton = (e) => {
    e.stopPropagation();
    console.log('æŒ‰é’®');
    // é˜»æ­¢äº‹ä»¶ç»§ç»­å‘ä¸Šå†’æ³¡
  };
  
  useEffect(() => {
    document.addEventListener('click', handleDocument);
    return () => document.removeEventListener('click', handleDocument);
  }, []);
  
  return (
    <div onClick={handleOuter}>
      å¤–å±‚
      <div onClick={handleMiddle}>
        ä¸­å±‚
        <button onClick={handleButton}>
          ç‚¹å‡»ï¼ˆåªè¾“å‡º"æŒ‰é’®"ï¼‰
        </button>
      </div>
    </div>
  );
}
```

### 3.3 é˜»æ­¢é»˜è®¤è¡Œä¸º

```jsx
function PreventDefaultDemo() {
  // é˜»æ­¢é“¾æ¥è·³è½¬
  const handleLinkClick = (e) => {
    e.preventDefault();
    console.log('é“¾æ¥è¢«ç‚¹å‡»ï¼Œä½†ä¸ä¼šè·³è½¬');
    // è‡ªå®šä¹‰å¯¼èˆªé€»è¾‘
    navigateTo(e.target.href);
  };
  
  // é˜»æ­¢è¡¨å•æäº¤
  const handleSubmit = (e) => {
    e.preventDefault();
    console.log('è¡¨å•æäº¤è¢«é˜»æ­¢');
    // è‡ªå®šä¹‰æäº¤é€»è¾‘
    submitForm();
  };
  
  // é˜»æ­¢å³é”®èœå•
  const handleContextMenu = (e) => {
    e.preventDefault();
    console.log('å³é”®èœå•è¢«ç¦ç”¨');
  };
  
  return (
    <div>
      <a href="https://example.com" onClick={handleLinkClick}>
        ç‚¹å‡»é“¾æ¥ï¼ˆä¸ä¼šè·³è½¬ï¼‰
      </a>
      
      <form onSubmit={handleSubmit}>
        <input type="text" />
        <button type="submit">æäº¤</button>
      </form>
      
      <div onContextMenu={handleContextMenu}>
        å³é”®ç‚¹å‡»è¿™é‡Œï¼ˆä¸ä¼šæ˜¾ç¤ºèœå•ï¼‰
      </div>
    </div>
  );
}
```

### 3.4 äº‹ä»¶ä¼ æ’­çš„å®é™…åº”ç”¨

```jsx
function EventPropagationApp() {
  const [logs, setLogs] = useState([]);
  
  const addLog = (message) => {
    setLogs(prev => [...prev, `${new Date().toLocaleTimeString()}: ${message}`]);
  };
  
  const handleOuterCapture = () => addLog('å¤–å±‚-æ•è·');
  const handleOuter = () => addLog('å¤–å±‚-å†’æ³¡');
  const handleMiddleCapture = () => addLog('ä¸­å±‚-æ•è·');
  const handleMiddle = () => addLog('ä¸­å±‚-å†’æ³¡');
  const handleButtonCapture = () => addLog('æŒ‰é’®-æ•è·');
  const handleButton = () => addLog('æŒ‰é’®-å†’æ³¡');
  
  return (
    <div>
      <div
        style={{ padding: '30px', background: '#f0f0f0' }}
        onClickCapture={handleOuterCapture}
        onClick={handleOuter}
      >
        å¤–å±‚
        <div
          style={{ padding: '20px', background: '#ddd', margin: '10px' }}
          onClickCapture={handleMiddleCapture}
          onClick={handleMiddle}
        >
          ä¸­å±‚
          <button
            style={{ margin: '10px' }}
            onClickCapture={handleButtonCapture}
            onClick={handleButton}
          >
            ç‚¹å‡»æˆ‘çœ‹äº‹ä»¶ä¼ æ’­
          </button>
        </div>
      </div>
      
      <div style={{ marginTop: '20px' }}>
        <h3>äº‹ä»¶æ—¥å¿—ï¼š</h3>
        <button onClick={() => setLogs([])}>æ¸…ç©ºæ—¥å¿—</button>
        <ul>
          {logs.map((log, i) => (
            <li key={i}>{log}</li>
          ))}
        </ul>
      </div>
    </div>
  );
}
```

## ç¬¬å››éƒ¨åˆ†ï¼šäº‹ä»¶æ± æœºåˆ¶ï¼ˆReact 17ä¹‹å‰ï¼‰

### 4.1 äº‹ä»¶æ± çš„æ¦‚å¿µ

```jsx
// React 16åŠä¹‹å‰ï¼šäº‹ä»¶æ± æœºåˆ¶
function EventPooling() {
  const handleClick = (e) => {
    console.log(e.type);  // "click"
    
    // å¼‚æ­¥è®¿é—®äº‹ä»¶å¯¹è±¡
    setTimeout(() => {
      console.log(e.type);  // React 16: null (äº‹ä»¶å¯¹è±¡è¢«é‡ç”¨)
                           // React 17+: "click" (ä¸å†ä½¿ç”¨äº‹ä»¶æ± )
    }, 0);
  };
  
  return <button onClick={handleClick}>ç‚¹å‡»</button>;
}

// React 16ä¸­éœ€è¦persist()
function EventPersist() {
  const handleClick = (e) => {
    e.persist();  // ä¿æŒäº‹ä»¶å¯¹è±¡
    
    setTimeout(() => {
      console.log(e.type);  // "click" (ç°åœ¨å¯ä»¥è®¿é—®)
    }, 0);
  };
  
  return <button onClick={handleClick}>ç‚¹å‡»</button>;
}

// React 17+ï¼šä¸å†éœ€è¦persist()
function React17Plus() {
  const handleClick = (e) => {
    // ä¸éœ€è¦persist()
    setTimeout(() => {
      console.log(e.type);  // "click" (è‡ªåŠ¨ä¿æŒ)
    }, 0);
  };
  
  return <button onClick={handleClick}>ç‚¹å‡»</button>;
}
```

### 4.2 ä¸ºä»€ä¹ˆç§»é™¤äº‹ä»¶æ± 

```jsx
// React 16çš„äº‹ä»¶æ± é—®é¢˜
function EventPoolingProblem() {
  const [events, setEvents] = useState([]);
  
  const handleClick = (e) => {
    // é”™è¯¯ï¼šç›´æ¥ä¿å­˜äº‹ä»¶å¯¹è±¡
    setEvents([...events, e]);  // æ‰€æœ‰äº‹ä»¶éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡
    
    // æ­£ç¡®ï¼šä¿å­˜äº‹ä»¶å±æ€§
    setEvents([...events, {
      type: e.type,
      target: e.target,
      timeStamp: e.timeStamp
    }]);
  };
  
  return (
    <div>
      <button onClick={handleClick}>ç‚¹å‡»</button>
      <ul>
        {events.map((event, i) => (
          <li key={i}>{event.type} at {event.timeStamp}</li>
        ))}
      </ul>
    </div>
  );
}

// React 17+ï¼šå¯ä»¥ç›´æ¥ä¿å­˜äº‹ä»¶å¯¹è±¡
function React17EventSaving() {
  const [events, setEvents] = useState([]);
  
  const handleClick = (e) => {
    // ç°åœ¨å¯ä»¥ç›´æ¥ä¿å­˜
    setEvents([...events, e]);
  };
  
  return (
    <div>
      <button onClick={handleClick}>ç‚¹å‡»</button>
      <ul>
        {events.map((event, i) => (
          <li key={i}>{event.type} at {event.timeStamp}</li>
        ))}
      </ul>
    </div>
  );
}
```

## ç¬¬äº”éƒ¨åˆ†ï¼šReact 17çš„äº‹ä»¶ç³»ç»Ÿå˜åŒ–

### 5.1 äº‹ä»¶å§”æ‰˜ä½ç½®çš„å˜åŒ–

```jsx
// React 16åŠä¹‹å‰ï¼šäº‹ä»¶é™„åŠ åˆ°document
// <html>
//   <body>
//     <div id="root">
//       <App />
//     </div>
//   </body>
// </html>
// æ‰€æœ‰Reactäº‹ä»¶ç›‘å¬å™¨éƒ½é™„åŠ åˆ°document

// React 17+ï¼šäº‹ä»¶é™„åŠ åˆ°æ ¹å®¹å™¨
// <html>
//   <body>
//     <div id="root">  â† äº‹ä»¶ç›‘å¬å™¨é™„åŠ åœ¨è¿™é‡Œ
//       <App />
//     </div>
//   </body>
// </html>

// è¿™ä¸ªå˜åŒ–çš„å¥½å¤„
function React17Benefits() {
  // 1. æ›´å®¹æ˜“åµŒå…¥Reactåˆ°å…¶ä»–æ¡†æ¶
  // 2. é¿å…ä¸å…¶ä»–DOMäº‹ä»¶å†²çª
  // 3. æ”¯æŒå¤šä¸ªReactæ ¹
  
  return (
    <div>
      {/* ä¸¤ä¸ªç‹¬ç«‹çš„Reactåº”ç”¨ */}
      <div id="app1">
        <ReactApp1 />
      </div>
      <div id="app2">
        <ReactApp2 />
      </div>
    </div>
  );
}
```

### 5.2 ä¸åŸç”Ÿäº‹ä»¶çš„äº¤äº’

```jsx
function NativeEventInteraction() {
  const buttonRef = useRef(null);
  const [logs, setLogs] = useState([]);
  
  const addLog = (msg) => {
    setLogs(prev => [...prev, msg]);
  };
  
  useEffect(() => {
    const button = buttonRef.current;
    
    // åŸç”Ÿäº‹ä»¶ï¼ˆå†’æ³¡é˜¶æ®µï¼‰
    const nativeHandler = () => {
      addLog('åŸç”Ÿäº‹ä»¶-å†’æ³¡');
    };
    
    // åŸç”Ÿäº‹ä»¶ï¼ˆæ•è·é˜¶æ®µï¼‰
    const nativeCaptureHandler = () => {
      addLog('åŸç”Ÿäº‹ä»¶-æ•è·');
    };
    
    button.addEventListener('click', nativeHandler);
    button.addEventListener('click', nativeCaptureHandler, true);
    
    // documentçº§åˆ«çš„åŸç”Ÿäº‹ä»¶
    const documentHandler = () => {
      addLog('DocumentåŸç”Ÿäº‹ä»¶');
    };
    document.addEventListener('click', documentHandler);
    
    return () => {
      button.removeEventListener('click', nativeHandler);
      button.removeEventListener('click', nativeCaptureHandler, true);
      document.removeEventListener('click', documentHandler);
    };
  }, []);
  
  // Reactåˆæˆäº‹ä»¶
  const handleReactClick = () => {
    addLog('Reactåˆæˆäº‹ä»¶-å†’æ³¡');
  };
  
  const handleReactClickCapture = () => {
    addLog('Reactåˆæˆäº‹ä»¶-æ•è·');
  };
  
  return (
    <div>
      <button
        ref={buttonRef}
        onClick={handleReactClick}
        onClickCapture={handleReactClickCapture}
      >
        ç‚¹å‡»æµ‹è¯•äº‹ä»¶é¡ºåº
      </button>
      
      <div>
        <h3>äº‹ä»¶è§¦å‘é¡ºåºï¼š</h3>
        <button onClick={() => setLogs([])}>æ¸…ç©º</button>
        <ol>
          {logs.map((log, i) => (
            <li key={i}>{log}</li>
          ))}
        </ol>
      </div>
      
      {/* React 17+çš„æ‰§è¡Œé¡ºåºï¼š
        1. åŸç”Ÿäº‹ä»¶-æ•è·ï¼ˆä»documentåˆ°ç›®æ ‡ï¼‰
        2. Reactåˆæˆäº‹ä»¶-æ•è·
        3. åŸç”Ÿäº‹ä»¶-å†’æ³¡ï¼ˆåœ¨ç›®æ ‡å…ƒç´ ï¼‰
        4. Reactåˆæˆäº‹ä»¶-å†’æ³¡
        5. DocumentåŸç”Ÿäº‹ä»¶
      */}
    </div>
  );
}
```

### 5.3 é˜»æ­¢ä¼ æ’­çš„å½±å“

```jsx
function StopPropagationImpact() {
  const buttonRef = useRef(null);
  
  useEffect(() => {
    // åŸç”Ÿäº‹ä»¶ç›‘å¬å™¨
    const handleNative = () => {
      console.log('åŸç”Ÿäº‹ä»¶è¢«è§¦å‘');
    };
    
    document.addEventListener('click', handleNative);
    
    return () => {
      document.removeEventListener('click', handleNative);
    };
  }, []);
  
  // Reactäº‹ä»¶ä¸­stopPropagation
  const handleReactClick = (e) => {
    e.stopPropagation();
    console.log('Reactäº‹ä»¶');
  };
  
  return (
    <button ref={buttonRef} onClick={handleReactClick}>
      ç‚¹å‡»
    </button>
  );
  
  // React 16ï¼š
  // - Reactäº‹ä»¶çš„stopPropagationä¼šé˜»æ­¢documentçš„åŸç”Ÿäº‹ä»¶
  
  // React 17+ï¼š
  // - Reactäº‹ä»¶çš„stopPropagationåªé˜»æ­¢Reactäº‹ä»¶ä¼ æ’­
  // - ä¸ä¼šå½±å“åŸç”Ÿäº‹ä»¶ï¼ˆå› ä¸ºäº‹ä»¶é™„åŠ åœ¨rootï¼Œä¸æ˜¯documentï¼‰
}
```

## ç¬¬å…­éƒ¨åˆ†ï¼šå¸¸è§äº‹ä»¶ç±»å‹è¯¦è§£

### 6.1 é¼ æ ‡äº‹ä»¶

```jsx
function MouseEvents() {
  const [info, setInfo] = useState('');
  
  const handleMouseEvent = (type) => (e) => {
    setInfo(`${type}: 
      ä½ç½®(${e.clientX}, ${e.clientY})
      æŒ‰é’®: ${e.button}
      Alt: ${e.altKey}
      Ctrl: ${e.ctrlKey}
      Shift: ${e.shiftKey}
      Meta: ${e.metaKey}`);
  };
  
  return (
    <div style={{ padding: '20px', background: '#f0f0f0' }}>
      <div
        style={{ padding: '50px', background: 'white', cursor: 'pointer' }}
        onClick={handleMouseEvent('onClick')}
        onDoubleClick={handleMouseEvent('onDoubleClick')}
        onMouseDown={handleMouseEvent('onMouseDown')}
        onMouseUp={handleMouseEvent('onMouseUp')}
        onMouseEnter={handleMouseEvent('onMouseEnter')}
        onMouseLeave={handleMouseEvent('onMouseLeave')}
        onMouseMove={handleMouseEvent('onMouseMove')}
        onMouseOver={handleMouseEvent('onMouseOver')}
        onMouseOut={handleMouseEvent('onMouseOut')}
        onContextMenu={handleMouseEvent('onContextMenu')}
      >
        åœ¨è¿™é‡Œæµ‹è¯•å„ç§é¼ æ ‡äº‹ä»¶
      </div>
      
      <pre>{info}</pre>
    </div>
  );
}

// é¼ æ ‡äº‹ä»¶çš„ç‰¹å®šåº”ç”¨
function MouseEventApplications() {
  // 1. æ‹–æ‹½åŠŸèƒ½
  const [position, setPosition] = useState({ x: 0, y: 0 });
  const [dragging, setDragging] = useState(false);
  const [offset, setOffset] = useState({ x: 0, y: 0 });
  
  const handleMouseDown = (e) => {
    setDragging(true);
    setOffset({
      x: e.clientX - position.x,
      y: e.clientY - position.y
    });
  };
  
  const handleMouseMove = (e) => {
    if (dragging) {
      setPosition({
        x: e.clientX - offset.x,
        y: e.clientY - offset.y
      });
    }
  };
  
  const handleMouseUp = () => {
    setDragging(false);
  };
  
  return (
    <div
      onMouseMove={handleMouseMove}
      onMouseUp={handleMouseUp}
      style={{ height: '400px', position: 'relative', background: '#f0f0f0' }}
    >
      <div
        onMouseDown={handleMouseDown}
        style={{
          position: 'absolute',
          left: `${position.x}px`,
          top: `${position.y}px`,
          width: '100px',
          height: '100px',
          background: 'blue',
          cursor: dragging ? 'grabbing' : 'grab',
          userSelect: 'none'
        }}
      >
        æ‹–åŠ¨æˆ‘
      </div>
    </div>
  );
}
```

### 6.2 é”®ç›˜äº‹ä»¶

```jsx
function KeyboardEvents() {
  const [keys, setKeys] = useState([]);
  
  const handleKeyDown = (e) => {
    const keyInfo = {
      key: e.key,
      code: e.code,
      keyCode: e.keyCode,  // å·²åºŸå¼ƒä½†ä»ç„¶å¯ç”¨
      altKey: e.altKey,
      ctrlKey: e.ctrlKey,
      shiftKey: e.shiftKey,
      metaKey: e.metaKey
    };
    
    setKeys(prev => [...prev, keyInfo]);
  };
  
  // å¿«æ·é”®å¤„ç†
  const handleShortcut = (e) => {
    // Ctrl+S: ä¿å­˜
    if (e.ctrlKey && e.key === 's') {
      e.preventDefault();
      console.log('ä¿å­˜å¿«æ·é”®');
    }
    
    // Ctrl+Z: æ’¤é”€
    if (e.ctrlKey && e.key === 'z') {
      e.preventDefault();
      console.log('æ’¤é”€å¿«æ·é”®');
    }
    
    // Esc: å–æ¶ˆ
    if (e.key === 'Escape') {
      console.log('ESCé”®');
    }
    
    // Enter: ç¡®è®¤
    if (e.key === 'Enter') {
      console.log('Enteré”®');
    }
  };
  
  return (
    <div>
      <input
        type="text"
        onKeyDown={handleKeyDown}
        onKeyUp={handleShortcut}
        placeholder="è¾“å…¥æŒ‰é”®æµ‹è¯•"
      />
      
      <div>
        <h3>æŒ‰é”®è®°å½•ï¼š</h3>
        <ul>
          {keys.map((key, i) => (
            <li key={i}>
              {key.key} (code: {key.code})
              {key.ctrlKey && ' + Ctrl'}
              {key.altKey && ' + Alt'}
              {key.shiftKey && ' + Shift'}
            </li>
          ))}
        </ul>
      </div>
    </div>
  );
}

// é”®ç›˜å¯¼èˆª
function KeyboardNavigation() {
  const [selectedIndex, setSelectedIndex] = useState(0);
  const items = ['é¡¹ç›®1', 'é¡¹ç›®2', 'é¡¹ç›®3', 'é¡¹ç›®4', 'é¡¹ç›®5'];
  
  const handleKeyDown = (e) => {
    switch (e.key) {
      case 'ArrowDown':
        e.preventDefault();
        setSelectedIndex(i => Math.min(i + 1, items.length - 1));
        break;
      case 'ArrowUp':
        e.preventDefault();
        setSelectedIndex(i => Math.max(i - 1, 0));
        break;
      case 'Home':
        e.preventDefault();
        setSelectedIndex(0);
        break;
      case 'End':
        e.preventDefault();
        setSelectedIndex(items.length - 1);
        break;
      case 'Enter':
        console.log('é€‰æ‹©:', items[selectedIndex]);
        break;
    }
  };
  
  return (
    <div tabIndex={0} onKeyDown={handleKeyDown} style={{ outline: 'none' }}>
      <p>ä½¿ç”¨æ–¹å‘é”®å¯¼èˆªï¼ŒEnteré€‰æ‹©</p>
      <ul>
        {items.map((item, i) => (
          <li
            key={i}
            style={{
              background: i === selectedIndex ? 'lightblue' : 'white',
              padding: '10px',
              cursor: 'pointer'
            }}
            onClick={() => setSelectedIndex(i)}
          >
            {item}
          </li>
        ))}
      </ul>
    </div>
  );
}
```

### 6.3 è¡¨å•äº‹ä»¶

```jsx
function FormEvents() {
  const [formData, setFormData] = useState({
    text: '',
    textarea: '',
    select: '',
    checkbox: false,
    radio: ''
  });
  
  // onChange: å€¼å˜åŒ–æ—¶
  const handleChange = (field) => (e) => {
    const value = e.target.type === 'checkbox' 
      ? e.target.checked 
      : e.target.value;
    
    setFormData({ ...formData, [field]: value });
  };
  
  // onInput: è¾“å…¥æ—¶ï¼ˆæ›´é¢‘ç¹ï¼‰
  const handleInput = (e) => {
    console.log('è¾“å…¥ä¸­:', e.target.value);
  };
  
  // onFocus: è·å¾—ç„¦ç‚¹
  const handleFocus = (e) => {
    console.log('ç„¦ç‚¹:', e.target.name);
  };
  
  // onBlur: å¤±å»ç„¦ç‚¹
  const handleBlur = (e) => {
    console.log('å¤±ç„¦:', e.target.name);
  };
  
  // onSubmit: è¡¨å•æäº¤
  const handleSubmit = (e) => {
    e.preventDefault();
    console.log('æäº¤:', formData);
  };
  
  return (
    <form onSubmit={handleSubmit}>
      <input
        name="text"
        value={formData.text}
        onChange={handleChange('text')}
        onInput={handleInput}
        onFocus={handleFocus}
        onBlur={handleBlur}
        placeholder="æ–‡æœ¬è¾“å…¥"
      />
      
      <textarea
        name="textarea"
        value={formData.textarea}
        onChange={handleChange('textarea')}
        placeholder="å¤šè¡Œæ–‡æœ¬"
      />
      
      <select
        name="select"
        value={formData.select}
        onChange={handleChange('select')}
      >
        <option value="">é€‰æ‹©...</option>
        <option value="a">é€‰é¡¹A</option>
        <option value="b">é€‰é¡¹B</option>
      </select>
      
      <label>
        <input
          type="checkbox"
          checked={formData.checkbox}
          onChange={handleChange('checkbox')}
        />
        å¤é€‰æ¡†
      </label>
      
      <button type="submit">æäº¤</button>
    </form>
  );
}
```

### 6.4 è§¦æ‘¸äº‹ä»¶

```jsx
function TouchEvents() {
  const [touches, setTouches] = useState([]);
  
  const handleTouchStart = (e) => {
    const touchList = Array.from(e.touches).map(touch => ({
      id: touch.identifier,
      x: touch.clientX,
      y: touch.clientY
    }));
    setTouches(touchList);
  };
  
  const handleTouchMove = (e) => {
    e.preventDefault();  // é˜²æ­¢é¡µé¢æ»šåŠ¨
    const touchList = Array.from(e.touches).map(touch => ({
      id: touch.identifier,
      x: touch.clientX,
      y: touch.clientY
    }));
    setTouches(touchList);
  };
  
  const handleTouchEnd = () => {
    setTouches([]);
  };
  
  return (
    <div
      onTouchStart={handleTouchStart}
      onTouchMove={handleTouchMove}
      onTouchEnd={handleTouchEnd}
      style={{
        width: '100%',
        height: '300px',
        background: '#f0f0f0',
        position: 'relative',
        touchAction: 'none'  // ç¦ç”¨é»˜è®¤è§¦æ‘¸è¡Œä¸º
      }}
    >
      <p>è§¦æ‘¸è¿™é‡Œ</p>
      {touches.map(touch => (
        <div
          key={touch.id}
          style={{
            position: 'absolute',
            left: touch.x,
            top: touch.y,
            width: '50px',
            height: '50px',
            borderRadius: '50%',
            background: 'blue',
            transform: 'translate(-50%, -50%)',
            pointerEvents: 'none'
          }}
        />
      ))}
    </div>
  );
}

// æ»‘åŠ¨æ‰‹åŠ¿
function SwipeGesture() {
  const [startX, setStartX] = useState(0);
  const [direction, setDirection] = useState('');
  
  const handleTouchStart = (e) => {
    setStartX(e.touches[0].clientX);
  };
  
  const handleTouchEnd = (e) => {
    const endX = e.changedTouches[0].clientX;
    const diff = endX - startX;
    
    if (Math.abs(diff) > 50) {  // æœ€å°æ»‘åŠ¨è·ç¦»
      if (diff > 0) {
        setDirection('å‘å³æ»‘åŠ¨');
      } else {
        setDirection('å‘å·¦æ»‘åŠ¨');
      }
    }
  };
  
  return (
    <div
      onTouchStart={handleTouchStart}
      onTouchEnd={handleTouchEnd}
      style={{
        padding: '50px',
        background: '#e0e0e0',
        textAlign: 'center'
      }}
    >
      <p>åœ¨è¿™é‡Œæ»‘åŠ¨</p>
      <p>{direction}</p>
    </div>
  );
}
```

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæ€§èƒ½ä¼˜åŒ–

### 7.1 äº‹ä»¶å¤„ç†å™¨ä¼˜åŒ–

```jsx
// ä¸å¥½ï¼šæ¯æ¬¡æ¸²æŸ“åˆ›å»ºæ–°å‡½æ•°
function BadEventHandler() {
  const [count, setCount] = useState(0);
  
  return (
    <div>
      {Array(1000).fill(0).map((_, i) => (
        <button key={i} onClick={() => console.log(i)}>
          æŒ‰é’® {i}
        </button>
      ))}
    </div>
  );
}

// å¥½ï¼šä½¿ç”¨useCallback
function GoodEventHandler() {
  const [count, setCount] = useState(0);
  
  const handleClick = useCallback((i) => {
    console.log(i);
  }, []);
  
  return (
    <div>
      {Array(1000).fill(0).map((_, i) => (
        <Button key={i} index={i} onClick={handleClick} />
      ))}
    </div>
  );
}

const Button = React.memo(({ index, onClick }) => {
  return (
    <button onClick={() => onClick(index)}>
      æŒ‰é’® {index}
    </button>
  );
});
```

### 7.2 äº‹ä»¶å§”æ‰˜ä¼˜åŒ–

```jsx
// ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†å¤§åˆ—è¡¨
function EventDelegationOptimization() {
  const [items] = useState(
    Array(10000).fill(0).map((_, i) => ({ id: i, name: `Item ${i}` }))
  );
  
  // åœ¨çˆ¶å…ƒç´ ç»Ÿä¸€å¤„ç†ç‚¹å‡»
  const handleListClick = (e) => {
    const target = e.target.closest('[data-id]');
    if (target) {
      const id = parseInt(target.dataset.id);
      console.log('ç‚¹å‡»é¡¹:', id);
    }
  };
  
  return (
    <ul onClick={handleListClick}>
      {items.map(item => (
        <li key={item.id} data-id={item.id}>
          {item.name}
        </li>
      ))}
    </ul>
  );
}
```

### 7.3 é˜²æŠ–å’ŒèŠ‚æµ

```jsx
// é˜²æŠ–ï¼šå»¶è¿Ÿæ‰§è¡Œ
function DebounceExample() {
  const [value, setValue] = useState('');
  const [debouncedValue, setDebouncedValue] = useState('');
  
  useEffect(() => {
    const timer = setTimeout(() => {
      setDebouncedValue(value);
    }, 500);
    
    return () => clearTimeout(timer);
  }, [value]);
  
  return (
    <div>
      <input
        value={value}
        onChange={e => setValue(e.target.value)}
        placeholder="è¾“å…¥æœç´¢..."
      />
      <p>å®æ—¶å€¼: {value}</p>
      <p>é˜²æŠ–å€¼: {debouncedValue}</p>
    </div>
  );
}

// èŠ‚æµï¼šé™åˆ¶æ‰§è¡Œé¢‘ç‡
function ThrottleExample() {
  const [position, setPosition] = useState({ x: 0, y: 0 });
  const lastUpdate = useRef(0);
  
  const handleMouseMove = (e) => {
    const now = Date.now();
    
    // æ¯100msæœ€å¤šæ›´æ–°ä¸€æ¬¡
    if (now - lastUpdate.current >= 100) {
      setPosition({ x: e.clientX, y: e.clientY });
      lastUpdate.current = now;
    }
  };
  
  return (
    <div
      onMouseMove={handleMouseMove}
      style={{ height: '200px', background: '#f0f0f0' }}
    >
      <p>é¼ æ ‡ä½ç½®: ({position.x}, {position.y})</p>
    </div>
  );
}
```

## ç¬¬å…«éƒ¨åˆ†ï¼šReact 19çš„äº‹ä»¶ç³»ç»Ÿå¢å¼º

### 8.1 è‡ªåŠ¨æ‰¹å¤„ç†ä¸äº‹ä»¶

```jsx
// React 19ä¸­ï¼Œæ‰€æœ‰äº‹ä»¶å¤„ç†å™¨ä¸­çš„çŠ¶æ€æ›´æ–°éƒ½ä¼šè‡ªåŠ¨æ‰¹å¤„ç†
function React19AutoBatching() {
  const [count, setCount] = useState(0);
  const [flag, setFlag] = useState(false);
  const [text, setText] = useState('');
  
  console.log('æ¸²æŸ“');  // åªæ¸²æŸ“ä¸€æ¬¡
  
  const handleClick = () => {
    setCount(c => c + 1);
    setFlag(f => !f);
    setText('updated');
    // ä¸‰ä¸ªçŠ¶æ€æ›´æ–°æ‰¹å¤„ç†ï¼Œåªè§¦å‘ä¸€æ¬¡æ¸²æŸ“
  };
  
  // ç”šè‡³åœ¨å¼‚æ­¥å›è°ƒä¸­ä¹Ÿä¼šæ‰¹å¤„ç†
  const handleAsyncClick = async () => {
    await fetchData();
    setCount(c => c + 1);
    setFlag(f => !f);
    setText('async');
    // React 19: ä»ç„¶æ‰¹å¤„ç†
    // React 18ä¹‹å‰: ä¼šè§¦å‘ä¸‰æ¬¡æ¸²æŸ“
  };
  
  return (
    <div>
      <button onClick={handleClick}>åŒæ­¥æ›´æ–°</button>
      <button onClick={handleAsyncClick}>å¼‚æ­¥æ›´æ–°</button>
      <p>è®¡æ•°: {count}, æ ‡å¿—: {String(flag)}, æ–‡æœ¬: {text}</p>
    </div>
  );
}
```

### 8.2 æ–°çš„äº‹ä»¶å±æ€§

```jsx
function React19NewEventProps() {
  const handlePointerEvent = (e) => {
    // React 19å¢å¼ºäº†æŒ‡é’ˆäº‹ä»¶æ”¯æŒ
    console.log({
      pointerType: e.pointerType,  // 'mouse', 'pen', 'touch'
      pressure: e.pressure,         // å‹åŠ›å€¼
      tangentialPressure: e.tangentialPressure,
      tiltX: e.tiltX,
      tiltY: e.tiltY,
      twist: e.twist,
      width: e.width,
      height: e.height
    });
  };
  
  return (
    <div
      onPointerDown={handlePointerEvent}
      onPointerMove={handlePointerEvent}
      onPointerUp={handlePointerEvent}
      style={{ width: '300px', height: '300px', background: '#f0f0f0' }}
    >
      æµ‹è¯•æŒ‡é’ˆäº‹ä»¶
    </div>
  );
}
```

## ç¬¬ä¹éƒ¨åˆ†ï¼šæœ€ä½³å®è·µ

### 9.1 å‚æ•°ä¼ é€’é€‰æ‹©

```jsx
// å°åˆ—è¡¨ï¼šç®­å¤´å‡½æ•°
<button onClick={() => handleClick(id)}>ç‚¹å‡»</button>

// å¤§åˆ—è¡¨ï¼šäº‹ä»¶å§”æ‰˜ + dataå±æ€§
<ul onClick={handleListClick}>
  {items.map(item => (
    <li data-id={item.id}>{item.name}</li>
  ))}
</ul>

// æ€§èƒ½æ•æ„Ÿï¼šuseCallback + æå–ç»„ä»¶
const MemoItem = React.memo(({ item, onClick }) => (
  <li onClick={onClick}>{item.name}</li>
));

const handleClick = useCallback((id) => {}, []);
```

### 9.2 é¿å…å†…è”å¯¹è±¡å’Œæ•°ç»„

```jsx
// ä¸å¥½ï¼šæ¯æ¬¡æ¸²æŸ“åˆ›å»ºæ–°å¯¹è±¡
function BadInlineObject() {
  return (
    <Child
      config={{ theme: 'dark', lang: 'zh' }}  // æ¯æ¬¡éƒ½æ˜¯æ–°å¯¹è±¡
      items={[1, 2, 3]}  // æ¯æ¬¡éƒ½æ˜¯æ–°æ•°ç»„
    />
  );
}

// å¥½ï¼šä½¿ç”¨useMemoæˆ–æå–åˆ°ç»„ä»¶å¤–
const CONFIG = { theme: 'dark', lang: 'zh' };
const ITEMS = [1, 2, 3];

function GoodStableRefs() {
  return (
    <Child
      config={CONFIG}
      items={ITEMS}
    />
  );
}

// æˆ–ä½¿ç”¨useMemoï¼ˆå¦‚æœéœ€è¦åŠ¨æ€å€¼ï¼‰
function WithMemo({ theme }) {
  const config = useMemo(() => ({
    theme,
    lang: 'zh'
  }), [theme]);
  
  return <Child config={config} />;
}
```

### 9.3 äº‹ä»¶å‘½åè§„èŒƒ

```jsx
function EventNaming() {
  // æ¨èçš„å‘½åè§„èŒƒï¼š
  // handleXxx: äº‹ä»¶å¤„ç†å‡½æ•°
  // onXxx: å›è°ƒProps
  
  const handleClick = () => {
    console.log('ç‚¹å‡»');
  };
  
  const handleSubmit = (e) => {
    e.preventDefault();
    console.log('æäº¤');
  };
  
  const handleChange = (e) => {
    console.log('å˜åŒ–:', e.target.value);
  };
  
  return (
    <form onSubmit={handleSubmit}>
      <input onChange={handleChange} />
      <button onClick={handleClick}>æäº¤</button>
    </form>
  );
}

// ç»„ä»¶Propså‘½å
function MyButton({ onClick, onHover, onFocus }) {
  return (
    <button
      onClick={onClick}
      onMouseEnter={onHover}
      onFocus={onFocus}
    >
      æŒ‰é’®
    </button>
  );
}
```

### 9.4 é”™è¯¯å¤„ç†

```jsx
function ErrorHandling() {
  const [error, setError] = useState(null);
  
  const handleClick = async () => {
    try {
      await fetchData();
      setError(null);
    } catch (err) {
      setError(err.message);
      console.error('é”™è¯¯:', err);
    }
  };
  
  const handleInputChange = (e) => {
    try {
      const value = e.target.value;
      if (!value.match(/^[0-9]+$/)) {
        throw new Error('åªèƒ½è¾“å…¥æ•°å­—');
      }
      // å¤„ç†æœ‰æ•ˆè¾“å…¥
    } catch (err) {
      setError(err.message);
    }
  };
  
  return (
    <div>
      {error && <div className="error">{error}</div>}
      <input onChange={handleInputChange} />
      <button onClick={handleClick}>æäº¤</button>
    </div>
  );
}
```

## ç¬¬åéƒ¨åˆ†ï¼šè°ƒè¯•æŠ€å·§

### 10.1 äº‹ä»¶æ—¥å¿—è®°å½•

```jsx
function EventLogging() {
  const logEvent = (eventName) => (e) => {
    console.group(`ğŸ¯ ${eventName}`);
    console.log('äº‹ä»¶ç±»å‹:', e.type);
    console.log('ç›®æ ‡å…ƒç´ :', e.target);
    console.log('å½“å‰ç›®æ ‡:', e.currentTarget);
    console.log('äº‹ä»¶é˜¶æ®µ:', e.eventPhase);
    console.log('æ—¶é—´æˆ³:', e.timeStamp);
    console.log('æ˜¯å¦å†’æ³¡:', e.bubbles);
    console.log('æ˜¯å¦å¯å–æ¶ˆ:', e.cancelable);
    console.log('åŸç”Ÿäº‹ä»¶:', e.nativeEvent);
    console.groupEnd();
  };
  
  return (
    <div onClick={logEvent('Outer Click')}>
      <button onClick={logEvent('Button Click')}>
        ç‚¹å‡»æŸ¥çœ‹äº‹ä»¶è¯¦æƒ…
      </button>
    </div>
  );
}
```

### 10.2 äº‹ä»¶è¿½è¸ªå·¥å…·

```jsx
function EventTracker() {
  const [eventLog, setEventLog] = useState([]);
  
  const trackEvent = (name) => (e) => {
    const eventInfo = {
      name,
      type: e.type,
      target: e.target.tagName,
      timeStamp: e.timeStamp,
      phase: e.eventPhase
    };
    
    setEventLog(prev => [...prev, eventInfo]);
  };
  
  return (
    <div>
      <div
        onClick={trackEvent('å¤–å±‚')}
        onClickCapture={trackEvent('å¤–å±‚æ•è·')}
        style={{ padding: '20px', background: '#f0f0f0' }}
      >
        å¤–å±‚
        <button
          onClick={trackEvent('æŒ‰é’®')}
          onClickCapture={trackEvent('æŒ‰é’®æ•è·')}
        >
          ç‚¹å‡»
        </button>
      </div>
      
      <div>
        <h3>äº‹ä»¶æ—¥å¿—ï¼š</h3>
        <button onClick={() => setEventLog([])}>æ¸…ç©º</button>
        <table>
          <thead>
            <tr>
              <th>åç§°</th>
              <th>ç±»å‹</th>
              <th>ç›®æ ‡</th>
              <th>é˜¶æ®µ</th>
              <th>æ—¶é—´</th>
            </tr>
          </thead>
          <tbody>
            {eventLog.map((event, i) => (
              <tr key={i}>
                <td>{event.name}</td>
                <td>{event.type}</td>
                <td>{event.target}</td>
                <td>{event.phase === 1 ? 'æ•è·' : 'å†’æ³¡'}</td>
                <td>{Math.round(event.timeStamp)}ms</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}
```

### 10.3 æ€§èƒ½åˆ†æ

```jsx
import { Profiler } from 'react';

function PerformanceAnalysis() {
  const [items] = useState(Array(1000).fill(0).map((_, i) => ({
    id: i,
    name: `Item ${i}`
  })));
  
  const handleClick = (id) => {
    console.log('ç‚¹å‡»:', id);
  };
  
  const onRenderCallback = (
    id,
    phase,
    actualDuration,
    baseDuration
  ) => {
    console.log(`${id} ${phase} é˜¶æ®µè€—æ—¶: ${actualDuration}ms`);
  };
  
  return (
    <Profiler id="EventList" onRender={onRenderCallback}>
      <ul>
        {items.map(item => (
          <li key={item.id} onClick={() => handleClick(item.id)}>
            {item.name}
          </li>
        ))}
      </ul>
    </Profiler>
  );
}
```

## ç¬¬åä¸€éƒ¨åˆ†ï¼šå¸¸è§é—®é¢˜ä¸è§£å†³

### 11.1 é—®é¢˜1ï¼šäº‹ä»¶å¤„ç†å™¨ä¸è§¦å‘

```jsx
// é—®é¢˜ï¼šå¿˜è®°ç»‘å®šäº‹ä»¶
function Problem1() {
  const handleClick = () => {
    console.log('ç‚¹å‡»');
  };
  
  return <button>ç‚¹å‡»</button>;  // å¿˜è®° onClick={handleClick}
}

// è§£å†³
function Solution1() {
  const handleClick = () => {
    console.log('ç‚¹å‡»');
  };
  
  return <button onClick={handleClick}>ç‚¹å‡»</button>;
}
```

### 11.2 é—®é¢˜2ï¼šthisæŒ‡å‘é”™è¯¯ï¼ˆç±»ç»„ä»¶ï¼‰

```jsx
// é—®é¢˜ï¼šç±»ç»„ä»¶ä¸­thisä¸¢å¤±
class Problem2 extends React.Component {
  handleClick() {
    console.log(this.state);  // this is undefined
  }
  
  render() {
    return <button onClick={this.handleClick}>ç‚¹å‡»</button>;
  }
}

// è§£å†³æ–¹æ¡ˆ1ï¼šç®­å¤´å‡½æ•°
class Solution2a extends React.Component {
  handleClick = () => {
    console.log(this.state);  // æ­£ç¡®
  }
  
  render() {
    return <button onClick={this.handleClick}>ç‚¹å‡»</button>;
  }
}

// è§£å†³æ–¹æ¡ˆ2ï¼šbind
class Solution2b extends React.Component {
  constructor(props) {
    super(props);
    this.handleClick = this.handleClick.bind(this);
  }
  
  handleClick() {
    console.log(this.state);
  }
  
  render() {
    return <button onClick={this.handleClick}>ç‚¹å‡»</button>;
  }
}

// è§£å†³æ–¹æ¡ˆ3ï¼šä½¿ç”¨å‡½æ•°ç»„ä»¶ï¼ˆæ¨èï¼‰
function Solution2c() {
  const handleClick = () => {
    console.log('ç‚¹å‡»');
  };
  
  return <button onClick={handleClick}>ç‚¹å‡»</button>;
}
```

### 11.3 é—®é¢˜3ï¼šæ— æ³•è®¿é—®äº‹ä»¶å¯¹è±¡å±æ€§

```jsx
// é—®é¢˜ï¼šReact 16ä¸­å¼‚æ­¥è®¿é—®äº‹ä»¶
function Problem3() {
  const handleClick = (e) => {
    setTimeout(() => {
      console.log(e.target);  // React 16: null
    }, 0);
  };
  
  return <button onClick={handleClick}>ç‚¹å‡»</button>;
}

// è§£å†³æ–¹æ¡ˆ1ï¼šReact 16ä¸­ä½¿ç”¨persist()
function Solution3a() {
  const handleClick = (e) => {
    e.persist();
    setTimeout(() => {
      console.log(e.target);  // æ­£ç¡®
    }, 0);
  };
  
  return <button onClick={handleClick}>ç‚¹å‡»</button>;
}

// è§£å†³æ–¹æ¡ˆ2ï¼šä¿å­˜éœ€è¦çš„å±æ€§
function Solution3b() {
  const handleClick = (e) => {
    const target = e.target;
    setTimeout(() => {
      console.log(target);  // æ­£ç¡®
    }, 0);
  };
  
  return <button onClick={handleClick}>ç‚¹å‡»</button>;
}

// è§£å†³æ–¹æ¡ˆ3ï¼šå‡çº§åˆ°React 17+ï¼ˆæ¨èï¼‰
function Solution3c() {
  const handleClick = (e) => {
    setTimeout(() => {
      console.log(e.target);  // React 17+: æ­£ç¡®
    }, 0);
  };
  
  return <button onClick={handleClick}>ç‚¹å‡»</button>;
}
```

### 11.4 é—®é¢˜4ï¼šstopPropagationä¸ç”Ÿæ•ˆ

```jsx
// é—®é¢˜ï¼šåœ¨åŸç”Ÿäº‹ä»¶ä¸­é˜»æ­¢ä¸äº†Reactäº‹ä»¶
function Problem4() {
  const buttonRef = useRef(null);
  
  useEffect(() => {
    const button = buttonRef.current;
    button.addEventListener('click', (e) => {
      e.stopPropagation();  // åªé˜»æ­¢åŸç”Ÿäº‹ä»¶ä¼ æ’­
    });
  }, []);
  
  const handleReactClick = () => {
    console.log('Reactäº‹ä»¶ä»ç„¶è§¦å‘');  // ä»ç„¶ä¼šæ‰§è¡Œ
  };
  
  return <button ref={buttonRef} onClick={handleReactClick}>ç‚¹å‡»</button>;
}

// è§£å†³ï¼šä½¿ç”¨Reactäº‹ä»¶æˆ–åœ¨æ•è·é˜¶æ®µé˜»æ­¢
function Solution4() {
  const handleReactClick = (e) => {
    e.stopPropagation();  // ä½¿ç”¨Reactäº‹ä»¶é˜»æ­¢
  };
  
  return <button onClick={handleReactClick}>ç‚¹å‡»</button>;
}
```

## ç¬¬åäºŒéƒ¨åˆ†ï¼šå®æˆ˜ç»¼åˆæ¡ˆä¾‹

### 12.1 æ‹–æ‹½æ’åºåˆ—è¡¨

```jsx
function DraggableList() {
  const [items, setItems] = useState([
    { id: 1, text: 'é¡¹ç›®1' },
    { id: 2, text: 'é¡¹ç›®2' },
    { id: 3, text: 'é¡¹ç›®3' }
  ]);
  
  const [draggingId, setDraggingId] = useState(null);
  const [overIndex, setOverIndex] = useState(null);
  
  const handleDragStart = (id) => (e) => {
    setDraggingId(id);
    e.dataTransfer.effectAllowed = 'move';
  };
  
  const handleDragOver = (index) => (e) => {
    e.preventDefault();
    setOverIndex(index);
  };
  
  const handleDrop = (dropIndex) => (e) => {
    e.preventDefault();
    
    if (draggingId === null) return;
    
    const dragIndex = items.findIndex(item => item.id === draggingId);
    const newItems = [...items];
    const [draggedItem] = newItems.splice(dragIndex, 1);
    newItems.splice(dropIndex, 0, draggedItem);
    
    setItems(newItems);
    setDraggingId(null);
    setOverIndex(null);
  };
  
  const handleDragEnd = () => {
    setDraggingId(null);
    setOverIndex(null);
  };
  
  return (
    <ul>
      {items.map((item, index) => (
        <li
          key={item.id}
          draggable
          onDragStart={handleDragStart(item.id)}
          onDragOver={handleDragOver(index)}
          onDrop={handleDrop(index)}
          onDragEnd={handleDragEnd}
          style={{
            padding: '10px',
            margin: '5px',
            background: draggingId === item.id ? '#e0e0e0' : 
                       overIndex === index ? '#f0f0f0' : 'white',
            border: '1px solid #ccc',
            cursor: 'move'
          }}
        >
          {item.text}
        </li>
      ))}
    </ul>
  );
}
```

### 12.2 å›¾ç‰‡è£å‰ªå·¥å…·

```jsx
function ImageCropper({ imageSrc }) {
  const [crop, setCrop] = useState({ x: 0, y: 0, width: 100, height: 100 });
  const [dragging, setDragging] = useState(false);
  const [resizing, setResizing] = useState(false);
  const [startPos, setStartPos] = useState({ x: 0, y: 0 });
  
  const handleMouseDown = (type) => (e) => {
    if (type === 'move') {
      setDragging(true);
    } else {
      setResizing(true);
    }
    setStartPos({ x: e.clientX, y: e.clientY });
  };
  
  const handleMouseMove = (e) => {
    if (dragging) {
      const dx = e.clientX - startPos.x;
      const dy = e.clientY - startPos.y;
      setCrop(prev => ({
        ...prev,
        x: prev.x + dx,
        y: prev.y + dy
      }));
      setStartPos({ x: e.clientX, y: e.clientY });
    } else if (resizing) {
      const dx = e.clientX - startPos.x;
      const dy = e.clientY - startPos.y;
      setCrop(prev => ({
        ...prev,
        width: Math.max(50, prev.width + dx),
        height: Math.max(50, prev.height + dy)
      }));
      setStartPos({ x: e.clientX, y: e.clientY });
    }
  };
  
  const handleMouseUp = () => {
    setDragging(false);
    setResizing(false);
  };
  
  return (
    <div
      onMouseMove={handleMouseMove}
      onMouseUp={handleMouseUp}
      style={{ position: 'relative', width: '600px', height: '400px' }}
    >
      <img src={imageSrc} alt="è£å‰ª" style={{ width: '100%', height: '100%' }} />
      
      <div
        style={{
          position: 'absolute',
          left: crop.x,
          top: crop.y,
          width: crop.width,
          height: crop.height,
          border: '2px dashed white',
          cursor: 'move'
        }}
        onMouseDown={handleMouseDown('move')}
      >
        <div
          style={{
            position: 'absolute',
            right: -5,
            bottom: -5,
            width: 10,
            height: 10,
            background: 'white',
            border: '1px solid black',
            cursor: 'nwse-resize'
          }}
          onMouseDown={handleMouseDown('resize')}
        />
      </div>
    </div>
  );
}
```

## ç»ƒä¹ é¢˜

### åŸºç¡€ç»ƒä¹ 

1. åˆ›å»ºç»„ä»¶æ˜¾ç¤ºäº‹ä»¶å¯¹è±¡çš„å„ä¸ªå±æ€§
2. å®ç°å‚æ•°ä¼ é€’çš„ä¸‰ç§æ–¹å¼
3. æµ‹è¯•äº‹ä»¶çš„æ•è·å’Œå†’æ³¡

### è¿›é˜¶ç»ƒä¹ 

1. å®ç°ä¸€ä¸ªå›¾ç‰‡è£å‰ªå·¥å…·
2. åˆ›å»ºé”®ç›˜å¯¼èˆªçš„ä¸‹æ‹‰èœå•
3. å®ç°æ‹–æ‹½æ’åºåˆ—è¡¨

### é«˜çº§ç»ƒä¹ 

1. åˆ†æReactäº‹ä»¶ç³»ç»Ÿçš„æºç 
2. å®ç°è‡ªå®šä¹‰çš„äº‹ä»¶ç³»ç»Ÿ
3. ä¼˜åŒ–å¤§åˆ—è¡¨çš„äº‹ä»¶å¤„ç†æ€§èƒ½

é€šè¿‡æœ¬ç« å­¦ä¹ ï¼Œä½ å·²ç»æ·±å…¥ç†è§£äº†Reactçš„äº‹ä»¶å¯¹è±¡å’Œå‚æ•°ä¼ é€’æœºåˆ¶ã€‚è¿™äº›çŸ¥è¯†æ˜¯æ„å»ºå¤æ‚äº¤äº’çš„åŸºç¡€ã€‚ç»§ç»­å­¦ä¹ ï¼ŒæŒæ¡æ›´å¤šReactæŠ€èƒ½ï¼

