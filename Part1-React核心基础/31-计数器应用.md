# è®¡æ•°å™¨åº”ç”¨

## å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬ç« å®æˆ˜é¡¹ç›®ï¼Œä½ å°†å…¨é¢æŒæ¡ï¼š

- useStateçš„å®æˆ˜åº”ç”¨
- äº‹ä»¶å¤„ç†çš„å®Œæ•´æµç¨‹
- ç»„ä»¶è®¾è®¡ä¸æ‹†åˆ†
- Stateæ›´æ–°ç­–ç•¥
- åŠŸèƒ½æ‰©å±•ä¸ä¼˜åŒ–
- æ€§èƒ½ä¼˜åŒ–æŠ€å·§
- ç»„ä»¶æµ‹è¯•æ–¹æ³•
- React 19æ–°ç‰¹æ€§åº”ç”¨

## é¡¹ç›®æ¦‚è¿°

è®¡æ•°å™¨åº”ç”¨æ˜¯å­¦ä¹ Reactçš„ç»å…¸å…¥é—¨é¡¹ç›®ã€‚è™½ç„¶ç®€å•ï¼Œä½†æ¶µç›–äº†Reactçš„æ ¸å¿ƒæ¦‚å¿µï¼š
- Stateç®¡ç†
- äº‹ä»¶å¤„ç†
- ç»„ä»¶ç»„åˆ
- æ¡ä»¶æ¸²æŸ“
- æ€§èƒ½ä¼˜åŒ–

æˆ‘ä»¬å°†ä»åŸºç¡€ç‰ˆæœ¬é€æ­¥è¿­ä»£åˆ°é«˜çº§ç‰ˆæœ¬ï¼Œå­¦ä¹ Reactå¼€å‘çš„å®Œæ•´æµç¨‹ã€‚

## ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¡€è®¡æ•°å™¨

### 1.1 æœ€ç®€å•çš„è®¡æ•°å™¨

```jsx
import { useState } from 'react';

function BasicCounter() {
  const [count, setCount] = useState(0);
  
  return (
    <div>
      <h1>è®¡æ•°å™¨</h1>
      <p>å½“å‰å€¼ï¼š{count}</p>
      <button onClick={() => setCount(count + 1)}>+1</button>
      <button onClick={() => setCount(count - 1)}>-1</button>
      <button onClick={() => setCount(0)}>é‡ç½®</button>
    </div>
  );
}

export default BasicCounter;
```

#### ä»£ç è§£æ

```jsx
// 1. å¯¼å…¥å¿…è¦çš„Hook
import { useState } from 'react';

// 2. å®šä¹‰å‡½æ•°ç»„ä»¶
function BasicCounter() {
  // 3. ä½¿ç”¨useStateåˆ›å»ºState
  // count: å½“å‰è®¡æ•°å€¼
  // setCount: æ›´æ–°countçš„å‡½æ•°
  // 0: åˆå§‹å€¼
  const [count, setCount] = useState(0);
  
  // 4. æ¸²æŸ“UI
  return (
    <div>
      {/* æ˜¾ç¤ºå½“å‰è®¡æ•° */}
      <p>å½“å‰å€¼ï¼š{count}</p>
      
      {/* å¢åŠ æŒ‰é’®ï¼šä½¿ç”¨ç®­å¤´å‡½æ•° */}
      <button onClick={() => setCount(count + 1)}>+1</button>
      
      {/* å‡å°‘æŒ‰é’® */}
      <button onClick={() => setCount(count - 1)}>-1</button>
      
      {/* é‡ç½®æŒ‰é’®ï¼šè®¾ç½®ä¸º0 */}
      <button onClick={() => setCount(0)}>é‡ç½®</button>
    </div>
  );
}
```

### 1.2 æ·»åŠ æ ·å¼

```jsx
function StyledCounter() {
  const [count, setCount] = useState(0);
  
  return (
    <div style={{
      maxWidth: '400px',
      margin: '50px auto',
      padding: '30px',
      textAlign: 'center',
      borderRadius: '10px',
      boxShadow: '0 2px 10px rgba(0,0,0,0.1)',
      background: 'white'
    }}>
      <h1 style={{
        margin: '0 0 20px',
        color: '#333',
        fontSize: '28px'
      }}>
        è®¡æ•°å™¨åº”ç”¨
      </h1>
      
      <p style={{
        fontSize: '48px',
        margin: '30px 0',
        color: count > 0 ? '#28a745' : count < 0 ? '#dc3545' : '#333',
        fontWeight: 'bold'
      }}>
        {count}
      </p>
      
      <div style={{
        display: 'flex',
        gap: '10px',
        justifyContent: 'center'
      }}>
        <button
          onClick={() => setCount(count - 1)}
          style={{
            padding: '12px 24px',
            fontSize: '18px',
            border: 'none',
            borderRadius: '5px',
            background: '#dc3545',
            color: 'white',
            cursor: 'pointer'
          }}
        >
          -1
        </button>
        
        <button
          onClick={() => setCount(0)}
          style={{
            padding: '12px 24px',
            fontSize: '18px',
            border: 'none',
            borderRadius: '5px',
            background: '#6c757d',
            color: 'white',
            cursor: 'pointer'
          }}
        >
          é‡ç½®
        </button>
        
        <button
          onClick={() => setCount(count + 1)}
          style={{
            padding: '12px 24px',
            fontSize: '18px',
            border: 'none',
            borderRadius: '5px',
            background: '#28a745',
            color: 'white',
            cursor: 'pointer'
          }}
        >
          +1
        </button>
      </div>
    </div>
  );
}
```

### 1.3 ä½¿ç”¨CSSç±»å

```jsx
// Counter.jsx
function Counter() {
  const [count, setCount] = useState(0);
  
  return (
    <div className="counter-container">
      <h1 className="counter-title">è®¡æ•°å™¨åº”ç”¨</h1>
      
      <p className={`counter-display ${count > 0 ? 'positive' : count < 0 ? 'negative' : ''}`}>
        {count}
      </p>
      
      <div className="counter-buttons">
        <button className="btn btn-danger" onClick={() => setCount(count - 1)}>
          -1
        </button>
        <button className="btn btn-secondary" onClick={() => setCount(0)}>
          é‡ç½®
        </button>
        <button className="btn btn-success" onClick={() => setCount(count + 1)}>
          +1
        </button>
      </div>
    </div>
  );
}
```

```css
/* Counter.css */
.counter-container {
  max-width: 400px;
  margin: 50px auto;
  padding: 30px;
  text-align: center;
  border-radius: 10px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  background: white;
}

.counter-title {
  margin: 0 0 20px;
  color: #333;
  font-size: 28px;
}

.counter-display {
  font-size: 48px;
  margin: 30px 0;
  color: #333;
  font-weight: bold;
  transition: color 0.3s;
}

.counter-display.positive {
  color: #28a745;
}

.counter-display.negative {
  color: #dc3545;
}

.counter-buttons {
  display: flex;
  gap: 10px;
  justify-content: center;
}

.btn {
  padding: 12px 24px;
  fontSize: 18px;
  border: none;
  border-radius: 5px;
  color: white;
  cursor: pointer;
  transition: opacity 0.2s;
}

.btn:hover {
  opacity: 0.9;
}

.btn:active {
  transform: translateY(1px);
}

.btn-danger {
  background: #dc3545;
}

.btn-secondary {
  background: #6c757d;
}

.btn-success {
  background: #28a745;
}
```

## ç¬¬äºŒéƒ¨åˆ†ï¼šå¢å¼ºåŠŸèƒ½

### 2.1 æ·»åŠ æ­¥é•¿æ§åˆ¶

```jsx
function StepCounter() {
  const [count, setCount] = useState(0);
  const [step, setStep] = useState(1);
  
  const increment = () => {
    setCount(count + step);
  };
  
  const decrement = () => {
    setCount(count - step);
  };
  
  const reset = () => {
    setCount(0);
  };
  
  return (
    <div className="counter-container">
      <h1>æ­¥é•¿è®¡æ•°å™¨</h1>
      
      <p className="counter-display">{count}</p>
      
      <div className="step-control">
        <label>æ­¥é•¿ï¼š</label>
        <input
          type="number"
          value={step}
          onChange={(e) => setStep(Number(e.target.value))}
          min="1"
          max="100"
        />
      </div>
      
      <div className="counter-buttons">
        <button onClick={decrement}>-{step}</button>
        <button onClick={reset}>é‡ç½®</button>
        <button onClick={increment}>+{step}</button>
      </div>
    </div>
  );
}
```

### 2.2 æ·»åŠ èŒƒå›´é™åˆ¶

```jsx
function RangeCounter() {
  const [count, setCount] = useState(0);
  const [min, setMin] = useState(-10);
  const [max, setMax] = useState(10);
  
  const increment = () => {
    setCount(prev => Math.min(prev + 1, max));
  };
  
  const decrement = () => {
    setCount(prev => Math.max(prev - 1, min));
  };
  
  const reset = () => {
    setCount(0);
  };
  
  return (
    <div className="counter-container">
      <h1>èŒƒå›´è®¡æ•°å™¨</h1>
      
      <p className="counter-display">{count}</p>
      
      <div className="range-controls">
        <div>
          <label>æœ€å°å€¼ï¼š</label>
          <input
            type="number"
            value={min}
            onChange={(e) => setMin(Number(e.target.value))}
          />
        </div>
        
        <div>
          <label>æœ€å¤§å€¼ï¼š</label>
          <input
            type="number"
            value={max}
            onChange={(e) => setMax(Number(e.target.value))}
          />
        </div>
      </div>
      
      <div className="counter-buttons">
        <button onClick={decrement} disabled={count <= min}>
          -1
        </button>
        <button onClick={reset}>é‡ç½®</button>
        <button onClick={increment} disabled={count >= max}>
          +1
        </button>
      </div>
      
      <div className="progress-bar">
        <div
          className="progress-fill"
          style={{
            width: `${((count - min) / (max - min)) * 100}%`
          }}
        />
      </div>
    </div>
  );
}
```

### 2.3 æ·»åŠ å†å²è®°å½•

```jsx
function HistoryCounter() {
  const [count, setCount] = useState(0);
  const [history, setHistory] = useState([0]);
  const [historyIndex, setHistoryIndex] = useState(0);
  
  const addToHistory = (newCount) => {
    const newHistory = history.slice(0, historyIndex + 1);
    newHistory.push(newCount);
    setHistory(newHistory);
    setHistoryIndex(newHistory.length - 1);
    setCount(newCount);
  };
  
  const increment = () => {
    addToHistory(count + 1);
  };
  
  const decrement = () => {
    addToHistory(count - 1);
  };
  
  const reset = () => {
    addToHistory(0);
  };
  
  const undo = () => {
    if (historyIndex > 0) {
      const newIndex = historyIndex - 1;
      setHistoryIndex(newIndex);
      setCount(history[newIndex]);
    }
  };
  
  const redo = () => {
    if (historyIndex < history.length - 1) {
      const newIndex = historyIndex + 1;
      setHistoryIndex(newIndex);
      setCount(history[newIndex]);
    }
  };
  
  return (
    <div className="counter-container">
      <h1>å†å²è®¡æ•°å™¨</h1>
      
      <p className="counter-display">{count}</p>
      
      <div className="counter-buttons">
        <button onClick={decrement}>-1</button>
        <button onClick={reset}>é‡ç½®</button>
        <button onClick={increment}>+1</button>
      </div>
      
      <div className="history-controls">
        <button onClick={undo} disabled={historyIndex === 0}>
          â†¶ æ’¤é”€
        </button>
        <button onClick={redo} disabled={historyIndex === history.length - 1}>
          â†· é‡åš
        </button>
      </div>
      
      <div className="history-list">
        <h3>å†å²è®°å½•ï¼š</h3>
        <ul>
          {history.map((value, index) => (
            <li
              key={index}
              className={index === historyIndex ? 'current' : ''}
              onClick={() => {
                setHistoryIndex(index);
                setCount(value);
              }}
            >
              {value} {index === historyIndex && 'â† å½“å‰'}
            </li>
          ))}
        </ul>
      </div>
    </div>
  );
}
```

### 2.4 å¤šä¸ªè®¡æ•°å™¨

```jsx
function MultiCounter() {
  const [counters, setCounters] = useState([
    { id: 1, value: 0, name: 'è®¡æ•°å™¨1' },
    { id: 2, value: 0, name: 'è®¡æ•°å™¨2' },
    { id: 3, value: 0, name: 'è®¡æ•°å™¨3' }
  ]);
  
  const updateCounter = (id, delta) => {
    setCounters(counters.map(counter =>
      counter.id === id
        ? { ...counter, value: counter.value + delta }
        : counter
    ));
  };
  
  const resetCounter = (id) => {
    setCounters(counters.map(counter =>
      counter.id === id
        ? { ...counter, value: 0 }
        : counter
    ));
  };
  
  const addCounter = () => {
    const newId = Math.max(...counters.map(c => c.id)) + 1;
    setCounters([
      ...counters,
      { id: newId, value: 0, name: `è®¡æ•°å™¨${newId}` }
    ]);
  };
  
  const removeCounter = (id) => {
    setCounters(counters.filter(counter => counter.id !== id));
  };
  
  const resetAll = () => {
    setCounters(counters.map(counter => ({ ...counter, value: 0 })));
  };
  
  const totalCount = counters.reduce((sum, counter) => sum + counter.value, 0);
  
  return (
    <div className="multi-counter-container">
      <h1>å¤šè®¡æ•°å™¨ç®¡ç†</h1>
      
      <div className="total-display">
        <h2>æ€»è®¡ï¼š{totalCount}</h2>
      </div>
      
      <div className="global-controls">
        <button onClick={addCounter}>æ·»åŠ è®¡æ•°å™¨</button>
        <button onClick={resetAll}>å…¨éƒ¨é‡ç½®</button>
      </div>
      
      <div className="counters-grid">
        {counters.map(counter => (
          <div key={counter.id} className="counter-card">
            <h3>{counter.name}</h3>
            <p className="value">{counter.value}</p>
            
            <div className="counter-buttons">
              <button onClick={() => updateCounter(counter.id, -1)}>-</button>
              <button onClick={() => resetCounter(counter.id)}>é‡ç½®</button>
              <button onClick={() => updateCounter(counter.id, 1)}>+</button>
            </div>
            
            <button
              className="remove-btn"
              onClick={() => removeCounter(counter.id)}
              disabled={counters.length === 1}
            >
              åˆ é™¤
            </button>
          </div>
        ))}
      </div>
    </div>
  );
}
```

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šé«˜çº§ç‰¹æ€§

### 3.1 å®šæ—¶å™¨è®¡æ•°å™¨

```jsx
function TimerCounter() {
  const [count, setCount] = useState(0);
  const [isRunning, setIsRunning] = useState(false);
  const [interval, setIntervalDuration] = useState(1000);
  const timerRef = useRef(null);
  
  useEffect(() => {
    if (isRunning) {
      timerRef.current = setInterval(() => {
        setCount(c => c + 1);
      }, interval);
    } else {
      if (timerRef.current) {
        clearInterval(timerRef.current);
      }
    }
    
    return () => {
      if (timerRef.current) {
        clearInterval(timerRef.current);
      }
    };
  }, [isRunning, interval]);
  
  const start = () => setIsRunning(true);
  const pause = () => setIsRunning(false);
  const reset = () => {
    setIsRunning(false);
    setCount(0);
  };
  
  return (
    <div className="timer-counter">
      <h1>å®šæ—¶å™¨è®¡æ•°å™¨</h1>
      
      <p className="counter-display">{count}</p>
      
      <div className="interval-control">
        <label>é—´éš”ï¼ˆæ¯«ç§’ï¼‰ï¼š</label>
        <input
          type="number"
          value={interval}
          onChange={(e) => setIntervalDuration(Number(e.target.value))}
          min="100"
          max="5000"
          step="100"
          disabled={isRunning}
        />
      </div>
      
      <div className="timer-buttons">
        {!isRunning ? (
          <button onClick={start} className="btn-success">å¼€å§‹</button>
        ) : (
          <button onClick={pause} className="btn-warning">æš‚åœ</button>
        )}
        <button onClick={reset} className="btn-danger">é‡ç½®</button>
      </div>
    </div>
  );
}
```

### 3.2 ç›®æ ‡è®¡æ•°å™¨

```jsx
function GoalCounter() {
  const [count, setCount] = useState(0);
  const [goal, setGoal] = useState(100);
  const [startTime, setStartTime] = useState(null);
  const [endTime, setEndTime] = useState(null);
  
  useEffect(() => {
    if (count === 1 && startTime === null) {
      setStartTime(Date.now());
    }
    
    if (count === goal && endTime === null) {
      setEndTime(Date.now());
    }
  }, [count, goal, startTime, endTime]);
  
  const increment = () => {
    if (count < goal) {
      setCount(count + 1);
    }
  };
  
  const reset = () => {
    setCount(0);
    setStartTime(null);
    setEndTime(null);
  };
  
  const progress = (count / goal) * 100;
  const timeElapsed = endTime
    ? ((endTime - startTime) / 1000).toFixed(2)
    : startTime
    ? ((Date.now() - startTime) / 1000).toFixed(2)
    : 0;
  
  const isCompleted = count === goal;
  
  return (
    <div className="goal-counter">
      <h1>ç›®æ ‡è®¡æ•°å™¨</h1>
      
      <div className="goal-input">
        <label>ç›®æ ‡ï¼š</label>
        <input
          type="number"
          value={goal}
          onChange={(e) => setGoal(Number(e.target.value))}
          min="1"
          disabled={count > 0}
        />
      </div>
      
      <div className="progress-section">
        <p className="progress-text">
          è¿›åº¦ï¼š{count} / {goal} ({progress.toFixed(1)}%)
        </p>
        
        <div className="progress-bar">
          <div
            className="progress-fill"
            style={{
              width: `${progress}%`,
              background: isCompleted ? '#28a745' : '#007bff'
            }}
          />
        </div>
      </div>
      
      {isCompleted && (
        <div className="completion-message">
          ğŸ‰ å®Œæˆï¼ç”¨æ—¶ï¼š{timeElapsed} ç§’
        </div>
      )}
      
      {!isCompleted && startTime && (
        <div className="elapsed-time">
          å·²ç”¨æ—¶ï¼š{timeElapsed} ç§’
        </div>
      )}
      
      <div className="counter-buttons">
        <button
          onClick={increment}
          disabled={isCompleted}
          className="btn-primary"
        >
          +1
        </button>
        <button onClick={reset} className="btn-secondary">
          é‡ç½®
        </button>
      </div>
    </div>
  );
}
```

### 3.3 ç«èµ›è®¡æ•°å™¨

```jsx
function RaceCounter() {
  const [players, setPlayers] = useState([
    { id: 1, name: 'ç©å®¶1', count: 0 },
    { id: 2, name: 'ç©å®¶2', count: 0 }
  ]);
  const [goal, setGoal] = useState(50);
  const [winner, setWinner] = useState(null);
  const [gameStarted, setGameStarted] = useState(false);
  
  const incrementPlayer = (id) => {
    if (winner) return;
    
    setPlayers(prev => prev.map(player => {
      if (player.id === id) {
        const newCount = player.count + 1;
        if (newCount >= goal && !winner) {
          setWinner(player.name);
        }
        return { ...player, count: newCount };
      }
      return player;
    }));
  };
  
  const resetGame = () => {
    setPlayers(players.map(p => ({ ...p, count: 0 })));
    setWinner(null);
    setGameStarted(false);
  };
  
  const startGame = () => {
    setGameStarted(true);
  };
  
  return (
    <div className="race-counter">
      <h1>ç«èµ›è®¡æ•°å™¨</h1>
      
      {!gameStarted && (
        <div className="setup">
          <div className="goal-input">
            <label>ç›®æ ‡åˆ†æ•°ï¼š</label>
            <input
              type="number"
              value={goal}
              onChange={(e) => setGoal(Number(e.target.value))}
              min="10"
              max="100"
            />
          </div>
          <button onClick={startGame} className="btn-success">
            å¼€å§‹æ¸¸æˆ
          </button>
        </div>
      )}
      
      {gameStarted && (
        <>
          {winner && (
            <div className="winner-announcement">
              ğŸ† {winner} è·èƒœï¼
            </div>
          )}
          
          <div className="players-container">
            {players.map(player => {
              const progress = (player.count / goal) * 100;
              return (
                <div key={player.id} className="player-lane">
                  <h3>{player.name}</h3>
                  
                  <div className="player-progress">
                    <div className="progress-bar">
                      <div
                        className="progress-fill"
                        style={{ width: `${progress}%` }}
                      />
                    </div>
                    <span className="progress-label">
                      {player.count} / {goal}
                    </span>
                  </div>
                  
                  <button
                    onClick={() => incrementPlayer(player.id)}
                    disabled={!!winner}
                    className="btn-primary"
                  >
                    ç‚¹å‡» +1
                  </button>
                </div>
              );
            })}
          </div>
          
          <button onClick={resetGame} className="btn-secondary">
            é‡æ–°å¼€å§‹
          </button>
        </>
      )}
    </div>
  );
}
```

## ç¬¬å››éƒ¨åˆ†ï¼šç»„ä»¶æ‹†åˆ†ä¸ä¼˜åŒ–

### 4.1 æ‹†åˆ†CounterDisplayç»„ä»¶

```jsx
// CounterDisplay.jsx
function CounterDisplay({ value, className }) {
  return (
    <p className={`counter-display ${className || ''}`}>
      {value}
    </p>
  );
}

export default CounterDisplay;
```

### 4.2 æ‹†åˆ†CounterButtonsç»„ä»¶

```jsx
// CounterButtons.jsx
function CounterButtons({ onIncrement, onDecrement, onReset }) {
  return (
    <div className="counter-buttons">
      <button onClick={onDecrement} className="btn btn-danger">
        -1
      </button>
      <button onClick={onReset} className="btn btn-secondary">
        é‡ç½®
      </button>
      <button onClick={onIncrement} className="btn btn-success">
        +1
      </button>
    </div>
  );
}

export default CounterButtons;
```

### 4.3 ä½¿ç”¨æ‹†åˆ†çš„ç»„ä»¶

```jsx
import CounterDisplay from './CounterDisplay';
import CounterButtons from './CounterButtons';

function OptimizedCounter() {
  const [count, setCount] = useState(0);
  
  const increment = () => setCount(c => c + 1);
  const decrement = () => setCount(c => c - 1);
  const reset = () => setCount(0);
  
  const displayClass = count > 0 ? 'positive' : count < 0 ? 'negative' : '';
  
  return (
    <div className="counter-container">
      <h1>ä¼˜åŒ–çš„è®¡æ•°å™¨</h1>
      
      <CounterDisplay value={count} className={displayClass} />
      
      <CounterButtons
        onIncrement={increment}
        onDecrement={decrement}
        onReset={reset}
      />
    </div>
  );
}
```

### 4.4 ä½¿ç”¨React.memoä¼˜åŒ–

```jsx
// CounterDisplay.jsxï¼ˆä¼˜åŒ–ç‰ˆï¼‰
import { memo } from 'react';

const CounterDisplay = memo(function CounterDisplay({ value, className }) {
  console.log('CounterDisplayæ¸²æŸ“');
  
  return (
    <p className={`counter-display ${className || ''}`}>
      {value}
    </p>
  );
});

export default CounterDisplay;

// CounterButtons.jsxï¼ˆä¼˜åŒ–ç‰ˆï¼‰
import { memo } from 'react';

const CounterButtons = memo(function CounterButtons({ 
  onIncrement, 
  onDecrement, 
  onReset 
}) {
  console.log('CounterButtonsæ¸²æŸ“');
  
  return (
    <div className="counter-buttons">
      <button onClick={onDecrement} className="btn btn-danger">
        -1
      </button>
      <button onClick={onReset} className="btn btn-secondary">
        é‡ç½®
      </button>
      <button onClick={onIncrement} className="btn btn-success">
        +1
      </button>
    </div>
  );
});

export default CounterButtons;

// ä¸»ç»„ä»¶ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
import { useState, useCallback } from 'react';
import CounterDisplay from './CounterDisplay';
import CounterButtons from './CounterButtons';

function OptimizedCounter() {
  const [count, setCount] = useState(0);
  
  // ä½¿ç”¨useCallbackç¼“å­˜å‡½æ•°å¼•ç”¨
  const increment = useCallback(() => {
    setCount(c => c + 1);
  }, []);
  
  const decrement = useCallback(() => {
    setCount(c => c - 1);
  }, []);
  
  const reset = useCallback(() => {
    setCount(0);
  }, []);
  
  const displayClass = count > 0 ? 'positive' : count < 0 ? 'negative' : '';
  
  return (
    <div className="counter-container">
      <h1>ä¼˜åŒ–çš„è®¡æ•°å™¨</h1>
      
      <CounterDisplay value={count} className={displayClass} />
      
      <CounterButtons
        onIncrement={increment}
        onDecrement={decrement}
        onReset={reset}
      />
    </div>
  );
}
```

## ç¬¬äº”éƒ¨åˆ†ï¼šæœ¬åœ°å­˜å‚¨

### 5.1 ä¿å­˜åˆ°localStorage

```jsx
function PersistentCounter() {
  const [count, setCount] = useState(() => {
    // ä»localStorageåˆå§‹åŒ–
    const saved = localStorage.getItem('counter');
    return saved ? JSON.parse(saved) : 0;
  });
  
  // æ¯æ¬¡countå˜åŒ–æ—¶ä¿å­˜
  useEffect(() => {
    localStorage.setItem('counter', JSON.stringify(count));
  }, [count]);
  
  const increment = () => setCount(c => c + 1);
  const decrement = () => setCount(c => c - 1);
  const reset = () => setCount(0);
  
  return (
    <div className="counter-container">
      <h1>æŒä¹…åŒ–è®¡æ•°å™¨</h1>
      <p className="info">è®¡æ•°ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°</p>
      
      <CounterDisplay value={count} />
      <CounterButtons
        onIncrement={increment}
        onDecrement={decrement}
        onReset={reset}
      />
    </div>
  );
}
```

### 5.2 è‡ªå®šä¹‰Hookå°è£…localStorage

```jsx
// useLocalStorage.js
function useLocalStorage(key, initialValue) {
  const [storedValue, setStoredValue] = useState(() => {
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      console.error(error);
      return initialValue;
    }
  });
  
  const setValue = (value) => {
    try {
      const valueToStore = value instanceof Function ? value(storedValue) : value;
      setStoredValue(valueToStore);
      window.localStorage.setItem(key, JSON.stringify(valueToStore));
    } catch (error) {
      console.error(error);
    }
  };
  
  return [storedValue, setValue];
}

// ä½¿ç”¨
function CounterWithCustomHook() {
  const [count, setCount] = useLocalStorage('counter', 0);
  
  return (
    <div className="counter-container">
      <h1>è®¡æ•°å™¨</h1>
      <p>{count}</p>
      <button onClick={() => setCount(c => c + 1)}>+1</button>
      <button onClick={() => setCount(c => c - 1)}>-1</button>
      <button onClick={() => setCount(0)}>é‡ç½®</button>
    </div>
  );
}
```

## ç¬¬å…­éƒ¨åˆ†ï¼šåŠ¨ç”»æ•ˆæœ

### 6.1 æ•°å­—ç¿»è½¬åŠ¨ç”»

```jsx
function AnimatedCounter() {
  const [count, setCount] = useState(0);
  const [isAnimating, setIsAnimating] = useState(false);
  
  const increment = () => {
    setIsAnimating(true);
    setCount(c => c + 1);
    setTimeout(() => setIsAnimating(false), 300);
  };
  
  const decrement = () => {
    setIsAnimating(true);
    setCount(c => c - 1);
    setTimeout(() => setIsAnimating(false), 300);
  };
  
  return (
    <div className="counter-container">
      <h1>åŠ¨ç”»è®¡æ•°å™¨</h1>
      
      <p
        className={`counter-display ${isAnimating ? 'animate' : ''}`}
        style={{
          transition: 'all 0.3s ease',
          transform: isAnimating ? 'scale(1.2)' : 'scale(1)'
        }}
      >
        {count}
      </p>
      
      <div className="counter-buttons">
        <button onClick={decrement}>-1</button>
        <button onClick={() => setCount(0)}>é‡ç½®</button>
        <button onClick={increment}>+1</button>
      </div>
    </div>
  );
}
```

### 6.2 è¿›åº¦æ¡åŠ¨ç”»

```jsx
function ProgressCounter() {
  const [count, setCount] = useState(0);
  const max = 100;
  const progress = (count / max) * 100;
  
  return (
    <div className="counter-container">
      <h1>è¿›åº¦è®¡æ•°å™¨</h1>
      
      <p className="counter-display">{count} / {max}</p>
      
      <div className="progress-container">
        <div
          className="progress-bar"
          style={{
            width: `${progress}%`,
            transition: 'width 0.3s ease',
            background: `hsl(${progress * 1.2}, 70%, 50%)`
          }}
        />
      </div>
      
      <div className="counter-buttons">
        <button
          onClick={() => setCount(Math.max(0, count - 1))}
          disabled={count === 0}
        >
          -1
        </button>
        <button onClick={() => setCount(0)}>é‡ç½®</button>
        <button
          onClick={() => setCount(Math.min(max, count + 1))}
          disabled={count === max}
        >
          +1
        </button>
      </div>
    </div>
  );
}
```

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæµ‹è¯•

### 7.1 å•å…ƒæµ‹è¯•

```jsx
// Counter.test.jsx
import { render, screen, fireEvent } from '@testing-library/react';
import Counter from './Counter';

describe('Counterç»„ä»¶', () => {
  test('åˆå§‹è®¡æ•°ä¸º0', () => {
    render(<Counter />);
    const display = screen.getByText('0');
    expect(display).toBeInTheDocument();
  });
  
  test('ç‚¹å‡»+1æŒ‰é’®å¢åŠ è®¡æ•°', () => {
    render(<Counter />);
    const incrementBtn = screen.getByText('+1');
    
    fireEvent.click(incrementBtn);
    expect(screen.getByText('1')).toBeInTheDocument();
    
    fireEvent.click(incrementBtn);
    expect(screen.getByText('2')).toBeInTheDocument();
  });
  
  test('ç‚¹å‡»-1æŒ‰é’®å‡å°‘è®¡æ•°', () => {
    render(<Counter />);
    const decrementBtn = screen.getByText('-1');
    
    fireEvent.click(decrementBtn);
    expect(screen.getByText('-1')).toBeInTheDocument();
  });
  
  test('ç‚¹å‡»é‡ç½®æŒ‰é’®å½’é›¶', () => {
    render(<Counter />);
    const incrementBtn = screen.getByText('+1');
    const resetBtn = screen.getByText('é‡ç½®');
    
    fireEvent.click(incrementBtn);
    fireEvent.click(incrementBtn);
    expect(screen.getByText('2')).toBeInTheDocument();
    
    fireEvent.click(resetBtn);
    expect(screen.getByText('0')).toBeInTheDocument();
  });
});
```

### 7.2 é›†æˆæµ‹è¯•

```jsx
// Counter.integration.test.jsx
import { render, screen, fireEvent } from '@testing-library/react';
import Counter from './Counter';

describe('Counteré›†æˆæµ‹è¯•', () => {
  test('å®Œæ•´æ“ä½œæµç¨‹', () => {
    render(<Counter />);
    
    // åˆå§‹ä¸º0
    expect(screen.getByText('0')).toBeInTheDocument();
    
    // å¢åŠ åˆ°5
    const incrementBtn = screen.getByText('+1');
    for (let i = 0; i < 5; i++) {
      fireEvent.click(incrementBtn);
    }
    expect(screen.getByText('5')).toBeInTheDocument();
    
    // å‡å°‘2
    const decrementBtn = screen.getByText('-1');
    fireEvent.click(decrementBtn);
    fireEvent.click(decrementBtn);
    expect(screen.getByText('3')).toBeInTheDocument();
    
    // é‡ç½®
    const resetBtn = screen.getByText('é‡ç½®');
    fireEvent.click(resetBtn);
    expect(screen.getByText('0')).toBeInTheDocument();
  });
});
```

## ç¬¬å…«éƒ¨åˆ†ï¼šReact 19ç‰¹æ€§

### 8.1 ä½¿ç”¨Server Actions

```jsx
// app/actions/counter.js
'use server';

export async function incrementCounter(currentCount) {
  // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æœåŠ¡ç«¯é€»è¾‘
  await new Promise(resolve => setTimeout(resolve, 100));
  return currentCount + 1;
}

export async function saveCounter(count) {
  'use server';
  // ä¿å­˜åˆ°æ•°æ®åº“
  await db.counters.update({ value: count });
  return { success: true };
}

// app/components/ServerCounter.jsx
'use client';

import { useState, useTransition } from 'react';
import { incrementCounter, saveCounter } from '../actions/counter';

function ServerCounter() {
  const [count, setCount] = useState(0);
  const [isPending, startTransition] = useTransition();
  
  const handleIncrement = async () => {
    startTransition(async () => {
      const newCount = await incrementCounter(count);
      setCount(newCount);
    });
  };
  
  const handleSave = async () => {
    startTransition(async () => {
      await saveCounter(count);
      alert('ä¿å­˜æˆåŠŸï¼');
    });
  };
  
  return (
    <div className="counter-container">
      <h1>Server Actionsè®¡æ•°å™¨</h1>
      
      <p className="counter-display">{count}</p>
      
      <div className="counter-buttons">
        <button onClick={handleIncrement} disabled={isPending}>
          {isPending ? 'å¤„ç†ä¸­...' : '+1'}
        </button>
        <button onClick={handleSave} disabled={isPending}>
          ä¿å­˜
        </button>
      </div>
    </div>
  );
}
```

### 8.2 ä½¿ç”¨useOptimistic

```jsx
'use client';

import { useState, useOptimistic } from 'react';

function OptimisticCounter() {
  const [count, setCount] = useState(0);
  const [optimisticCount, setOptimisticCount] = useOptimistic(count);
  
  const increment = async () => {
    // ç«‹å³æ›´æ–°UIï¼ˆä¹è§‚æ›´æ–°ï¼‰
    setOptimisticCount(count + 1);
    
    // å¼‚æ­¥è°ƒç”¨æœåŠ¡å™¨
    try {
      const response = await fetch('/api/counter/increment', {
        method: 'POST',
        body: JSON.stringify({ value: count })
      });
      const data = await response.json();
      setCount(data.value);
    } catch (error) {
      // å¦‚æœå¤±è´¥ï¼Œæ¢å¤åŸå€¼
      setOptimisticCount(count);
    }
  };
  
  return (
    <div className="counter-container">
      <h1>ä¹è§‚æ›´æ–°è®¡æ•°å™¨</h1>
      
      <p className="counter-display">{optimisticCount}</p>
      
      <button onClick={increment}>+1</button>
    </div>
  );
}
```

## ç¬¬ä¹éƒ¨åˆ†ï¼šæœ€ä½³å®è·µæ€»ç»“

### 9.1 Stateç®¡ç†

```jsx
// âœ… å¥½çš„åšæ³•ï¼šä½¿ç”¨å‡½æ•°å¼æ›´æ–°
const increment = () => {
  setCount(c => c + 1);
};

// âŒ é¿å…ï¼šç›´æ¥ä½¿ç”¨count
const increment = () => {
  setCount(count + 1);
};
```

### 9.2 äº‹ä»¶å¤„ç†

```jsx
// âœ… å¥½çš„åšæ³•ï¼šæå–å¤„ç†å‡½æ•°
function Counter() {
  const handleIncrement = () => setCount(c => c + 1);
  return <button onClick={handleIncrement}>+1</button>;
}

// âŒ é¿å…ï¼šå†…è”ç®­å¤´å‡½æ•°ï¼ˆåœ¨å¤§åˆ—è¡¨ä¸­ï¼‰
function Counter() {
  return <button onClick={() => setCount(c => c + 1)}>+1</button>;
}
```

### 9.3 æ€§èƒ½ä¼˜åŒ–

```jsx
// âœ… ä½¿ç”¨useCallbackç¼“å­˜å‡½æ•°
const increment = useCallback(() => {
  setCount(c => c + 1);
}, []);

// âœ… ä½¿ç”¨React.memoç¼“å­˜ç»„ä»¶
const CounterDisplay = memo(({ value }) => (
  <p>{value}</p>
));
```

## ç»ƒä¹ é¢˜

### åŸºç¡€ç»ƒä¹ 

1. åˆ›å»ºä¸€ä¸ªåŸºç¡€è®¡æ•°å™¨ï¼ŒåŒ…å«å¢åŠ ã€å‡å°‘ã€é‡ç½®åŠŸèƒ½
2. æ·»åŠ æ ·å¼ï¼Œè®©è®¡æ•°å™¨çœ‹èµ·æ¥ç¾è§‚
3. å®ç°æ­¥é•¿æ§åˆ¶åŠŸèƒ½

### è¿›é˜¶ç»ƒä¹ 

1. å®ç°èŒƒå›´é™åˆ¶è®¡æ•°å™¨
2. æ·»åŠ å†å²è®°å½•å’Œæ’¤é”€/é‡åšåŠŸèƒ½
3. åˆ›å»ºå¤šä¸ªç‹¬ç«‹çš„è®¡æ•°å™¨

### é«˜çº§ç»ƒä¹ 

1. å®ç°å®šæ—¶å™¨è‡ªåŠ¨è®¡æ•°
2. åˆ›å»ºç›®æ ‡è®¡æ•°å™¨ï¼Œæ˜¾ç¤ºè¿›åº¦å’Œç”¨æ—¶
3. å®ç°ç«èµ›è®¡æ•°å™¨ï¼Œæ”¯æŒå¤šç©å®¶å¯¹æˆ˜
4. æ·»åŠ æœ¬åœ°å­˜å‚¨ï¼Œåˆ·æ–°é¡µé¢åæ•°æ®ä¸ä¸¢å¤±
5. ç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

### æŒ‘æˆ˜ç»ƒä¹ 

1. ä½¿ç”¨React 19çš„Server Actionså®ç°æœåŠ¡ç«¯è®¡æ•°
2. å®ç°ä¹è§‚æ›´æ–°ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
3. æ·»åŠ å¤æ‚çš„åŠ¨ç”»æ•ˆæœ
4. åˆ›å»ºä¸€ä¸ªå¯é…ç½®çš„è®¡æ•°å™¨ç»„ä»¶åº“

## æ€»ç»“

é€šè¿‡æœ¬ç« çš„å­¦ä¹ ï¼Œä½ å·²ç»ï¼š

- æŒæ¡äº†useStateçš„åŸºæœ¬ç”¨æ³•å’Œé«˜çº§æŠ€å·§
- å­¦ä¼šäº†äº‹ä»¶å¤„ç†çš„å„ç§æ¨¡å¼
- ç†è§£äº†ç»„ä»¶æ‹†åˆ†å’Œå¤ç”¨
- æŒæ¡äº†æ€§èƒ½ä¼˜åŒ–æ–¹æ³•
- å­¦ä¼šäº†ä½¿ç”¨localStorageæŒä¹…åŒ–æ•°æ®
- äº†è§£äº†ç»„ä»¶æµ‹è¯•çš„æ–¹æ³•
- ä½“éªŒäº†React 19çš„æ–°ç‰¹æ€§

è®¡æ•°å™¨è™½ç„¶ç®€å•ï¼Œä½†åŒ…å«äº†Reactå¼€å‘çš„æ ¸å¿ƒæ¦‚å¿µã€‚æŒæ¡è¿™äº›çŸ¥è¯†ï¼Œä½ å°±å¯ä»¥å¼€å§‹æ„å»ºæ›´å¤æ‚çš„åº”ç”¨äº†ï¼

ç»§ç»­å­¦ä¹ ï¼Œæ¢ç´¢æ›´å¤šReactçš„å¼ºå¤§åŠŸèƒ½ï¼
