# è´­ç‰©è½¦åº”ç”¨

## å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬ç« å®æˆ˜é¡¹ç›®ï¼Œä½ å°†ç»¼åˆè¿ç”¨ï¼š

- å¤æ‚Stateç®¡ç†ç­–ç•¥
- æ•°ç»„æ“ä½œçš„æœ€ä½³å®è·µ
- æ•°æ®è®¡ç®—ä¸æ´¾ç”ŸçŠ¶æ€
- ç»„ä»¶ç»„åˆä¸æ‹†åˆ†
- æ€§èƒ½ä¼˜åŒ–æŠ€å·§
- ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- è¡¨å•éªŒè¯ä¸å¤„ç†
- React 19æ–°ç‰¹æ€§åº”ç”¨

## é¡¹ç›®æ¦‚è¿°

è´­ç‰©è½¦æ˜¯ç”µå•†åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæ¶µç›–äº†Reactå¼€å‘çš„å¤šä¸ªé‡è¦æ¦‚å¿µï¼š
- å•†å“åˆ—è¡¨å±•ç¤º
- è´­ç‰©è½¦çŠ¶æ€ç®¡ç†
- æ•°é‡å¢å‡æ§åˆ¶
- ä»·æ ¼è®¡ç®—
- ä¼˜æƒ åˆ¸å¤„ç†
- æœ¬åœ°å­˜å‚¨
- åŠ¨ç”»äº¤äº’

æˆ‘ä»¬å°†ä»åŸºç¡€ç‰ˆæœ¬é€æ­¥å®Œå–„åˆ°ç”Ÿäº§çº§åº”ç”¨ã€‚

## ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¡€è´­ç‰©è½¦

### 1.1 é¡¹ç›®ç»“æ„

```
shopping-cart/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ProductList.jsx
â”‚   â”œâ”€â”€ ProductCard.jsx
â”‚   â”œâ”€â”€ Cart.jsx
â”‚   â”œâ”€â”€ CartItem.jsx
â”‚   â””â”€â”€ CartSummary.jsx
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useCart.js
â”‚   â””â”€â”€ useLocalStorage.js
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ calculations.js
â””â”€â”€ App.jsx
```

### 1.2 åŸºç¡€å®ç°

```jsx
import { useState, useMemo } from 'react';

function BasicShoppingCart() {
  // å•†å“æ•°æ®
  const [products] = useState([
    { id: 1, name: 'iPhone 15 Pro', price: 7999, image: '/iphone.jpg', stock: 10 },
    { id: 2, name: 'MacBook Pro M3', price: 14999, image: '/macbook.jpg', stock: 5 },
    { id: 3, name: 'AirPods Pro', price: 1899, image: '/airpods.jpg', stock: 20 },
    { id: 4, name: 'iPad Air', price: 4799, image: '/ipad.jpg', stock: 15 },
    { id: 5, name: 'Apple Watch', price: 2999, image: '/watch.jpg', stock: 8 }
  ]);
  
  // è´­ç‰©è½¦æ•°æ®
  const [cartItems, setCartItems] = useState([]);
  
  // æ·»åŠ åˆ°è´­ç‰©è½¦
  const addToCart = (product) => {
    setCartItems(prev => {
      const existing = prev.find(item => item.id === product.id);
      
      if (existing) {
        // å·²å­˜åœ¨ï¼Œå¢åŠ æ•°é‡
        return prev.map(item =>
          item.id === product.id
            ? { ...item, quantity: item.quantity + 1 }
            : item
        );
      }
      
      // ä¸å­˜åœ¨ï¼Œæ·»åŠ æ–°é¡¹
      return [...prev, { ...product, quantity: 1 }];
    });
  };
  
  // ä»è´­ç‰©è½¦ç§»é™¤
  const removeFromCart = (productId) => {
    setCartItems(prev => prev.filter(item => item.id !== productId));
  };
  
  // æ›´æ–°æ•°é‡
  const updateQuantity = (productId, quantity) => {
    if (quantity <= 0) {
      removeFromCart(productId);
      return;
    }
    
    setCartItems(prev =>
      prev.map(item =>
        item.id === productId ? { ...item, quantity } : item
      )
    );
  };
  
  // æ¸…ç©ºè´­ç‰©è½¦
  const clearCart = () => {
    setCartItems([]);
  };
  
  // è®¡ç®—æ€»ä»·
  const total = useMemo(() => {
    return cartItems.reduce(
      (sum, item) => sum + item.price * item.quantity,
      0
    );
  }, [cartItems]);
  
  return (
    <div className="shopping-cart-app">
      <header>
        <h1>è´­ç‰©è½¦åº”ç”¨</h1>
        <div className="cart-badge">
          è´­ç‰©è½¦ ({cartItems.length})
        </div>
      </header>
      
      <div className="main-content">
        {/* å•†å“åˆ—è¡¨ */}
        <section className="products-section">
          <h2>å•†å“åˆ—è¡¨</h2>
          <div className="product-grid">
            {products.map(product => (
              <div key={product.id} className="product-card">
                <img src={product.image} alt={product.name} />
                <h3>{product.name}</h3>
                <p className="price">Â¥{product.price}</p>
                <p className="stock">åº“å­˜: {product.stock}</p>
                <button
                  onClick={() => addToCart(product)}
                  disabled={product.stock === 0}
                  className="add-to-cart-btn"
                >
                  åŠ å…¥è´­ç‰©è½¦
                </button>
              </div>
            ))}
          </div>
        </section>
        
        {/* è´­ç‰©è½¦ */}
        <section className="cart-section">
          <h2>è´­ç‰©è½¦</h2>
          
          {cartItems.length === 0 ? (
            <div className="empty-cart">
              <p>è´­ç‰©è½¦æ˜¯ç©ºçš„</p>
              <p>å¿«å»é€‰è´­å•†å“å§ï¼</p>
            </div>
          ) : (
            <>
              <div className="cart-items">
                {cartItems.map(item => (
                  <div key={item.id} className="cart-item">
                    <img src={item.image} alt={item.name} />
                    
                    <div className="item-info">
                      <h4>{item.name}</h4>
                      <p className="item-price">Â¥{item.price}</p>
                    </div>
                    
                    <div className="quantity-controls">
                      <button
                        onClick={() => updateQuantity(item.id, item.quantity - 1)}
                        className="qty-btn"
                      >
                        -
                      </button>
                      <input
                        type="number"
                        value={item.quantity}
                        onChange={(e) => updateQuantity(item.id, Number(e.target.value))}
                        min="1"
                        max={item.stock}
                        className="qty-input"
                      />
                      <button
                        onClick={() => updateQuantity(item.id, item.quantity + 1)}
                        disabled={item.quantity >= item.stock}
                        className="qty-btn"
                      >
                        +
                      </button>
                    </div>
                    
                    <div className="item-subtotal">
                      <p>å°è®¡</p>
                      <p className="subtotal-price">
                        Â¥{(item.price * item.quantity).toFixed(2)}
                      </p>
                    </div>
                    
                    <button
                      onClick={() => removeFromCart(item.id)}
                      className="remove-btn"
                    >
                      åˆ é™¤
                    </button>
                  </div>
                ))}
              </div>
              
              <div className="cart-summary">
                <div className="summary-row">
                  <span>å•†å“æ€»ä»·</span>
                  <span className="total-price">Â¥{total.toFixed(2)}</span>
                </div>
                
                <div className="cart-actions">
                  <button onClick={clearCart} className="clear-btn">
                    æ¸…ç©ºè´­ç‰©è½¦
                  </button>
                  <button className="checkout-btn">
                    å»ç»“ç®—
                  </button>
                </div>
              </div>
            </>
          )}
        </section>
      </div>
    </div>
  );
}

export default BasicShoppingCart;
```

## ç¬¬äºŒéƒ¨åˆ†ï¼šå¢å¼ºåŠŸèƒ½

### 2.1 æ·»åŠ ä¼˜æƒ åˆ¸åŠŸèƒ½

```jsx
function CartWithCoupon() {
  const [products] = useState([/* ... */]);
  const [cartItems, setCartItems] = useState([]);
  const [couponCode, setCouponCode] = useState('');
  const [appliedCoupon, setAppliedCoupon] = useState(null);
  
  // ä¼˜æƒ åˆ¸æ•°æ®åº“
  const coupons = {
    'SAVE10': { type: 'percentage', value: 0.1, minAmount: 0 },
    'SAVE20': { type: 'percentage', value: 0.2, minAmount: 1000 },
    'SAVE100': { type: 'fixed', value: 100, minAmount: 500 },
    'FREESHIP': { type: 'shipping', value: 0, minAmount: 0 }
  };
  
  // åº”ç”¨ä¼˜æƒ åˆ¸
  const applyCoupon = () => {
    const coupon = coupons[couponCode.toUpperCase()];
    
    if (coupon) {
      if (subtotal >= coupon.minAmount) {
        setAppliedCoupon({ code: couponCode, ...coupon });
      } else {
        alert(`æ­¤ä¼˜æƒ åˆ¸éœ€è¦æ»¡ Â¥${coupon.minAmount} æ‰èƒ½ä½¿ç”¨`);
      }
    } else {
      alert('ä¼˜æƒ åˆ¸æ— æ•ˆ');
    }
  };
  
  // ç§»é™¤ä¼˜æƒ åˆ¸
  const removeCoupon = () => {
    setAppliedCoupon(null);
    setCouponCode('');
  };
  
  // è®¡ç®—å°è®¡
  const subtotal = useMemo(() => {
    return cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0);
  }, [cartItems]);
  
  // è®¡ç®—ä¼˜æƒ é‡‘é¢
  const discount = useMemo(() => {
    if (!appliedCoupon) return 0;
    
    if (appliedCoupon.type === 'percentage') {
      return subtotal * appliedCoupon.value;
    } else if (appliedCoupon.type === 'fixed') {
      return appliedCoupon.value;
    }
    
    return 0;
  }, [appliedCoupon, subtotal]);
  
  // è®¡ç®—è¿è´¹
  const shipping = useMemo(() => {
    if (appliedCoupon?.type === 'shipping') return 0;
    if (subtotal >= 299) return 0;
    return 20;
  }, [subtotal, appliedCoupon]);
  
  // è®¡ç®—æ€»ä»·
  const total = subtotal - discount + shipping;
  
  return (
    <div className="shopping-cart">
      {/* å•†å“åˆ—è¡¨ */}
      <ProductList products={products} onAddToCart={addToCart} />
      
      {/* è´­ç‰©è½¦ */}
      <div className="cart">
        <CartItems items={cartItems} onUpdateQuantity={updateQuantity} onRemove={removeFromCart} />
        
        {/* ä¼˜æƒ åˆ¸åŒºåŸŸ */}
        <div className="coupon-section">
          <h3>ä¼˜æƒ åˆ¸</h3>
          <div className="coupon-input">
            <input
              type="text"
              value={couponCode}
              onChange={e => setCouponCode(e.target.value)}
              placeholder="è¾“å…¥ä¼˜æƒ åˆ¸ä»£ç "
              disabled={!!appliedCoupon}
            />
            {appliedCoupon ? (
              <button onClick={removeCoupon} className="remove-coupon-btn">
                ç§»é™¤
              </button>
            ) : (
              <button onClick={applyCoupon} className="apply-coupon-btn">
                åº”ç”¨
              </button>
            )}
          </div>
          
          {appliedCoupon && (
            <div className="applied-coupon">
              <span>å·²åº”ç”¨: {appliedCoupon.code}</span>
              <span className="discount-amount">
                -Â¥{discount.toFixed(2)}
              </span>
            </div>
          )}
          
          <div className="coupon-tips">
            <p>å¯ç”¨ä¼˜æƒ åˆ¸ï¼š</p>
            <ul>
              <li>SAVE10 - 9æŠ˜ä¼˜æƒ </li>
              <li>SAVE20 - 8æŠ˜ä¼˜æƒ ï¼ˆæ»¡Â¥1000ï¼‰</li>
              <li>SAVE100 - å‡Â¥100ï¼ˆæ»¡Â¥500ï¼‰</li>
              <li>FREESHIP - åŒ…é‚®</li>
            </ul>
          </div>
        </div>
        
        {/* ä»·æ ¼æ±‡æ€» */}
        <div className="price-summary">
          <div className="summary-row">
            <span>å•†å“å°è®¡</span>
            <span>Â¥{subtotal.toFixed(2)}</span>
          </div>
          
          {discount > 0 && (
            <div className="summary-row discount">
              <span>ä¼˜æƒ </span>
              <span>-Â¥{discount.toFixed(2)}</span>
            </div>
          )}
          
          <div className="summary-row">
            <span>è¿è´¹</span>
            <span>
              {shipping === 0 ? (
                <span className="free-shipping">å…è¿è´¹</span>
              ) : (
                `Â¥${shipping.toFixed(2)}`
              )}
            </span>
          </div>
          
          {subtotal > 0 && subtotal < 299 && shipping > 0 && (
            <div className="shipping-tip">
              å†è´­ä¹° Â¥{(299 - subtotal).toFixed(2)} å³å¯åŒ…é‚®
            </div>
          )}
          
          <div className="summary-row total">
            <span>åº”ä»˜æ€»é¢</span>
            <span className="total-price">Â¥{total.toFixed(2)}</span>
          </div>
        </div>
        
        <button className="checkout-btn" disabled={cartItems.length === 0}>
          å»ç»“ç®— ({cartItems.length})
        </button>
      </div>
    </div>
  );
}
```

### 2.2 æ·»åŠ æ”¶è—åŠŸèƒ½

```jsx
function CartWithWishlist() {
  const [products] = useState([/* ... */]);
  const [cartItems, setCartItems] = useState([]);
  const [wishlist, setWishlist] = useState([]);
  
  // æ·»åŠ åˆ°æ”¶è—
  const addToWishlist = (product) => {
    setWishlist(prev => {
      if (prev.find(item => item.id === product.id)) {
        return prev;  // å·²å­˜åœ¨
      }
      return [...prev, product];
    });
  };
  
  // ä»æ”¶è—ç§»é™¤
  const removeFromWishlist = (productId) => {
    setWishlist(prev => prev.filter(item => item.id !== productId));
  };
  
  // ä»æ”¶è—ç§»åˆ°è´­ç‰©è½¦
  const moveToCart = (product) => {
    addToCart(product);
    removeFromWishlist(product.id);
  };
  
  const isInWishlist = (productId) => {
    return wishlist.some(item => item.id === productId);
  };
  
  return (
    <div className="shopping-app">
      <nav>
        <span>è´­ç‰©è½¦ ({cartItems.length})</span>
        <span>æ”¶è— ({wishlist.length})</span>
      </nav>
      
      <ProductList
        products={products}
        onAddToCart={addToCart}
        onAddToWishlist={addToWishlist}
        isInWishlist={isInWishlist}
      />
      
      <Cart items={cartItems} />
      
      <Wishlist
        items={wishlist}
        onMoveToCart={moveToCart}
        onRemove={removeFromWishlist}
      />
    </div>
  );
}
```

### 2.3 æ·»åŠ æœç´¢å’Œç­›é€‰

```jsx
function CartWithFilter() {
  const [products] = useState([/* ... */]);
  const [cartItems, setCartItems] = useState([]);
  const [searchTerm, setSearchTerm] = useState('');
  const [category, setCategory] = useState('all');
  const [priceRange, setPriceRange] = useState({ min: 0, max: Infinity });
  const [sortBy, setSortBy] = useState('default');
  
  // è¿‡æ»¤å•†å“
  const filteredProducts = useMemo(() => {
    return products.filter(product => {
      // æœç´¢è¿‡æ»¤
      const matchesSearch = product.name
        .toLowerCase()
        .includes(searchTerm.toLowerCase());
      
      // åˆ†ç±»è¿‡æ»¤
      const matchesCategory = category === 'all' || product.category === category;
      
      // ä»·æ ¼è¿‡æ»¤
      const matchesPrice = product.price >= priceRange.min && 
                          product.price <= priceRange.max;
      
      return matchesSearch && matchesCategory && matchesPrice;
    });
  }, [products, searchTerm, category, priceRange]);
  
  // æ’åºå•†å“
  const sortedProducts = useMemo(() => {
    const sorted = [...filteredProducts];
    
    switch (sortBy) {
      case 'price-asc':
        return sorted.sort((a, b) => a.price - b.price);
      case 'price-desc':
        return sorted.sort((a, b) => b.price - a.price);
      case 'name':
        return sorted.sort((a, b) => a.name.localeCompare(b.name));
      default:
        return sorted;
    }
  }, [filteredProducts, sortBy]);
  
  return (
    <div className="shopping-cart">
      {/* æœç´¢å’Œç­›é€‰æ  */}
      <div className="filter-bar">
        <input
          type="text"
          value={searchTerm}
          onChange={e => setSearchTerm(e.target.value)}
          placeholder="æœç´¢å•†å“..."
          className="search-input"
        />
        
        <select value={category} onChange={e => setCategory(e.target.value)}>
          <option value="all">å…¨éƒ¨åˆ†ç±»</option>
          <option value="electronics">ç”µå­äº§å“</option>
          <option value="accessories">é…ä»¶</option>
          <option value="wearables">å¯ç©¿æˆ´</option>
        </select>
        
        <div className="price-filter">
          <input
            type="number"
            value={priceRange.min}
            onChange={e => setPriceRange(prev => ({ ...prev, min: Number(e.target.value) }))}
            placeholder="æœ€ä½ä»·"
          />
          <span>-</span>
          <input
            type="number"
            value={priceRange.max === Infinity ? '' : priceRange.max}
            onChange={e => setPriceRange(prev => ({ 
              ...prev, 
              max: e.target.value ? Number(e.target.value) : Infinity 
            }))}
            placeholder="æœ€é«˜ä»·"
          />
        </div>
        
        <select value={sortBy} onChange={e => setSortBy(e.target.value)}>
          <option value="default">é»˜è®¤æ’åº</option>
          <option value="price-asc">ä»·æ ¼å‡åº</option>
          <option value="price-desc">ä»·æ ¼é™åº</option>
          <option value="name">åç§°æ’åº</option>
        </select>
      </div>
      
      <p className="result-count">
        æ‰¾åˆ° {sortedProducts.length} ä¸ªå•†å“
      </p>
      
      <div className="product-grid">
        {sortedProducts.map(product => (
          <ProductCard
            key={product.id}
            product={product}
            onAddToCart={addToCart}
          />
        ))}
      </div>
      
      <Cart items={cartItems} />
    </div>
  );
}
```

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šé«˜çº§åŠŸèƒ½

### 3.1 æœ¬åœ°å­˜å‚¨æŒä¹…åŒ–

```jsx
// è‡ªå®šä¹‰Hook: useLocalStorage
function useLocalStorage(key, initialValue) {
  const [storedValue, setStoredValue] = useState(() => {
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      console.error('è¯»å–localStorageå¤±è´¥:', error);
      return initialValue;
    }
  });
  
  const setValue = (value) => {
    try {
      const valueToStore = value instanceof Function ? value(storedValue) : value;
      setStoredValue(valueToStore);
      window.localStorage.setItem(key, JSON.stringify(valueToStore));
    } catch (error) {
      console.error('å†™å…¥localStorageå¤±è´¥:', error);
    }
  };
  
  return [storedValue, setValue];
}

// ä½¿ç”¨æŒä¹…åŒ–
function PersistentCart() {
  const [products] = useState([/* ... */]);
  const [cartItems, setCartItems] = useLocalStorage('shopping-cart', []);
  const [wishlist, setWishlist] = useLocalStorage('wishlist', []);
  
  // æ·»åŠ åŒæ­¥æç¤º
  const [lastSaved, setLastSaved] = useState(null);
  
  useEffect(() => {
    setLastSaved(new Date());
  }, [cartItems, wishlist]);
  
  return (
    <div>
      {lastSaved && (
        <div className="save-indicator">
          æœ€åä¿å­˜: {lastSaved.toLocaleTimeString()}
        </div>
      )}
      
      <ProductList products={products} onAddToCart={addToCart} />
      <Cart items={cartItems} />
      <Wishlist items={wishlist} />
    </div>
  );
}
```

### 3.2 åº“å­˜ç®¡ç†

```jsx
function CartWithStockManagement() {
  const [products, setProducts] = useState([
    { id: 1, name: 'Product 1', price: 100, stock: 10 },
    { id: 2, name: 'Product 2', price: 200, stock: 5 },
    { id: 3, name: 'Product 3', price: 300, stock: 0 }
  ]);
  
  const [cartItems, setCartItems] = useState([]);
  
  // æ£€æŸ¥åº“å­˜
  const checkStock = (productId, quantity) => {
    const product = products.find(p => p.id === productId);
    return product && product.stock >= quantity;
  };
  
  // æ·»åŠ åˆ°è´­ç‰©è½¦ï¼ˆæ£€æŸ¥åº“å­˜ï¼‰
  const addToCart = (product) => {
    setCartItems(prev => {
      const existing = prev.find(item => item.id === product.id);
      const newQuantity = existing ? existing.quantity + 1 : 1;
      
      // æ£€æŸ¥åº“å­˜
      if (!checkStock(product.id, newQuantity)) {
        alert('åº“å­˜ä¸è¶³');
        return prev;
      }
      
      if (existing) {
        return prev.map(item =>
          item.id === product.id
            ? { ...item, quantity: item.quantity + 1 }
            : item
        );
      }
      
      return [...prev, { ...product, quantity: 1 }];
    });
  };
  
  // æ›´æ–°æ•°é‡ï¼ˆæ£€æŸ¥åº“å­˜ï¼‰
  const updateQuantity = (productId, quantity) => {
    if (quantity <= 0) {
      removeFromCart(productId);
      return;
    }
    
    if (!checkStock(productId, quantity)) {
      alert('åº“å­˜ä¸è¶³');
      return;
    }
    
    setCartItems(prev =>
      prev.map(item =>
        item.id === productId ? { ...item, quantity } : item
      )
    );
  };
  
  // è·å–å¯ç”¨åº“å­˜
  const getAvailableStock = (productId) => {
    const product = products.find(p => p.id === productId);
    const cartItem = cartItems.find(item => item.id === productId);
    
    if (!product) return 0;
    
    return product.stock - (cartItem ? cartItem.quantity : 0);
  };
  
  return (
    <div>
      {/* å•†å“åˆ—è¡¨ */}
      {products.map(product => {
        const availableStock = getAvailableStock(product.id);
        const inCart = cartItems.find(item => item.id === product.id);
        
        return (
          <div key={product.id} className="product-card">
            <h3>{product.name}</h3>
            <p>Â¥{product.price}</p>
            <p>åº“å­˜: {availableStock}</p>
            {inCart && <p className="in-cart">è´­ç‰©è½¦ä¸­: {inCart.quantity}</p>}
            <button
              onClick={() => addToCart(product)}
              disabled={availableStock === 0}
            >
              {availableStock === 0 ? 'ç¼ºè´§' : 'åŠ å…¥è´­ç‰©è½¦'}
            </button>
          </div>
        );
      })}
      
      {/* è´­ç‰©è½¦ */}
      <Cart
        items={cartItems}
        onUpdateQuantity={updateQuantity}
        getAvailableStock={getAvailableStock}
      />
    </div>
  );
}
```

### 3.3 ç»“ç®—æµç¨‹

```jsx
function CheckoutProcess() {
  const [cartItems, setCartItems] = useState([]);
  const [step, setStep] = useState(1);  // 1:è´­ç‰©è½¦ 2:åœ°å€ 3:æ”¯ä»˜ 4:å®Œæˆ
  const [shippingInfo, setShippingInfo] = useState({
    name: '',
    phone: '',
    address: '',
    city: '',
    zipCode: ''
  });
  const [paymentMethod, setPaymentMethod] = useState('alipay');
  
  const total = useMemo(() => {
    return cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0);
  }, [cartItems]);
  
  // éªŒè¯é…é€ä¿¡æ¯
  const validateShipping = () => {
    const { name, phone, address, city, zipCode } = shippingInfo;
    
    if (!name || !phone || !address || !city || !zipCode) {
      alert('è¯·å¡«å†™å®Œæ•´çš„é…é€ä¿¡æ¯');
      return false;
    }
    
    if (!/^1[3-9]\d{9}$/.test(phone)) {
      alert('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·');
      return false;
    }
    
    return true;
  };
  
  // ä¸‹ä¸€æ­¥
  const nextStep = () => {
    if (step === 1 && cartItems.length === 0) {
      alert('è´­ç‰©è½¦æ˜¯ç©ºçš„');
      return;
    }
    
    if (step === 2 && !validateShipping()) {
      return;
    }
    
    setStep(s => s + 1);
  };
  
  // ä¸Šä¸€æ­¥
  const prevStep = () => {
    setStep(s => Math.max(1, s - 1));
  };
  
  // æäº¤è®¢å•
  const submitOrder = async () => {
    try {
      const order = {
        items: cartItems,
        shippingInfo,
        paymentMethod,
        total
      };
      
      // æ¨¡æ‹ŸAPIè°ƒç”¨
      await new Promise(resolve => setTimeout(resolve, 1000));
      console.log('è®¢å•å·²æäº¤:', order);
      
      // æ¸…ç©ºè´­ç‰©è½¦
      setCartItems([]);
      setStep(4);
    } catch (error) {
      alert('è®¢å•æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•');
    }
  };
  
  return (
    <div className="checkout-process">
      {/* æ­¥éª¤æŒ‡ç¤ºå™¨ */}
      <div className="steps">
        <div className={`step ${step >= 1 ? 'active' : ''}`}>
          1. è´­ç‰©è½¦
        </div>
        <div className={`step ${step >= 2 ? 'active' : ''}`}>
          2. é…é€ä¿¡æ¯
        </div>
        <div className={`step ${step >= 3 ? 'active' : ''}`}>
          3. æ”¯ä»˜æ–¹å¼
        </div>
        <div className={`step ${step >= 4 ? 'active' : ''}`}>
          4. å®Œæˆ
        </div>
      </div>
      
      {/* æ­¥éª¤å†…å®¹ */}
      <div className="step-content">
        {step === 1 && (
          <CartStep items={cartItems} onUpdateItems={setCartItems} />
        )}
        
        {step === 2 && (
          <ShippingStep
            shippingInfo={shippingInfo}
            onUpdate={setShippingInfo}
          />
        )}
        
        {step === 3 && (
          <PaymentStep
            paymentMethod={paymentMethod}
            onSelect={setPaymentMethod}
            total={total}
          />
        )}
        
        {step === 4 && (
          <CompletionStep />
        )}
      </div>
      
      {/* å¯¼èˆªæŒ‰é’® */}
      <div className="navigation">
        {step > 1 && step < 4 && (
          <button onClick={prevStep} className="prev-btn">
            ä¸Šä¸€æ­¥
          </button>
        )}
        
        {step < 3 && (
          <button onClick={nextStep} className="next-btn">
            ä¸‹ä¸€æ­¥
          </button>
        )}
        
        {step === 3 && (
          <button onClick={submitOrder} className="submit-btn">
            æäº¤è®¢å•
          </button>
        )}
      </div>
    </div>
  );
}

// é…é€ä¿¡æ¯æ­¥éª¤
function ShippingStep({ shippingInfo, onUpdate }) {
  const handleChange = (field) => (e) => {
    onUpdate(prev => ({
      ...prev,
      [field]: e.target.value
    }));
  };
  
  return (
    <div className="shipping-form">
      <h2>é…é€ä¿¡æ¯</h2>
      
      <div className="form-group">
        <label>æ”¶è´§äºº</label>
        <input
          value={shippingInfo.name}
          onChange={handleChange('name')}
          placeholder="è¯·è¾“å…¥æ”¶è´§äººå§“å"
        />
      </div>
      
      <div className="form-group">
        <label>æ‰‹æœºå·</label>
        <input
          value={shippingInfo.phone}
          onChange={handleChange('phone')}
          placeholder="è¯·è¾“å…¥æ‰‹æœºå·"
        />
      </div>
      
      <div className="form-group">
        <label>è¯¦ç»†åœ°å€</label>
        <textarea
          value={shippingInfo.address}
          onChange={handleChange('address')}
          placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€"
          rows={3}
        />
      </div>
      
      <div className="form-row">
        <div className="form-group">
          <label>åŸå¸‚</label>
          <input
            value={shippingInfo.city}
            onChange={handleChange('city')}
            placeholder="åŸå¸‚"
          />
        </div>
        
        <div className="form-group">
          <label>é‚®ç¼–</label>
          <input
            value={shippingInfo.zipCode}
            onChange={handleChange('zipCode')}
            placeholder="é‚®ç¼–"
          />
        </div>
      </div>
    </div>
  );
}

// æ”¯ä»˜æ–¹å¼æ­¥éª¤
function PaymentStep({ paymentMethod, onSelect, total }) {
  const paymentMethods = [
    { id: 'alipay', name: 'æ”¯ä»˜å®', icon: 'ğŸ’°' },
    { id: 'wechat', name: 'å¾®ä¿¡æ”¯ä»˜', icon: 'ğŸ’š' },
    { id: 'card', name: 'é“¶è¡Œå¡', icon: 'ğŸ’³' }
  ];
  
  return (
    <div className="payment-step">
      <h2>é€‰æ‹©æ”¯ä»˜æ–¹å¼</h2>
      
      <div className="payment-methods">
        {paymentMethods.map(method => (
          <div
            key={method.id}
            className={`payment-method ${paymentMethod === method.id ? 'selected' : ''}`}
            onClick={() => onSelect(method.id)}
          >
            <span className="icon">{method.icon}</span>
            <span className="name">{method.name}</span>
            {paymentMethod === method.id && <span className="check">âœ“</span>}
          </div>
        ))}
      </div>
      
      <div className="payment-summary">
        <h3>è®¢å•é‡‘é¢</h3>
        <p className="total">Â¥{total.toFixed(2)}</p>
      </div>
    </div>
  );
}

// å®Œæˆæ­¥éª¤
function CompletionStep() {
  return (
    <div className="completion-step">
      <div className="success-icon">âœ“</div>
      <h2>è®¢å•æäº¤æˆåŠŸï¼</h2>
      <p>æˆ‘ä»¬ä¼šå°½å¿«ä¸ºæ‚¨å‘è´§</p>
      <button className="continue-btn">
        ç»§ç»­è´­ç‰©
      </button>
    </div>
  );
}
```

## ç¬¬å››éƒ¨åˆ†ï¼šç»„ä»¶æ‹†åˆ†

### 4.1 ProductCardç»„ä»¶

```jsx
const ProductCard = React.memo(function ProductCard({ 
  product, 
  onAddToCart,
  onAddToWishlist,
  isInWishlist 
}) {
  const [isHovered, setIsHovered] = useState(false);
  
  const handleAddToCart = useCallback(() => {
    onAddToCart(product);
  }, [product, onAddToCart]);
  
  const handleWishlist = useCallback(() => {
    onAddToWishlist(product);
  }, [product, onAddToWishlist]);
  
  return (
    <div
      className="product-card"
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setIsHovered(false)}
    >
      <div className="product-image">
        <img src={product.image} alt={product.name} />
        
        {isHovered && (
          <div className="quick-view">
            <button className="wishlist-btn" onClick={handleWishlist}>
              {isInWishlist ? 'â¤ï¸' : 'ğŸ¤'}
            </button>
          </div>
        )}
        
        {product.stock === 0 && (
          <div className="out-of-stock">ç¼ºè´§</div>
        )}
        
        {product.discount && (
          <div className="discount-badge">
            -{product.discount}%
          </div>
        )}
      </div>
      
      <div className="product-info">
        <h3 className="product-name">{product.name}</h3>
        <p className="product-description">{product.description}</p>
        
        <div className="product-footer">
          <div className="price-section">
            {product.discount ? (
              <>
                <span className="original-price">
                  Â¥{product.price}
                </span>
                <span className="sale-price">
                  Â¥{(product.price * (1 - product.discount / 100)).toFixed(2)}
                </span>
              </>
            ) : (
              <span className="price">Â¥{product.price}</span>
            )}
          </div>
          
          <button
            onClick={handleAddToCart}
            disabled={product.stock === 0}
            className="add-to-cart-btn"
          >
            {product.stock === 0 ? 'ç¼ºè´§' : 'åŠ å…¥è´­ç‰©è½¦'}
          </button>
        </div>
      </div>
    </div>
  );
});

export default ProductCard;
```

### 4.2 CartItemç»„ä»¶

```jsx
const CartItem = React.memo(function CartItem({ 
  item, 
  onUpdateQuantity, 
  onRemove,
  getAvailableStock 
}) {
  const [quantity, setQuantity] = useState(item.quantity);
  const [isEditing, setIsEditing] = useState(false);
  
  // ç«‹å³æ›´æ–°æ•°é‡
  const handleIncrement = useCallback(() => {
    const availableStock = getAvailableStock(item.id);
    if (quantity < item.stock && quantity < availableStock + item.quantity) {
      const newQty = quantity + 1;
      setQuantity(newQty);
      onUpdateQuantity(item.id, newQty);
    }
  }, [item.id, item.stock, quantity, getAvailableStock, onUpdateQuantity]);
  
  const handleDecrement = useCallback(() => {
    if (quantity > 1) {
      const newQty = quantity - 1;
      setQuantity(newQty);
      onUpdateQuantity(item.id, newQty);
    }
  }, [item.id, quantity, onUpdateQuantity]);
  
  // æ‰‹åŠ¨è¾“å…¥æ•°é‡
  const handleInputChange = (e) => {
    const value = parseInt(e.target.value) || 1;
    setQuantity(value);
  };
  
  const handleInputBlur = () => {
    const validQuantity = Math.max(1, Math.min(quantity, item.stock));
    setQuantity(validQuantity);
    onUpdateQuantity(item.id, validQuantity);
    setIsEditing(false);
  };
  
  const handleRemove = useCallback(() => {
    onRemove(item.id);
  }, [item.id, onRemove]);
  
  const subtotal = item.price * item.quantity;
  
  return (
    <div className="cart-item">
      <div className="item-image">
        <img src={item.image} alt={item.name} />
      </div>
      
      <div className="item-details">
        <h4>{item.name}</h4>
        <p className="item-specs">{item.specs}</p>
        <p className="unit-price">å•ä»·: Â¥{item.price}</p>
      </div>
      
      <div className="quantity-control">
        <button
          onClick={handleDecrement}
          disabled={quantity <= 1}
          className="qty-btn"
        >
          -
        </button>
        
        {isEditing ? (
          <input
            type="number"
            value={quantity}
            onChange={handleInputChange}
            onBlur={handleInputBlur}
            onKeyPress={e => e.key === 'Enter' && handleInputBlur()}
            autoFocus
            className="qty-input-edit"
          />
        ) : (
          <span
            className="qty-display"
            onClick={() => setIsEditing(true)}
          >
            {quantity}
          </span>
        )}
        
        <button
          onClick={handleIncrement}
          disabled={quantity >= item.stock}
          className="qty-btn"
        >
          +
        </button>
      </div>
      
      <div className="item-subtotal">
        <p className="subtotal-label">å°è®¡</p>
        <p className="subtotal-price">Â¥{subtotal.toFixed(2)}</p>
      </div>
      
      <button onClick={handleRemove} className="remove-btn">
        åˆ é™¤
      </button>
    </div>
  );
});

export default CartItem;
```

### 4.3 CartSummaryç»„ä»¶

```jsx
const CartSummary = React.memo(function CartSummary({ 
  subtotal, 
  discount, 
  shipping, 
  total,
  onCheckout,
  onClearCart 
}) {
  return (
    <div className="cart-summary">
      <h3>ä»·æ ¼æ˜ç»†</h3>
      
      <div className="summary-details">
        <div className="summary-row">
          <span>å•†å“é‡‘é¢</span>
          <span>Â¥{subtotal.toFixed(2)}</span>
        </div>
        
        {discount > 0 && (
          <div className="summary-row discount-row">
            <span>ä¼˜æƒ é‡‘é¢</span>
            <span className="discount-amount">-Â¥{discount.toFixed(2)}</span>
          </div>
        )}
        
        <div className="summary-row">
          <span>è¿è´¹</span>
          <span>
            {shipping === 0 ? (
              <span className="free-shipping">åŒ…é‚®</span>
            ) : (
              `Â¥${shipping.toFixed(2)}`
            )}
          </span>
        </div>
        
        <div className="summary-divider"></div>
        
        <div className="summary-row total-row">
          <span>åº”ä»˜æ€»é¢</span>
          <span className="total-amount">Â¥{total.toFixed(2)}</span>
        </div>
      </div>
      
      <div className="summary-actions">
        <button onClick={onClearCart} className="clear-cart-btn">
          æ¸…ç©ºè´­ç‰©è½¦
        </button>
        <button onClick={onCheckout} className="checkout-btn">
          å»ç»“ç®—
        </button>
      </div>
    </div>
  );
});

export default CartSummary;
```

## ç¬¬äº”éƒ¨åˆ†ï¼šæ€§èƒ½ä¼˜åŒ–

### 5.1 ä½¿ç”¨useCallbackå’Œmemo

```jsx
function OptimizedCart() {
  const [products] = useState([/* ... */]);
  const [cartItems, setCartItems] = useState([]);
  
  // ç¼“å­˜æ‰€æœ‰å›è°ƒå‡½æ•°
  const addToCart = useCallback((product) => {
    setCartItems(prev => {
      const existing = prev.find(item => item.id === product.id);
      if (existing) {
        return prev.map(item =>
          item.id === product.id
            ? { ...item, quantity: item.quantity + 1 }
            : item
        );
      }
      return [...prev, { ...product, quantity: 1 }];
    });
  }, []);
  
  const updateQuantity = useCallback((id, quantity) => {
    setCartItems(prev =>
      prev.map(item =>
        item.id === id ? { ...item, quantity } : item
      )
    );
  }, []);
  
  const removeItem = useCallback((id) => {
    setCartItems(prev => prev.filter(item => item.id !== id));
  }, []);
  
  const clearCart = useCallback(() => {
    setCartItems([]);
  }, []);
  
  // ç¼“å­˜è®¡ç®—ç»“æœ
  const totals = useMemo(() => {
    const subtotal = cartItems.reduce(
      (sum, item) => sum + item.price * item.quantity,
      0
    );
    const shipping = subtotal >= 299 ? 0 : 20;
    const total = subtotal + shipping;
    
    return { subtotal, shipping, total };
  }, [cartItems]);
  
  return (
    <div>
      <MemoProductList products={products} onAddToCart={addToCart} />
      <MemoCart
        items={cartItems}
        onUpdateQuantity={updateQuantity}
        onRemove={removeItem}
        onClear={clearCart}
        totals={totals}
      />
    </div>
  );
}

const MemoProductList = React.memo(function ProductList({ products, onAddToCart }) {
  console.log('ProductListæ¸²æŸ“');
  
  return (
    <div className="product-grid">
      {products.map(product => (
        <MemoProductCard
          key={product.id}
          product={product}
          onAddToCart={onAddToCart}
        />
      ))}
    </div>
  );
});

const MemoProductCard = React.memo(function ProductCard({ product, onAddToCart }) {
  console.log('ProductCardæ¸²æŸ“:', product.id);
  
  const handleClick = useCallback(() => {
    onAddToCart(product);
  }, [product, onAddToCart]);
  
  return (
    <div className="product-card">
      <img src={product.image} alt={product.name} />
      <h3>{product.name}</h3>
      <p>Â¥{product.price}</p>
      <button onClick={handleClick}>åŠ å…¥è´­ç‰©è½¦</button>
    </div>
  );
});

const MemoCart = React.memo(function Cart({ 
  items, 
  onUpdateQuantity, 
  onRemove, 
  onClear,
  totals 
}) {
  console.log('Cartæ¸²æŸ“');
  
  return (
    <div className="cart">
      {items.map(item => (
        <MemoCartItem
          key={item.id}
          item={item}
          onUpdateQuantity={onUpdateQuantity}
          onRemove={onRemove}
        />
      ))}
      
      <CartSummary
        subtotal={totals.subtotal}
        shipping={totals.shipping}
        total={totals.total}
        onClear={onClear}
      />
    </div>
  );
});

const MemoCartItem = React.memo(function CartItem({ item, onUpdateQuantity, onRemove }) {
  console.log('CartItemæ¸²æŸ“:', item.id);
  
  const handleUpdate = useCallback((newQuantity) => {
    onUpdateQuantity(item.id, newQuantity);
  }, [item.id, onUpdateQuantity]);
  
  const handleRemove = useCallback(() => {
    onRemove(item.id);
  }, [item.id, onRemove]);
  
  return (
    <div className="cart-item">
      <img src={item.image} alt={item.name} />
      <div className="item-info">
        <h4>{item.name}</h4>
        <p>Â¥{item.price}</p>
      </div>
      <div className="quantity">
        <button onClick={() => handleUpdate(item.quantity - 1)}>-</button>
        <span>{item.quantity}</span>
        <button onClick={() => handleUpdate(item.quantity + 1)}>+</button>
      </div>
      <div className="subtotal">
        Â¥{(item.price * item.quantity).toFixed(2)}
      </div>
      <button onClick={handleRemove}>åˆ é™¤</button>
    </div>
  );
});
```

### 5.2 è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–

```jsx
import { FixedSizeList } from 'react-window';

function VirtualizedProductList({ products, onAddToCart }) {
  const Row = useCallback(({ index, style }) => {
    const product = products[index];
    
    return (
      <div style={style}>
        <MemoProductCard
          product={product}
          onAddToCart={onAddToCart}
        />
      </div>
    );
  }, [products, onAddToCart]);
  
  return (
    <FixedSizeList
      height={800}
      itemCount={products.length}
      itemSize={250}
      width="100%"
    >
      {Row}
    </FixedSizeList>
  );
}
```

## ç¬¬å…­éƒ¨åˆ†ï¼šç”¨æˆ·ä½“éªŒä¼˜åŒ–

### 6.1 åŠ è½½çŠ¶æ€

```jsx
function CartWithLoading() {
  const [products, setProducts] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    fetchProducts()
      .then(data => {
        setProducts(data);
        setLoading(false);
      })
      .catch(err => {
        setError(err.message);
        setLoading(false);
      });
  }, []);
  
  if (loading) {
    return (
      <div className="loading-state">
        <div className="spinner"></div>
        <p>åŠ è½½ä¸­...</p>
      </div>
    );
  }
  
  if (error) {
    return (
      <div className="error-state">
        <p>åŠ è½½å¤±è´¥: {error}</p>
        <button onClick={() => window.location.reload()}>
          é‡è¯•
        </button>
      </div>
    );
  }
  
  return <ShoppingCart products={products} />;
}
```

### 6.2 æ·»åŠ åŠ¨ç”»æ•ˆæœ

```jsx
import { useTransition, animated } from 'react-spring';

function AnimatedCart() {
  const [cartItems, setCartItems] = useState([]);
  
  // åˆ—è¡¨åŠ¨ç”»
  const transitions = useTransition(cartItems, {
    keys: item => item.id,
    from: { opacity: 0, transform: 'translateX(100%)' },
    enter: { opacity: 1, transform: 'translateX(0%)' },
    leave: { opacity: 0, transform: 'translateX(-100%)' }
  });
  
  return (
    <div className="cart">
      {transitions((style, item) => (
        <animated.div style={style}>
          <CartItem item={item} />
        </animated.div>
      ))}
    </div>
  );
}
```

### 6.3 æ·»åŠ æç¤ºä¿¡æ¯

```jsx
function CartWithToast() {
  const [cartItems, setCartItems] = useState([]);
  const [toast, setToast] = useState(null);
  
  // æ˜¾ç¤ºæç¤º
  const showToast = (message, type = 'success') => {
    setToast({ message, type });
    setTimeout(() => setToast(null), 3000);
  };
  
  // æ·»åŠ åˆ°è´­ç‰©è½¦ï¼ˆå¸¦æç¤ºï¼‰
  const addToCart = (product) => {
    setCartItems(prev => {
      const existing = prev.find(item => item.id === product.id);
      
      if (existing) {
        showToast(`${product.name} æ•°é‡å·²å¢åŠ `);
        return prev.map(item =>
          item.id === product.id
            ? { ...item, quantity: item.quantity + 1 }
            : item
        );
      }
      
      showToast(`${product.name} å·²åŠ å…¥è´­ç‰©è½¦`, 'success');
      return [...prev, { ...product, quantity: 1 }];
    });
  };
  
  // åˆ é™¤å•†å“ï¼ˆå¸¦ç¡®è®¤ï¼‰
  const removeFromCart = (productId) => {
    const item = cartItems.find(i => i.id === productId);
    
    if (confirm(`ç¡®å®šè¦åˆ é™¤ ${item.name} å—ï¼Ÿ`)) {
      setCartItems(prev => prev.filter(i => i.id !== productId));
      showToast(`${item.name} å·²ä»è´­ç‰©è½¦ç§»é™¤`, 'info');
    }
  };
  
  return (
    <div>
      {toast && (
        <div className={`toast toast-${toast.type}`}>
          {toast.message}
        </div>
      )}
      
      <ProductList products={products} onAddToCart={addToCart} />
      <Cart items={cartItems} onRemove={removeFromCart} />
    </div>
  );
}
```

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šReact 19ç‰ˆæœ¬

### 7.1 ä½¿ç”¨Server Actions

```jsx
// app/actions/cart.js
'use server';

import { revalidatePath } from 'next/cache';

export async function addToCart(userId, productId, quantity = 1) {
  await db.cart.upsert({
    where: { userId_productId: { userId, productId } },
    update: { quantity: { increment: quantity } },
    create: { userId, productId, quantity }
  });
  
  revalidatePath('/cart');
  return { success: true };
}

export async function updateCartItem(userId, productId, quantity) {
  if (quantity <= 0) {
    await db.cart.delete({
      where: { userId_productId: { userId, productId } }
    });
  } else {
    await db.cart.update({
      where: { userId_productId: { userId, productId } },
      data: { quantity }
    });
  }
  
  revalidatePath('/cart');
  return { success: true };
}

export async function clearCart(userId) {
  await db.cart.deleteMany({
    where: { userId }
  });
  
  revalidatePath('/cart');
  return { success: true };
}

// app/components/Cart.jsx
'use client';

import { useOptimistic, useTransition } from 'react';
import { addToCart, updateCartItem, clearCart } from '../actions/cart';

function ServerCart({ userId, initialItems }) {
  const [isPending, startTransition] = useTransition();
  const [optimisticItems, updateOptimistic] = useOptimistic(
    initialItems,
    (state, { action, productId, quantity, product }) => {
      switch (action) {
        case 'add':
          const existing = state.find(item => item.id === productId);
          if (existing) {
            return state.map(item =>
              item.id === productId
                ? { ...item, quantity: item.quantity + 1 }
                : item
            );
          }
          return [...state, { ...product, quantity: 1 }];
          
        case 'update':
          if (quantity <= 0) {
            return state.filter(item => item.id !== productId);
          }
          return state.map(item =>
            item.id === productId ? { ...item, quantity } : item
          );
          
        case 'clear':
          return [];
          
        default:
          return state;
      }
    }
  );
  
  const handleAddToCart = async (product) => {
    startTransition(async () => {
      updateOptimistic({ action: 'add', productId: product.id, product });
      await addToCart(userId, product.id);
    });
  };
  
  const handleUpdateQuantity = async (productId, quantity) => {
    startTransition(async () => {
      updateOptimistic({ action: 'update', productId, quantity });
      await updateCartItem(userId, productId, quantity);
    });
  };
  
  const handleClearCart = async () => {
    startTransition(async () => {
      updateOptimistic({ action: 'clear' });
      await clearCart(userId);
    });
  };
  
  return (
    <div className="cart">
      {isPending && <div className="loading-overlay">å¤„ç†ä¸­...</div>}
      
      <CartItems
        items={optimisticItems}
        onUpdateQuantity={handleUpdateQuantity}
      />
      
      <button onClick={handleClearCart} disabled={isPending}>
        æ¸…ç©ºè´­ç‰©è½¦
      </button>
    </div>
  );
}
```

### 7.2 ä½¿ç”¨useActionState

```jsx
'use client';

import { useActionState } from 'react';
import { checkout } from '../actions/checkout';

function CheckoutForm({ cartItems }) {
  const [state, formAction, isPending] = useActionState(checkout, null);
  
  return (
    <form action={formAction}>
      <h2>ç»“ç®—</h2>
      
      <div className="order-summary">
        {cartItems.map(item => (
          <div key={item.id}>
            <span>{item.name} x {item.quantity}</span>
            <span>Â¥{(item.price * item.quantity).toFixed(2)}</span>
          </div>
        ))}
      </div>
      
      <div className="shipping-form">
        <input name="name" placeholder="æ”¶è´§äºº" required />
        <input name="phone" placeholder="æ‰‹æœºå·" required />
        <textarea name="address" placeholder="è¯¦ç»†åœ°å€" required />
      </div>
      
      <button type="submit" disabled={isPending}>
        {isPending ? 'æäº¤ä¸­...' : 'æäº¤è®¢å•'}
      </button>
      
      {state?.success && (
        <div className="success-message">
          è®¢å•æäº¤æˆåŠŸï¼è®¢å•å·: {state.orderId}
        </div>
      )}
      
      {state?.error && (
        <div className="error-message">
          {state.error}
        </div>
      )}
    </form>
  );
}
```

## ç¬¬å…«éƒ¨åˆ†ï¼šå®Œæ•´æ ·å¼

```css
/* ShoppingCart.css */
.shopping-cart-app {
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 0;
  border-bottom: 2px solid #eee;
}

.cart-badge {
  padding: 10px 20px;
  background: #007bff;
  color: white;
  border-radius: 20px;
}

.main-content {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 30px;
  margin-top: 30px;
}

/* å•†å“åˆ—è¡¨ */
.product-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 20px;
}

.product-card {
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 15px;
  transition: transform 0.2s, box-shadow 0.2s;
  position: relative;
}

.product-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.product-image {
  position: relative;
  width: 100%;
  height: 200px;
  overflow: hidden;
  border-radius: 4px;
  margin-bottom: 15px;
}

.product-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.discount-badge {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #e74c3c;
  color: white;
  padding: 5px 10px;
  border-radius: 4px;
  font-weight: bold;
}

.out-of-stock {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 10px 20px;
  border-radius: 4px;
}

.product-name {
  font-size: 16px;
  margin: 10px 0;
  font-weight: 600;
}

.price {
  font-size: 24px;
  color: #e74c3c;
  font-weight: bold;
  margin: 10px 0;
}

.add-to-cart-btn {
  width: 100%;
  padding: 12px;
  background: #28a745;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 16px;
  cursor: pointer;
  transition: background 0.2s;
}

.add-to-cart-btn:hover {
  background: #218838;
}

.add-to-cart-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
}

/* è´­ç‰©è½¦ */
.cart-section {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
  position: sticky;
  top: 20px;
  max-height: calc(100vh - 40px);
  overflow-y: auto;
}

.empty-cart {
  text-align: center;
  padding: 60px 20px;
  color: #999;
}

.cart-items {
  margin-bottom: 20px;
}

.cart-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 15px;
  background: white;
  border-radius: 8px;
  margin-bottom: 15px;
}

.cart-item img {
  width: 80px;
  height: 80px;
  object-fit: cover;
  border-radius: 4px;
}

.item-info {
  flex: 1;
}

.item-info h4 {
  margin: 0 0 5px;
  font-size: 16px;
}

.item-price {
  color: #e74c3c;
  font-weight: bold;
}

.quantity-controls {
  display: flex;
  align-items: center;
  gap: 10px;
}

.qty-btn {
  width: 30px;
  height: 30px;
  border: 1px solid #ddd;
  background: white;
  border-radius: 4px;
  cursor: pointer;
  font-size: 18px;
}

.qty-btn:hover {
  background: #f0f0f0;
}

.qty-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.qty-input {
  width: 50px;
  text-align: center;
  border: 1px solid #ddd;
  border-radius: 4px;
  padding: 5px;
}

.item-subtotal {
  text-align: right;
  min-width: 100px;
}

.subtotal-price {
  font-weight: bold;
  font-size: 18px;
  color: #e74c3c;
}

.remove-btn {
  padding: 8px 16px;
  background: #dc3545;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

/* ä»·æ ¼æ±‡æ€» */
.price-summary {
  background: white;
  padding: 20px;
  border-radius: 8px;
  margin-top: 20px;
}

.summary-row {
  display: flex;
  justify-content: space-between;
  padding: 10px 0;
}

.summary-row.discount-row {
  color: #28a745;
}

.summary-row.total-row {
  font-size: 20px;
  font-weight: bold;
  border-top: 2px solid #eee;
  margin-top: 10px;
  padding-top: 15px;
}

.total-price {
  color: #e74c3c;
}

.free-shipping {
  color: #28a745;
  font-weight: bold;
}

.shipping-tip {
  background: #fff3cd;
  padding: 10px;
  border-radius: 4px;
  margin: 10px 0;
  text-align: center;
  font-size: 14px;
}

/* æ“ä½œæŒ‰é’® */
.cart-actions {
  display: flex;
  gap: 10px;
  margin-top: 20px;
}

.clear-cart-btn {
  flex: 1;
  padding: 15px;
  background: #6c757d;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.checkout-btn {
  flex: 2;
  padding: 15px;
  background: #28a745;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
}

.checkout-btn:hover {
  background: #218838;
}

.checkout-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
}

/* ä¼˜æƒ åˆ¸ */
.coupon-section {
  background: white;
  padding: 20px;
  border-radius: 8px;
  margin: 20px 0;
}

.coupon-input {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
}

.coupon-input input {
  flex: 1;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.apply-coupon-btn {
  padding: 10px 20px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.applied-coupon {
  display: flex;
  justify-content: space-between;
  background: #d4edda;
  padding: 10px;
  border-radius: 4px;
  color: #155724;
}

.discount-amount {
  font-weight: bold;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .main-content {
    grid-template-columns: 1fr;
  }
  
  .cart-section {
    position: static;
  }
  
  .product-grid {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  }
}
```

## ç»ƒä¹ é¢˜

### åŸºç¡€ç»ƒä¹ 

1. å®ç°åŸºç¡€è´­ç‰©è½¦çš„å¢åˆ æ”¹åŠŸèƒ½
2. æ·»åŠ å•†å“æ•°é‡æ§åˆ¶
3. è®¡ç®—å¹¶æ˜¾ç¤ºæ€»ä»·

### è¿›é˜¶ç»ƒä¹ 

1. å®ç°ä¼˜æƒ åˆ¸åŠŸèƒ½
2. æ·»åŠ åº“å­˜ç®¡ç†
3. å®ç°æ”¶è—åˆ—è¡¨
4. æ·»åŠ æœç´¢å’Œç­›é€‰åŠŸèƒ½

### é«˜çº§ç»ƒä¹ 

1. å®ç°å®Œæ•´çš„ç»“ç®—æµç¨‹
2. ä½¿ç”¨æœ¬åœ°å­˜å‚¨æŒä¹…åŒ–è´­ç‰©è½¦
3. æ·»åŠ åŠ¨ç”»æ•ˆæœæå‡ç”¨æˆ·ä½“éªŒ
4. ä½¿ç”¨React 19çš„Server Actionså®ç°æœåŠ¡ç«¯è´­ç‰©è½¦
5. æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨memoç³»åˆ—Hookå’Œè™šæ‹Ÿæ»šåŠ¨

## æ€»ç»“

é€šè¿‡å®Œæˆè´­ç‰©è½¦åº”ç”¨ï¼Œä½ å·²ç»ï¼š

- æŒæ¡äº†å¤æ‚Stateçš„ç®¡ç†ç­–ç•¥
- å­¦ä¼šäº†æ•°ç»„æ“ä½œçš„å„ç§æŠ€å·§
- ç†è§£äº†æ•°æ®è®¡ç®—ä¸æ´¾ç”ŸçŠ¶æ€
- æŒæ¡äº†ç»„ä»¶æ‹†åˆ†å’Œå¤ç”¨
- å­¦ä¼šäº†æ€§èƒ½ä¼˜åŒ–æ–¹æ³•
- æå‡äº†ç”¨æˆ·ä½“éªŒè®¾è®¡èƒ½åŠ›
- ä½“éªŒäº†React 19çš„æ–°ç‰¹æ€§

è´­ç‰©è½¦æ˜¯ç”µå•†åº”ç”¨çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯Reactå¼€å‘çš„ç»¼åˆå®è·µã€‚æ­å–œä½ å®Œæˆäº†Part1çš„æ‰€æœ‰å­¦ä¹ ï¼ä½ å·²ç»æŒæ¡äº†Reactæ ¸å¿ƒåŸºç¡€ï¼Œå¯ä»¥å¼€å§‹æ„å»ºå®é™…çš„ç”Ÿäº§çº§åº”ç”¨äº†ï¼

ç»§ç»­å­¦ä¹ Part2ï¼Œæ·±å…¥æŒæ¡React Hooksçš„å¼ºå¤§åŠŸèƒ½ï¼
