# å¤šç¯å¢ƒé…ç½®

## è¯¾ç¨‹æ¦‚è¿°

æœ¬ç« èŠ‚æ·±å…¥æ¢è®¨å‰ç«¯é¡¹ç›®çš„å¤šç¯å¢ƒé…ç½®ç­–ç•¥,å­¦ä¹ å¦‚ä½•ç®¡ç†å¼€å‘ã€æµ‹è¯•ã€é¢„å‘å¸ƒã€ç”Ÿäº§ç­‰å¤šä¸ªç¯å¢ƒçš„é…ç½®ã€‚æŒæ¡å¤šç¯å¢ƒé…ç½®èƒ½å¤Ÿæé«˜é¡¹ç›®çš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

### å­¦ä¹ ç›®æ ‡

- ç†è§£å¤šç¯å¢ƒé…ç½®çš„å¿…è¦æ€§
- æŒæ¡ç¯å¢ƒé…ç½®æ–‡ä»¶çš„ç»„ç»‡æ–¹å¼
- å­¦ä¹ åŠ¨æ€ç¯å¢ƒåˆ‡æ¢æŠ€å·§
- äº†è§£ç¯å¢ƒç‰¹å®šçš„æ„å»ºç­–ç•¥
- æŒæ¡CI/CDä¸­çš„ç¯å¢ƒç®¡ç†
- å­¦ä¹ é…ç½®çš„å®‰å…¨å’Œæœ€ä½³å®è·µ

## ç¬¬ä¸€éƒ¨åˆ†:å¤šç¯å¢ƒæ¦‚è¿°

### 1.1 å¸¸è§ç¯å¢ƒç±»å‹

```javascript
1. Local (æœ¬åœ°)         - å¼€å‘äººå‘˜æœ¬åœ°ç¯å¢ƒ
2. Development (å¼€å‘)   - å¼€å‘æœåŠ¡å™¨ç¯å¢ƒ
3. Test/QA (æµ‹è¯•)      - æµ‹è¯•ç¯å¢ƒ
4. Staging (é¢„å‘å¸ƒ)     - é¢„ç”Ÿäº§ç¯å¢ƒ
5. Production (ç”Ÿäº§)    - æ­£å¼ç”Ÿäº§ç¯å¢ƒ
6. DR (ç¾å¤‡)           - ç¾éš¾æ¢å¤ç¯å¢ƒ
```

### 1.2 ç¯å¢ƒç‰¹å¾å¯¹æ¯”

| ç¯å¢ƒ | APIç«¯ç‚¹ | æ•°æ®åº“ | æ—¥å¿—çº§åˆ« | ç›‘æ§ | ç¼“å­˜ |
|------|---------|--------|---------|------|------|
| Local | localhost | æœ¬åœ° | debug | å¦ | ç¦ç”¨ |
| Development | dev-api | å¼€å‘åº“ | debug | åŸºç¡€ | ç¦ç”¨ |
| Test | test-api | æµ‹è¯•åº“ | info | åŸºç¡€ | å¯ç”¨ |
| Staging | staging-api | é¢„å‘å¸ƒåº“ | warn | å®Œæ•´ | å¯ç”¨ |
| Production | api | ç”Ÿäº§åº“ | error | å®Œæ•´ | å¯ç”¨ |

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦å¤šç¯å¢ƒ

```javascript
1. éš”ç¦»æ€§ - ä¸åŒç¯å¢ƒäº’ä¸å½±å“
2. æµ‹è¯•æ€§ - åœ¨æ¥è¿‘ç”Ÿäº§çš„ç¯å¢ƒä¸­æµ‹è¯•
3. å®‰å…¨æ€§ - ä¿æŠ¤ç”Ÿäº§ç¯å¢ƒæ•°æ®
4. çµæ´»æ€§ - é’ˆå¯¹ä¸åŒç¯å¢ƒä¼˜åŒ–é…ç½®
5. å¯è¿½æº¯ - é—®é¢˜å®šä½å’Œå›æ»š
```

## ç¬¬äºŒéƒ¨åˆ†:ç¯å¢ƒé…ç½®æ–‡ä»¶

### 2.1 åŸºç¡€é…ç½®ç»“æ„

```bash
# .env æ–‡ä»¶ç»“æ„
.env                    # é»˜è®¤é…ç½®(æ‰€æœ‰ç¯å¢ƒ)
.env.local             # æœ¬åœ°è¦†ç›–(ä¸æäº¤)
.env.development       # å¼€å‘ç¯å¢ƒ
.env.test              # æµ‹è¯•ç¯å¢ƒ
.env.staging           # é¢„å‘å¸ƒç¯å¢ƒ
.env.production        # ç”Ÿäº§ç¯å¢ƒ
.env.example           # ç¤ºä¾‹æ–‡ä»¶(æäº¤)
```

### 2.2 å¼€å‘ç¯å¢ƒé…ç½®

```bash
# .env.development
# åº”ç”¨é…ç½®
VITE_APP_NAME=MyApp Dev
VITE_APP_VERSION=1.0.0-dev

# APIé…ç½®
VITE_API_BASE_URL=http://localhost:8080/api
VITE_API_TIMEOUT=30000
VITE_WS_URL=ws://localhost:8080/ws

# åŠŸèƒ½å¼€å…³
VITE_ENABLE_MOCK=true
VITE_ENABLE_DEBUG=true
VITE_ENABLE_ANALYTICS=false

# ç¬¬ä¸‰æ–¹æœåŠ¡(æµ‹è¯•å¯†é’¥)
VITE_STRIPE_KEY=pk_test_xxx
VITE_GA_ID=

# å…¶ä»–é…ç½®
VITE_LOG_LEVEL=debug
VITE_CDN_URL=http://localhost:3000/static
```

### 2.3 æµ‹è¯•ç¯å¢ƒé…ç½®

```bash
# .env.test
# åº”ç”¨é…ç½®
VITE_APP_NAME=MyApp Test
VITE_APP_VERSION=1.0.0-test

# APIé…ç½®
VITE_API_BASE_URL=https://test-api.example.com/api
VITE_API_TIMEOUT=15000
VITE_WS_URL=wss://test-api.example.com/ws

# åŠŸèƒ½å¼€å…³
VITE_ENABLE_MOCK=false
VITE_ENABLE_DEBUG=true
VITE_ENABLE_ANALYTICS=false

# ç¬¬ä¸‰æ–¹æœåŠ¡
VITE_STRIPE_KEY=pk_test_xxx
VITE_GA_ID=UA-test-xxx

# å…¶ä»–é…ç½®
VITE_LOG_LEVEL=info
VITE_CDN_URL=https://test-cdn.example.com
```

### 2.4 é¢„å‘å¸ƒç¯å¢ƒé…ç½®

```bash
# .env.staging
# åº”ç”¨é…ç½®
VITE_APP_NAME=MyApp Staging
VITE_APP_VERSION=1.0.0-staging

# APIé…ç½®
VITE_API_BASE_URL=https://staging-api.example.com/api
VITE_API_TIMEOUT=10000
VITE_WS_URL=wss://staging-api.example.com/ws

# åŠŸèƒ½å¼€å…³
VITE_ENABLE_MOCK=false
VITE_ENABLE_DEBUG=false
VITE_ENABLE_ANALYTICS=true

# ç¬¬ä¸‰æ–¹æœåŠ¡
VITE_STRIPE_KEY=pk_test_xxx
VITE_GA_ID=UA-staging-xxx

# å…¶ä»–é…ç½®
VITE_LOG_LEVEL=warn
VITE_CDN_URL=https://staging-cdn.example.com
```

### 2.5 ç”Ÿäº§ç¯å¢ƒé…ç½®

```bash
# .env.production
# åº”ç”¨é…ç½®
VITE_APP_NAME=MyApp
VITE_APP_VERSION=1.0.0

# APIé…ç½®
VITE_API_BASE_URL=https://api.example.com/api
VITE_API_TIMEOUT=10000
VITE_WS_URL=wss://api.example.com/ws

# åŠŸèƒ½å¼€å…³
VITE_ENABLE_MOCK=false
VITE_ENABLE_DEBUG=false
VITE_ENABLE_ANALYTICS=true

# ç¬¬ä¸‰æ–¹æœåŠ¡(ç”Ÿäº§å¯†é’¥)
VITE_STRIPE_KEY=pk_live_xxx
VITE_GA_ID=UA-prod-xxx

# å…¶ä»–é…ç½®
VITE_LOG_LEVEL=error
VITE_CDN_URL=https://cdn.example.com
```

## ç¬¬ä¸‰éƒ¨åˆ†:é…ç½®ç®¡ç†ç³»ç»Ÿ

### 3.1 ç±»å‹å®šä¹‰

```typescript
// src/config/types.ts
export type Environment = 'local' | 'development' | 'test' | 'staging' | 'production'

export interface ApiConfig {
  baseUrl: string
  timeout: number
  wsUrl: string
  retryAttempts: number
  retryDelay: number
}

export interface FeatureFlags {
  mock: boolean
  debug: boolean
  analytics: boolean
  betaFeatures: boolean
}

export interface ExternalServices {
  stripe: {
    publicKey: string
  }
  analytics: {
    gaId?: string
    sentryDsn?: string
  }
  cdn: {
    url: string
  }
}

export interface AppConfig {
  env: Environment
  app: {
    name: string
    version: string
  }
  api: ApiConfig
  features: FeatureFlags
  external: ExternalServices
  logging: {
    level: 'debug' | 'info' | 'warn' | 'error'
    remote: boolean
  }
}
```

### 3.2 ç¯å¢ƒé…ç½®å®ç°

```typescript
// src/config/environments/development.ts
import { AppConfig } from '../types'

export const development: AppConfig = {
  env: 'development',
  
  app: {
    name: import.meta.env.VITE_APP_NAME || 'MyApp Dev',
    version: import.meta.env.VITE_APP_VERSION || '1.0.0-dev',
  },
  
  api: {
    baseUrl: import.meta.env.VITE_API_BASE_URL || 'http://localhost:8080/api',
    timeout: 30000,
    wsUrl: import.meta.env.VITE_WS_URL || 'ws://localhost:8080/ws',
    retryAttempts: 1,
    retryDelay: 1000,
  },
  
  features: {
    mock: true,
    debug: true,
    analytics: false,
    betaFeatures: true,
  },
  
  external: {
    stripe: {
      publicKey: import.meta.env.VITE_STRIPE_KEY || '',
    },
    analytics: {
      gaId: import.meta.env.VITE_GA_ID,
      sentryDsn: import.meta.env.VITE_SENTRY_DSN,
    },
    cdn: {
      url: 'http://localhost:3000/static',
    },
  },
  
  logging: {
    level: 'debug',
    remote: false,
  },
}
```

```typescript
// src/config/environments/production.ts
import { AppConfig } from '../types'

export const production: AppConfig = {
  env: 'production',
  
  app: {
    name: import.meta.env.VITE_APP_NAME || 'MyApp',
    version: import.meta.env.VITE_APP_VERSION || '1.0.0',
  },
  
  api: {
    baseUrl: import.meta.env.VITE_API_BASE_URL || 'https://api.example.com/api',
    timeout: 10000,
    wsUrl: import.meta.env.VITE_WS_URL || 'wss://api.example.com/ws',
    retryAttempts: 3,
    retryDelay: 1000,
  },
  
  features: {
    mock: false,
    debug: false,
    analytics: true,
    betaFeatures: false,
  },
  
  external: {
    stripe: {
      publicKey: import.meta.env.VITE_STRIPE_KEY || '',
    },
    analytics: {
      gaId: import.meta.env.VITE_GA_ID,
      sentryDsn: import.meta.env.VITE_SENTRY_DSN,
    },
    cdn: {
      url: 'https://cdn.example.com',
    },
  },
  
  logging: {
    level: 'error',
    remote: true,
  },
}
```

### 3.3 é…ç½®åŠ è½½å™¨

```typescript
// src/config/index.ts
import { z } from 'zod'
import { AppConfig, Environment } from './types'
import { development } from './environments/development'
import { test } from './environments/test'
import { staging } from './environments/staging'
import { production } from './environments/production'

// é…ç½®éªŒè¯ Schema
const configSchema = z.object({
  env: z.enum(['local', 'development', 'test', 'staging', 'production']),
  app: z.object({
    name: z.string().min(1),
    version: z.string().min(1),
  }),
  api: z.object({
    baseUrl: z.string().url(),
    timeout: z.number().positive(),
    wsUrl: z.string(),
    retryAttempts: z.number().min(0),
    retryDelay: z.number().positive(),
  }),
  features: z.object({
    mock: z.boolean(),
    debug: z.boolean(),
    analytics: z.boolean(),
    betaFeatures: z.boolean(),
  }),
  external: z.object({
    stripe: z.object({
      publicKey: z.string(),
    }),
    analytics: z.object({
      gaId: z.string().optional(),
      sentryDsn: z.string().optional(),
    }),
    cdn: z.object({
      url: z.string().url(),
    }),
  }),
  logging: z.object({
    level: z.enum(['debug', 'info', 'warn', 'error']),
    remote: z.boolean(),
  }),
})

// ç¯å¢ƒé…ç½®æ˜ å°„
const configs: Record<Environment, AppConfig> = {
  local: development,
  development,
  test,
  staging,
  production,
}

// è·å–å½“å‰ç¯å¢ƒ
function getCurrentEnvironment(): Environment {
  const mode = import.meta.env.MODE as Environment
  return mode || 'development'
}

// åŠ è½½å¹¶éªŒè¯é…ç½®
function loadConfig(): AppConfig {
  const env = getCurrentEnvironment()
  const rawConfig = configs[env]
  
  try {
    return configSchema.parse(rawConfig)
  } catch (error) {
    console.error('Configuration validation failed:', error)
    console.error('Using development config as fallback')
    return development
  }
}

export const config = loadConfig()

// å¯¼å‡ºç¯å¢ƒæ£€æµ‹å·¥å…·
export const env = {
  current: config.env,
  isLocal: config.env === 'local',
  isDev: config.env === 'development',
  isTest: config.env === 'test',
  isStaging: config.env === 'staging',
  isProd: config.env === 'production',
}

// è°ƒè¯•è¾“å‡º
if (config.features.debug) {
  console.group('ğŸ”§ App Configuration')
  console.log('Environment:', config.env)
  console.log('API Base URL:', config.api.baseUrl)
  console.log('Features:', config.features)
  console.groupEnd()
}
```

### 3.4 é…ç½®ä½¿ç”¨ç¤ºä¾‹

```typescript
// src/services/api.ts
import axios from 'axios'
import { config } from '@/config'

const api = axios.create({
  baseURL: config.api.baseUrl,
  timeout: config.api.timeout,
})

// è¯·æ±‚æ‹¦æˆªå™¨
api.interceptors.request.use(
  (config) => {
    // å¼€å‘ç¯å¢ƒæ—¥å¿—
    if (env.isDev || env.isTest) {
      console.log('API Request:', config)
    }
    return config
  },
  (error) => {
    return Promise.reject(error)
  }
)

// å“åº”æ‹¦æˆªå™¨
api.interceptors.response.use(
  (response) => {
    return response
  },
  async (error) => {
    const { retryAttempts, retryDelay } = config.api
    
    // ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨é‡è¯•
    if (env.isProd && error.config && !error.config.__retryCount) {
      error.config.__retryCount = 0
      
      while (error.config.__retryCount < retryAttempts) {
        error.config.__retryCount++
        
        await new Promise(resolve => setTimeout(resolve, retryDelay))
        
        try {
          return await api.request(error.config)
        } catch (err) {
          error = err
        }
      }
    }
    
    return Promise.reject(error)
  }
)

export default api
```

## ç¬¬å››éƒ¨åˆ†:æ„å»ºé…ç½®

### 4.1 Vite å¤šç¯å¢ƒæ„å»º

```typescript
// vite.config.ts
import { defineConfig, loadEnv } from 'vite'
import react from '@vitejs/plugin-react-swc'
import { resolve } from 'path'

export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, process.cwd(), '')
  const isDev = mode === 'development'
  const isProd = mode === 'production'
  
  return {
    plugins: [react()],
    
    resolve: {
      alias: {
        '@': resolve(__dirname, 'src'),
      },
    },
    
    server: {
      port: parseInt(env.VITE_PORT) || 3000,
      proxy: {
        '/api': {
          target: env.VITE_API_BASE_URL,
          changeOrigin: true,
        },
      },
    },
    
    build: {
      outDir: `dist-${mode}`,
      sourcemap: mode === 'staging' || isDev,
      
      rollupOptions: {
        output: {
          manualChunks: isProd ? {
            'react-vendor': ['react', 'react-dom'],
            'router': ['react-router-dom'],
          } : undefined,
        },
      },
      
      minify: isProd ? 'terser' : false,
      terserOptions: isProd ? {
        compress: {
          drop_console: true,
          drop_debugger: true,
        },
      } : undefined,
    },
  }
})
```

### 4.2 æ„å»ºè„šæœ¬

```json
// package.json
{
  "scripts": {
    "dev": "vite --mode development",
    "dev:test": "vite --mode test",
    "dev:staging": "vite --mode staging",
    
    "build": "vite build --mode production",
    "build:dev": "vite build --mode development",
    "build:test": "vite build --mode test",
    "build:staging": "vite build --mode staging",
    "build:all": "npm run build:dev && npm run build:test && npm run build:staging && npm run build",
    
    "preview": "vite preview",
    "preview:test": "vite preview --mode test",
    "preview:staging": "vite preview --mode staging",
  }
}
```

### 4.3 ç¯å¢ƒç‰¹å®šæ„å»ºè„šæœ¬

```typescript
// scripts/build.ts
import { build } from 'vite'
import { resolve } from 'path'
import fs from 'fs-extra'

interface BuildOptions {
  mode: string
  outDir: string
}

async function buildForEnvironment(options: BuildOptions) {
  const { mode, outDir } = options
  
  console.log(`ğŸ—ï¸  Building for ${mode}...`)
  
  // æ¸…ç©ºè¾“å‡ºç›®å½•
  await fs.emptyDir(outDir)
  
  // æ„å»º
  await build({
    mode,
    root: resolve(__dirname, '..'),
    build: {
      outDir,
      emptyOutDir: false,
    },
  })
  
  // å¤åˆ¶ç¯å¢ƒç‰¹å®šæ–‡ä»¶
  await fs.copy(
    resolve(__dirname, `../public/${mode}`),
    resolve(__dirname, `../${outDir}`),
    { overwrite: true }
  )
  
  console.log(`âœ… Build complete for ${mode}`)
}

// æ‰¹é‡æ„å»º
async function buildAll() {
  const environments = [
    { mode: 'development', outDir: 'dist-dev' },
    { mode: 'test', outDir: 'dist-test' },
    { mode: 'staging', outDir: 'dist-staging' },
    { mode: 'production', outDir: 'dist' },
  ]
  
  for (const env of environments) {
    await buildForEnvironment(env)
  }
}

buildAll().catch(console.error)
```

## ç¬¬äº”éƒ¨åˆ†:CI/CD é›†æˆ

### 5.1 GitHub Actions

```yaml
# .github/workflows/deploy.yml
name: Deploy

on:
  push:
    branches:
      - main        # ç”Ÿäº§ç¯å¢ƒ
      - staging     # é¢„å‘å¸ƒç¯å¢ƒ
      - develop     # å¼€å‘ç¯å¢ƒ
  pull_request:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Determine environment
        id: env
        run: |
          if [[ "${{ github.ref }}" == "refs/heads/main" ]]; then
            echo "ENV=production" >> $GITHUB_OUTPUT
          elif [[ "${{ github.ref }}" == "refs/heads/staging" ]]; then
            echo "ENV=staging" >> $GITHUB_OUTPUT
          else
            echo "ENV=development" >> $GITHUB_OUTPUT
          fi
      
      - name: Build
        run: npm run build:${{ steps.env.outputs.ENV }}
        env:
          VITE_API_BASE_URL: ${{ secrets[format('{0}_API_URL', steps.env.outputs.ENV)] }}
          VITE_STRIPE_KEY: ${{ secrets[format('{0}_STRIPE_KEY', steps.env.outputs.ENV)] }}
      
      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-args: '--prod --env=${{ steps.env.outputs.ENV }}'
          vercel-org-id: ${{ secrets.ORG_ID }}
          vercel-project-id: ${{ secrets.PROJECT_ID }}
```

### 5.2 GitLab CI

```yaml
# .gitlab-ci.yml
stages:
  - build
  - deploy

variables:
  NODE_VERSION: "20"

.build_template: &build_template
  stage: build
  image: node:${NODE_VERSION}
  cache:
    paths:
      - node_modules/
  before_script:
    - npm ci
  artifacts:
    paths:
      - dist-${CI_ENVIRONMENT_NAME}/
    expire_in: 1 day

build:development:
  <<: *build_template
  script:
    - npm run build:dev
  environment:
    name: development
  only:
    - develop

build:staging:
  <<: *build_template
  script:
    - npm run build:staging
  environment:
    name: staging
  only:
    - staging

build:production:
  <<: *build_template
  script:
    - npm run build
  environment:
    name: production
  only:
    - main

deploy:production:
  stage: deploy
  script:
    - npm run deploy
  environment:
    name: production
    url: https://example.com
  only:
    - main
```

### 5.3 ç¯å¢ƒå˜é‡ç®¡ç†

**ä½¿ç”¨ Vercel:**

```bash
# å®‰è£… Vercel CLI
npm i -g vercel

# æ·»åŠ ç¯å¢ƒå˜é‡
vercel env add VITE_API_URL production
vercel env add VITE_API_URL staging
vercel env add VITE_API_URL development

# æ‹‰å–ç¯å¢ƒå˜é‡
vercel env pull
```

**ä½¿ç”¨ Netlify:**

```toml
# netlify.toml
[build]
  command = "npm run build"
  publish = "dist"

# Development
[context.develop]
  command = "npm run build:dev"
  
  [context.develop.environment]
    VITE_API_URL = "https://dev-api.example.com"
    VITE_ENV = "development"

# Staging
[context.staging]
  command = "npm run build:staging"
  
  [context.staging.environment]
    VITE_API_URL = "https://staging-api.example.com"
    VITE_ENV = "staging"

# Production
[context.production]
  command = "npm run build"
  
  [context.production.environment]
    VITE_API_URL = "https://api.example.com"
    VITE_ENV = "production"
```

## ç¬¬å…­éƒ¨åˆ†:ç¯å¢ƒåˆ‡æ¢å’Œè°ƒè¯•

### 6.1 ç¯å¢ƒåˆ‡æ¢å·¥å…·

```typescript
// src/utils/env-switcher.ts
export class EnvironmentSwitcher {
  private static readonly STORAGE_KEY = '__app_environment__'
  
  static getEnvironments() {
    return ['development', 'test', 'staging', 'production'] as const
  }
  
  static getCurrentEnvironment() {
    if (typeof window === 'undefined') return null
    return localStorage.getItem(this.STORAGE_KEY) || import.meta.env.MODE
  }
  
  static switchEnvironment(env: string) {
    if (typeof window === 'undefined') return
    
    localStorage.setItem(this.STORAGE_KEY, env)
    window.location.reload()
  }
  
  static isEnabled() {
    // ä»…åœ¨å¼€å‘ç¯å¢ƒå¯ç”¨
    return import.meta.env.DEV
  }
}
```

```typescript
// src/components/EnvSwitcher.tsx
import { useState } from 'react'
import { EnvironmentSwitcher } from '@/utils/env-switcher'

export function EnvSwitcher() {
  const [currentEnv, setCurrentEnv] = useState(
    EnvironmentSwitcher.getCurrentEnvironment()
  )
  
  if (!EnvironmentSwitcher.isEnabled()) {
    return null
  }
  
  const handleSwitch = (env: string) => {
    EnvironmentSwitcher.switchEnvironment(env)
    setCurrentEnv(env)
  }
  
  return (
    <div className="env-switcher">
      <select value={currentEnv || ''} onChange={(e) => handleSwitch(e.target.value)}>
        {EnvironmentSwitcher.getEnvironments().map((env) => (
          <option key={env} value={env}>
            {env}
          </option>
        ))}
      </select>
    </div>
  )
}
```

### 6.2 ç¯å¢ƒä¿¡æ¯é¢æ¿

```typescript
// src/components/EnvInfoPanel.tsx
import { config, env } from '@/config'

export function EnvInfoPanel() {
  if (!env.isDev && !env.isStaging) {
    return null
  }
  
  return (
    <div className="env-info-panel">
      <h3>Environment Info</h3>
      <table>
        <tbody>
          <tr>
            <td>Environment:</td>
            <td>{config.env}</td>
          </tr>
          <tr>
            <td>API URL:</td>
            <td>{config.api.baseUrl}</td>
          </tr>
          <tr>
            <td>Version:</td>
            <td>{config.app.version}</td>
          </tr>
          <tr>
            <td>Debug Mode:</td>
            <td>{config.features.debug ? 'Yes' : 'No'}</td>
          </tr>
        </tbody>
      </table>
    </div>
  )
}
```

## ç¬¬ä¸ƒéƒ¨åˆ†:å®‰å…¨å’Œæœ€ä½³å®è·µ

### 7.1 æ•æ„Ÿä¿¡æ¯ç®¡ç†

```bash
# .env.example (æäº¤åˆ° git)
# API Configuration
VITE_API_BASE_URL=
VITE_API_TIMEOUT=

# Feature Flags
VITE_ENABLE_ANALYTICS=
VITE_ENABLE_DEBUG=

# External Services (Public Keys Only)
VITE_STRIPE_KEY=
VITE_GA_ID=

# DO NOT COMMIT ACTUAL VALUES!
# Copy this file to .env.local and fill in values
```

```bash
# .gitignore
.env.local
.env.*.local
.env.development.local
.env.test.local
.env.staging.local
.env.production.local
```

### 7.2 é…ç½®éªŒè¯

```typescript
// src/config/validation.ts
import { z } from 'zod'

const envSchema = z.object({
  VITE_API_BASE_URL: z.string().url(),
  VITE_API_TIMEOUT: z.string().transform(Number).pipe(z.number().positive()),
  VITE_STRIPE_KEY: z.string().min(1),
})

export function validateEnvironment() {
  try {
    return envSchema.parse(import.meta.env)
  } catch (error) {
    console.error('Environment validation failed:', error)
    throw new Error('Invalid environment configuration')
  }
}
```

### 7.3 è¿è¡Œæ—¶é…ç½®

```typescript
// src/config/runtime.ts
export async function loadRuntimeConfig() {
  try {
    const response = await fetch('/config.json')
    const runtimeConfig = await response.json()
    
    return {
      ...config,
      ...runtimeConfig,
    }
  } catch (error) {
    console.warn('Failed to load runtime config, using build-time config')
    return config
  }
}
```

```json
// public/config.json
{
  "api": {
    "baseUrl": "https://api.example.com"
  },
  "features": {
    "betaFeatures": false
  }
}
```

## ç¬¬å…«éƒ¨åˆ†:å®Œæ•´ç¤ºä¾‹

### 8.1 å®Œæ•´é…ç½®ç³»ç»Ÿ

```typescript
// src/config/index.ts
import { z } from 'zod'

// ç±»å‹å®šä¹‰
export type Environment = 'local' | 'development' | 'test' | 'staging' | 'production'

// Schema å®šä¹‰
const configSchema = z.object({
  env: z.enum(['local', 'development', 'test', 'staging', 'production']),
  app: z.object({
    name: z.string(),
    version: z.string(),
  }),
  api: z.object({
    baseUrl: z.string().url(),
    timeout: z.number(),
  }),
  features: z.object({
    analytics: z.boolean(),
    debug: z.boolean(),
  }),
})

// ç¯å¢ƒé…ç½®
const configs = {
  development: {
    env: 'development' as const,
    app: {
      name: 'MyApp Dev',
      version: '1.0.0-dev',
    },
    api: {
      baseUrl: 'http://localhost:8080',
      timeout: 30000,
    },
    features: {
      analytics: false,
      debug: true,
    },
  },
  production: {
    env: 'production' as const,
    app: {
      name: 'MyApp',
      version: '1.0.0',
    },
    api: {
      baseUrl: 'https://api.example.com',
      timeout: 10000,
    },
    features: {
      analytics: true,
      debug: false,
    },
  },
}

// åŠ è½½é…ç½®
const mode = import.meta.env.MODE as keyof typeof configs
export const config = configSchema.parse(configs[mode] || configs.development)

// ç¯å¢ƒå·¥å…·
export const env = {
  current: config.env,
  isDev: config.env === 'development',
  isProd: config.env === 'production',
}
```

## æ€»ç»“

æœ¬ç« å…¨é¢ä»‹ç»äº†å¤šç¯å¢ƒé…ç½®:

1. **ç¯å¢ƒæ¦‚è¿°** - ç†è§£å¤šç¯å¢ƒçš„å¿…è¦æ€§å’Œç‰¹å¾
2. **é…ç½®æ–‡ä»¶** - ç»„ç»‡å’Œç®¡ç†ç¯å¢ƒé…ç½®
3. **é…ç½®ç³»ç»Ÿ** - å®ç°ç±»å‹å®‰å…¨çš„é…ç½®ç®¡ç†
4. **æ„å»ºé…ç½®** - å¤šç¯å¢ƒæ„å»ºç­–ç•¥
5. **CI/CD** - æŒç»­é›†æˆå’Œéƒ¨ç½²ä¸­çš„ç¯å¢ƒç®¡ç†
6. **è°ƒè¯•å·¥å…·** - ç¯å¢ƒåˆ‡æ¢å’Œä¿¡æ¯é¢æ¿
7. **å®‰å…¨å®è·µ** - æ•æ„Ÿä¿¡æ¯ç®¡ç†å’ŒéªŒè¯

æŒæ¡å¤šç¯å¢ƒé…ç½®æ˜¯æ„å»ºä¸“ä¸šçº§åº”ç”¨çš„å…³é”®èƒ½åŠ›ã€‚

## æ‰©å±•é˜…è¯»

- [12-Factor App](https://12factor.net/)
- [Vite ç¯å¢ƒå’Œæ¨¡å¼](https://vitejs.dev/guide/env-and-mode.html)
- [Environment Variables Best Practices](https://blog.bitsrc.io/environment-variables-in-node-js-the-right-way-83e96ce81f13)

