# è¯­è¨€åˆ‡æ¢å®ç° - å®Œæ•´çš„å¤šè¯­è¨€åˆ‡æ¢è§£å†³æ–¹æ¡ˆ

## 1. è¯­è¨€åˆ‡æ¢æ¦‚è¿°

### 1.1 è¯­è¨€åˆ‡æ¢çš„æ ¸å¿ƒéœ€æ±‚

```typescript
const languageSwitchRequirements = {
  functionality: [
    'æµç•…çš„è¯­è¨€åˆ‡æ¢',
    'æŒä¹…åŒ–ç”¨æˆ·é€‰æ‹©',
    'è‡ªåŠ¨æ£€æµ‹ç”¨æˆ·è¯­è¨€',
    'æ”¯æŒURLè¯­è¨€å‚æ•°',
    'æ— åˆ·æ–°åˆ‡æ¢'
  ],
  
  ux: [
    'ç›´è§‚çš„UIè®¾è®¡',
    'æ¸…æ™°çš„å½“å‰è¯­è¨€æ˜¾ç¤º',
    'å¿«é€Ÿè®¿é—®åˆ‡æ¢å™¨',
    'ç§»åŠ¨ç«¯å‹å¥½'
  ],
  
  technical: [
    'çŠ¶æ€ç®¡ç†',
    'è·¯ç”±é›†æˆ',
    'SEOä¼˜åŒ–',
    'æ€§èƒ½ä¼˜åŒ–'
  ]
};
```

### 1.2 å¸¸è§å®ç°æ–¹å¼

```typescript
const implementations = {
  dropdown: 'ä¸‹æ‹‰é€‰æ‹©å™¨ - æœ€å¸¸è§',
  flags: 'å›½æ——å›¾æ ‡ - è§†è§‰ç›´è§‚',
  text: 'æ–‡æœ¬é“¾æ¥ - ç®€æ´æ˜äº†',
  modal: 'å¼¹çª—é€‰æ‹© - é€‚åˆå¤šè¯­è¨€',
  automatic: 'è‡ªåŠ¨æ£€æµ‹ - æ— éœ€æ‰‹åŠ¨'
};
```

## 2. åŸºç¡€å®ç°

### 2.1 ç®€å•è¯­è¨€åˆ‡æ¢å™¨

```tsx
// LanguageSwitcher.tsx
import { useState } from 'react';

interface Language {
  code: string;
  name: string;
  nativeName: string;
}

const languages: Language[] = [
  { code: 'en', name: 'English', nativeName: 'English' },
  { code: 'zh', name: 'Chinese', nativeName: 'ä¸­æ–‡' },
  { code: 'ja', name: 'Japanese', nativeName: 'æ—¥æœ¬èª' },
  { code: 'ko', name: 'Korean', nativeName: 'í•œêµ­ì–´' },
  { code: 'es', name: 'Spanish', nativeName: 'EspaÃ±ol' },
  { code: 'fr', name: 'French', nativeName: 'FranÃ§ais' }
];

export function SimpleLanguageSwitcher() {
  const [currentLang, setCurrentLang] = useState('en');
  
  const handleChange = (langCode: string) => {
    setCurrentLang(langCode);
    // è§¦å‘è¯­è¨€åˆ‡æ¢é€»è¾‘
    changeLanguage(langCode);
  };
  
  return (
    <select 
      value={currentLang} 
      onChange={(e) => handleChange(e.target.value)}
      className="border rounded px-3 py-2"
    >
      {languages.map(lang => (
        <option key={lang.code} value={lang.code}>
          {lang.nativeName}
        </option>
      ))}
    </select>
  );
}
```

### 2.2 ä¸‹æ‹‰èœå•æ ·å¼

```tsx
// DropdownLanguageSwitcher.tsx
import { useState, useRef, useEffect } from 'react';

export function DropdownLanguageSwitcher() {
  const [isOpen, setIsOpen] = useState(false);
  const [currentLang, setCurrentLang] = useState('en');
  const dropdownRef = useRef<HTMLDivElement>(null);
  
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {
        setIsOpen(false);
      }
    };
    
    document.addEventListener('mousedown', handleClickOutside);
    return () => document.removeEventListener('mousedown', handleClickOutside);
  }, []);
  
  const getCurrentLanguage = () => 
    languages.find(l => l.code === currentLang);
  
  const handleSelect = (langCode: string) => {
    setCurrentLang(langCode);
    setIsOpen(false);
    changeLanguage(langCode);
  };
  
  return (
    <div ref={dropdownRef} className="relative">
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center gap-2 px-4 py-2 border rounded hover:bg-gray-50"
      >
        <span>{getCurrentLanguage()?.nativeName}</span>
        <svg className={`w-4 h-4 transition-transform ${isOpen ? 'rotate-180' : ''}`}>
          <path d="M7 10l5 5 5-5z" />
        </svg>
      </button>
      
      {isOpen && (
        <div className="absolute top-full left-0 mt-1 bg-white border rounded shadow-lg min-w-[200px] z-50">
          {languages.map(lang => (
            <button
              key={lang.code}
              onClick={() => handleSelect(lang.code)}
              className={`w-full text-left px-4 py-2 hover:bg-gray-100 ${
                lang.code === currentLang ? 'bg-blue-50 text-blue-600' : ''
              }`}
            >
              <div className="font-medium">{lang.nativeName}</div>
              <div className="text-sm text-gray-500">{lang.name}</div>
            </button>
          ))}
        </div>
      )}
    </div>
  );
}
```

### 2.3 å›½æ——å›¾æ ‡åˆ‡æ¢å™¨

```tsx
// FlagLanguageSwitcher.tsx
const languageFlags: Record<string, string> = {
  'en': 'ğŸ‡ºğŸ‡¸',
  'zh': 'ğŸ‡¨ğŸ‡³',
  'ja': 'ğŸ‡¯ğŸ‡µ',
  'ko': 'ğŸ‡°ğŸ‡·',
  'es': 'ğŸ‡ªğŸ‡¸',
  'fr': 'ğŸ‡«ğŸ‡·',
  'de': 'ğŸ‡©ğŸ‡ª',
  'it': 'ğŸ‡®ğŸ‡¹'
};

export function FlagLanguageSwitcher() {
  const [currentLang, setCurrentLang] = useState('en');
  
  return (
    <div className="flex gap-2">
      {Object.entries(languageFlags).map(([code, flag]) => (
        <button
          key={code}
          onClick={() => {
            setCurrentLang(code);
            changeLanguage(code);
          }}
          className={`text-2xl transition-opacity ${
            code === currentLang ? 'opacity-100' : 'opacity-40 hover:opacity-70'
          }`}
          title={languages.find(l => l.code === code)?.name}
        >
          {flag}
        </button>
      ))}
    </div>
  );
}
```

## 3. React-i18nexté›†æˆ

### 3.1 åŸºç¡€é›†æˆ

```tsx
// LanguageSwitcher.tsx
import { useTranslation } from 'react-i18next';

export function I18nextLanguageSwitcher() {
  const { i18n, t } = useTranslation();
  
  const changeLanguage = async (lng: string) => {
    await i18n.changeLanguage(lng);
    
    // ä¿å­˜åˆ°localStorage
    localStorage.setItem('i18nextLng', lng);
    
    // æ›´æ–°HTML langå±æ€§
    document.documentElement.lang = lng;
    
    // æ›´æ–°æ–‡æœ¬æ–¹å‘
    document.documentElement.dir = ['ar', 'he', 'fa'].includes(lng) ? 'rtl' : 'ltr';
  };
  
  return (
    <select 
      value={i18n.language} 
      onChange={(e) => changeLanguage(e.target.value)}
    >
      <option value="en">{t('languages.english')}</option>
      <option value="zh">{t('languages.chinese')}</option>
      <option value="ja">{t('languages.japanese')}</option>
    </select>
  );
}
```

### 3.2 åŠ¨æ€åŠ è½½ç¿»è¯‘

```tsx
import { useTranslation } from 'react-i18next';

export function DynamicLanguageSwitcher() {
  const { i18n } = useTranslation();
  const [loading, setLoading] = useState(false);
  
  const changeLanguage = async (lng: string) => {
    setLoading(true);
    
    try {
      // æ£€æŸ¥æ˜¯å¦å·²åŠ è½½
      if (!i18n.hasResourceBundle(lng, 'translation')) {
        // åŠ¨æ€åŠ è½½ç¿»è¯‘èµ„æº
        const resources = await import(`../locales/${lng}/translation.json`);
        i18n.addResourceBundle(lng, 'translation', resources.default);
      }
      
      await i18n.changeLanguage(lng);
    } catch (error) {
      console.error('Failed to load language:', error);
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <div>
      {loading && <div className="loader">Loading...</div>}
      <select 
        value={i18n.language} 
        onChange={(e) => changeLanguage(e.target.value)}
        disabled={loading}
      >
        {languages.map(lang => (
          <option key={lang.code} value={lang.code}>
            {lang.nativeName}
          </option>
        ))}
      </select>
    </div>
  );
}
```

## 4. React-Intlé›†æˆ

### 4.1 Contextå®ç°

```tsx
// IntlContext.tsx
import { createContext, useContext, useState, ReactNode } from 'react';
import { IntlProvider } from 'react-intl';

interface IntlContextValue {
  locale: string;
  changeLocale: (locale: string) => void;
}

const IntlContext = createContext<IntlContextValue | null>(null);

export function IntlWrapper({ children }: { children: ReactNode }) {
  const [locale, setLocale] = useState('en');
  const [messages, setMessages] = useState<any>({});
  
  const changeLocale = async (newLocale: string) => {
    // åŠ¨æ€åŠ è½½æ¶ˆæ¯
    const msgs = await import(`../translations/${newLocale}.json`);
    setMessages(msgs.default);
    setLocale(newLocale);
    
    // æŒä¹…åŒ–
    localStorage.setItem('locale', newLocale);
  };
  
  useEffect(() => {
    const savedLocale = localStorage.getItem('locale') || 'en';
    changeLocale(savedLocale);
  }, []);
  
  return (
    <IntlContext.Provider value={{ locale, changeLocale }}>
      <IntlProvider locale={locale} messages={messages}>
        {children}
      </IntlProvider>
    </IntlContext.Provider>
  );
}

export function useLocale() {
  const context = useContext(IntlContext);
  if (!context) throw new Error('useLocale must be used within IntlWrapper');
  return context;
}

// ä½¿ç”¨
export function IntlLanguageSwitcher() {
  const { locale, changeLocale } = useLocale();
  
  return (
    <select value={locale} onChange={(e) => changeLocale(e.target.value)}>
      {languages.map(lang => (
        <option key={lang.code} value={lang.code}>
          {lang.nativeName}
        </option>
      ))}
    </select>
  );
}
```

## 5. Next.jsé›†æˆ

### 5.1 ä½¿ç”¨next-i18next

```tsx
// components/LanguageSwitcher.tsx
import { useRouter } from 'next/router';
import Link from 'next/link';

export function NextLanguageSwitcher() {
  const router = useRouter();
  const { locales, locale: currentLocale, asPath } = router;
  
  return (
    <div className="flex gap-2">
      {locales?.map(locale => (
        <Link
          key={locale}
          href={asPath}
          locale={locale}
          className={locale === currentLocale ? 'font-bold' : ''}
        >
          {languages.find(l => l.code === locale)?.nativeName}
        </Link>
      ))}
    </div>
  );
}

// ä¸‹æ‹‰æ ·å¼
export function NextDropdownSwitcher() {
  const router = useRouter();
  
  const changeLanguage = (locale: string) => {
    router.push(router.asPath, router.asPath, { locale });
  };
  
  return (
    <select 
      value={router.locale} 
      onChange={(e) => changeLanguage(e.target.value)}
    >
      {router.locales?.map(locale => (
        <option key={locale} value={locale}>
          {languages.find(l => l.code === locale)?.nativeName}
        </option>
      ))}
    </select>
  );
}
```

### 5.2 åŠ¨æ€è·¯ç”±å¤„ç†

```tsx
// ä¿ç•™æŸ¥è¯¢å‚æ•°å’Œhash
export function NextAdvancedSwitcher() {
  const router = useRouter();
  
  const changeLanguage = async (locale: string) => {
    const { pathname, asPath, query } = router;
    
    // ä¿ç•™å½“å‰è·¯å¾„å’ŒæŸ¥è¯¢å‚æ•°
    await router.push(
      { pathname, query },
      asPath,
      { locale }
    );
  };
  
  return (
    <select 
      value={router.locale} 
      onChange={(e) => changeLanguage(e.target.value)}
    >
      {router.locales?.map(locale => (
        <option key={locale} value={locale}>
          {locale.toUpperCase()}
        </option>
      ))}
    </select>
  );
}
```

## 6. æŒä¹…åŒ–å­˜å‚¨

### 6.1 LocalStorageå­˜å‚¨

```typescript
// utils/languageStorage.ts
const LANGUAGE_KEY = 'preferred_language';

export const languageStorage = {
  get: (): string | null => {
    try {
      return localStorage.getItem(LANGUAGE_KEY);
    } catch {
      return null;
    }
  },
  
  set: (language: string): void => {
    try {
      localStorage.setItem(LANGUAGE_KEY, language);
    } catch (error) {
      console.error('Failed to save language:', error);
    }
  },
  
  remove: (): void => {
    try {
      localStorage.removeItem(LANGUAGE_KEY);
    } catch (error) {
      console.error('Failed to remove language:', error);
    }
  }
};

// ä½¿ç”¨
export function PersistentLanguageSwitcher() {
  const [language, setLanguage] = useState(() => 
    languageStorage.get() || 'en'
  );
  
  const handleChange = (newLang: string) => {
    setLanguage(newLang);
    languageStorage.set(newLang);
    changeLanguage(newLang);
  };
  
  return (
    <select value={language} onChange={(e) => handleChange(e.target.value)}>
      {languages.map(lang => (
        <option key={lang.code} value={lang.code}>
          {lang.nativeName}
        </option>
      ))}
    </select>
  );
}
```

### 6.2 Cookieå­˜å‚¨

```typescript
// utils/languageCookie.ts
export const languageCookie = {
  get: (): string | null => {
    const match = document.cookie.match(/(?:^|;\s*)language=([^;]*)/);
    return match ? decodeURIComponent(match[1]) : null;
  },
  
  set: (language: string, days: number = 365): void => {
    const expires = new Date();
    expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000);
    
    document.cookie = `language=${encodeURIComponent(language)}; expires=${expires.toUTCString()}; path=/; SameSite=Lax`;
  },
  
  remove: (): void => {
    document.cookie = 'language=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
  }
};
```

## 7. è‡ªåŠ¨è¯­è¨€æ£€æµ‹

### 7.1 æµè§ˆå™¨è¯­è¨€æ£€æµ‹

```typescript
// utils/detectLanguage.ts
export function detectBrowserLanguage(
  supportedLanguages: string[]
): string {
  // æ£€æŸ¥navigator.languages
  if (navigator.languages) {
    for (const lang of navigator.languages) {
      const simpleLang = lang.split('-')[0];
      if (supportedLanguages.includes(simpleLang)) {
        return simpleLang;
      }
    }
  }
  
  // å›é€€åˆ°navigator.language
  const browserLang = navigator.language.split('-')[0];
  if (supportedLanguages.includes(browserLang)) {
    return browserLang;
  }
  
  // é»˜è®¤è¯­è¨€
  return 'en';
}

// ä½¿ç”¨
export function AutoDetectLanguageSwitcher() {
  const supportedLanguages = ['en', 'zh', 'ja', 'ko'];
  
  const [language, setLanguage] = useState(() => {
    // ä¼˜å…ˆä½¿ç”¨å·²ä¿å­˜çš„è¯­è¨€
    const saved = languageStorage.get();
    if (saved && supportedLanguages.includes(saved)) {
      return saved;
    }
    
    // è‡ªåŠ¨æ£€æµ‹
    return detectBrowserLanguage(supportedLanguages);
  });
  
  useEffect(() => {
    changeLanguage(language);
  }, [language]);
  
  return (
    <select value={language} onChange={(e) => {
      setLanguage(e.target.value);
      languageStorage.set(e.target.value);
    }}>
      {languages.filter(l => supportedLanguages.includes(l.code)).map(lang => (
        <option key={lang.code} value={lang.code}>
          {lang.nativeName}
        </option>
      ))}
    </select>
  );
}
```

### 7.2 åœ°ç†ä½ç½®æ£€æµ‹

```typescript
// åŸºäºIPçš„è¯­è¨€æ£€æµ‹
async function detectLanguageByIP(): Promise<string> {
  try {
    const response = await fetch('https://ipapi.co/json/');
    const data = await response.json();
    
    const countryToLanguage: Record<string, string> = {
      'US': 'en',
      'CN': 'zh',
      'JP': 'ja',
      'KR': 'ko',
      'ES': 'es',
      'FR': 'fr'
    };
    
    return countryToLanguage[data.country_code] || 'en';
  } catch {
    return 'en';
  }
}
```

## 8. URLå‚æ•°é›†æˆ

### 8.1 æŸ¥è¯¢å‚æ•°

```tsx
// ä»URLè¯»å–è¯­è¨€
export function URLLanguageSwitcher() {
  const [searchParams, setSearchParams] = useSearchParams();
  const language = searchParams.get('lang') || 'en';
  
  const changeLanguage = (newLang: string) => {
    setSearchParams({ lang: newLang });
    // åŒæ—¶æ›´æ–°åº”ç”¨è¯­è¨€
    i18n.changeLanguage(newLang);
  };
  
  return (
    <select value={language} onChange={(e) => changeLanguage(e.target.value)}>
      {languages.map(lang => (
        <option key={lang.code} value={lang.code}>
          {lang.nativeName}
        </option>
      ))}
    </select>
  );
}
```

### 8.2 è·¯å¾„å‰ç¼€

```tsx
// /en/about, /zh/about
import { useParams, useNavigate } from 'react-router-dom';

export function PathPrefixLanguageSwitcher() {
  const { lang } = useParams<{ lang: string }>();
  const navigate = useNavigate();
  
  const changeLanguage = (newLang: string) => {
    const currentPath = window.location.pathname;
    const newPath = currentPath.replace(`/${lang}/`, `/${newLang}/`);
    navigate(newPath);
  };
  
  return (
    <select value={lang} onChange={(e) => changeLanguage(e.target.value)}>
      {languages.map(l => (
        <option key={l.code} value={l.code}>
          {l.nativeName}
        </option>
      ))}
    </select>
  );
}
```

## 9. ç§»åŠ¨ç«¯é€‚é…

### 9.1 ç§»åŠ¨ç«¯èœå•

```tsx
// MobileLanguageSwitcher.tsx
export function MobileLanguageSwitcher() {
  const [isOpen, setIsOpen] = useState(false);
  const { i18n } = useTranslation();
  
  return (
    <>
      <button
        onClick={() => setIsOpen(true)}
        className="flex items-center gap-2 p-2"
      >
        <GlobeIcon className="w-5 h-5" />
        <span className="text-sm">
          {languages.find(l => l.code === i18n.language)?.nativeName}
        </span>
      </button>
      
      {isOpen && (
        <div className="fixed inset-0 bg-black bg-opacity-50 z-50">
          <div className="fixed bottom-0 left-0 right-0 bg-white rounded-t-2xl p-4">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-lg font-bold">é€‰æ‹©è¯­è¨€</h3>
              <button onClick={() => setIsOpen(false)}>
                <CloseIcon />
              </button>
            </div>
            
            <div className="space-y-2">
              {languages.map(lang => (
                <button
                  key={lang.code}
                  onClick={() => {
                    i18n.changeLanguage(lang.code);
                    setIsOpen(false);
                  }}
                  className={`w-full text-left p-3 rounded ${
                    lang.code === i18n.language ? 'bg-blue-50' : ''
                  }`}
                >
                  <div className="font-medium">{lang.nativeName}</div>
                  <div className="text-sm text-gray-500">{lang.name}</div>
                </button>
              ))}
            </div>
          </div>
        </div>
      )}
    </>
  );
}
```

## 10. SEOä¼˜åŒ–

### 10.1 hreflangæ ‡ç­¾

```tsx
// SEOLanguageLinks.tsx
import Head from 'next/head';
import { useRouter } from 'next/router';

export function SEOLanguageLinks() {
  const router = useRouter();
  const baseUrl = 'https://example.com';
  
  return (
    <Head>
      {router.locales?.map(locale => (
        <link
          key={locale}
          rel="alternate"
          hrefLang={locale}
          href={`${baseUrl}/${locale}${router.asPath}`}
        />
      ))}
      <link
        rel="alternate"
        hrefLang="x-default"
        href={`${baseUrl}${router.asPath}`}
      />
    </Head>
  );
}
```

## 11. æ€§èƒ½ä¼˜åŒ–

### 11.1 é¢„åŠ è½½ç¿»è¯‘

```typescript
// é¢„åŠ è½½å…¶ä»–è¯­è¨€
useEffect(() => {
  const preloadLanguages = ['zh', 'ja'];
  
  preloadLanguages.forEach(async (lang) => {
    if (lang !== i18n.language) {
      try {
        await import(`../locales/${lang}/translation.json`);
      } catch (error) {
        console.error(`Failed to preload ${lang}:`, error);
      }
    }
  });
}, []);
```

### 11.2 æ‡’åŠ è½½ç­–ç•¥

```typescript
// åªåœ¨éœ€è¦æ—¶åŠ è½½
const loadLanguage = async (lang: string) => {
  if (!loadedLanguages.has(lang)) {
    const module = await import(`../locales/${lang}.json`);
    i18n.addResourceBundle(lang, 'translation', module.default);
    loadedLanguages.add(lang);
  }
};
```

## 12. æœ€ä½³å®è·µ

```typescript
const bestPractices = {
  ux: [
    'æä¾›æ¸…æ™°çš„å½“å‰è¯­è¨€æŒ‡ç¤º',
    'ä½¿ç”¨æ¯è¯­æ˜¾ç¤ºè¯­è¨€åç§°',
    'ä¿æŒUIä¸€è‡´æ€§',
    'è€ƒè™‘ç§»åŠ¨ç«¯ä½“éªŒ'
  ],
  
  technical: [
    'æŒä¹…åŒ–ç”¨æˆ·é€‰æ‹©',
    'è‡ªåŠ¨æ£€æµ‹ç”¨æˆ·è¯­è¨€',
    'æ”¯æŒURLå‚æ•°',
    'å¤„ç†RTLè¯­è¨€'
  ],
  
  seo: [
    'ä½¿ç”¨hreflangæ ‡ç­¾',
    'æ­£ç¡®çš„URLç»“æ„',
    'è¯­è¨€åˆ‡æ¢ä¿æŒé¡µé¢å†…å®¹',
    'sitemapåŒ…å«æ‰€æœ‰è¯­è¨€'
  ],
  
  performance: [
    'å»¶è¿ŸåŠ è½½ç¿»è¯‘',
    'é¢„åŠ è½½å¸¸ç”¨è¯­è¨€',
    'ç¼“å­˜ç¿»è¯‘èµ„æº',
    'ä¼˜åŒ–åˆ‡æ¢é€Ÿåº¦'
  ]
};
```

## 14. é«˜çº§è¯­è¨€åˆ‡æ¢ç­–ç•¥

### 14.1 æ™ºèƒ½è¯­è¨€æ¨è

```tsx
// åŸºäºç”¨æˆ·è¡Œä¸ºçš„è¯­è¨€æ¨è
function useLanguageRecommendation() {
  const [recommendedLang, setRecommendedLang] = useState<string | null>(null);
  
  useEffect(() => {
    const factors = {
      browserLang: navigator.language,
      geoLocation: getUserGeoLocation(),
      previousVisits: getVisitHistory(),
      contentPreference: getContentPreference()
    };
    
    // æ™ºèƒ½åˆ†æ
    const recommended = analyzeLanguagePreference(factors);
    
    if (recommended !== getCurrentLanguage()) {
      setRecommendedLang(recommended);
    }
  }, []);
  
  return recommendedLang;
}

// è¯­è¨€æ¨èæç¤º
function LanguageRecommendationBanner() {
  const recommended = useLanguageRecommendation();
  const { switchLanguage } = useLanguage();
  
  if (!recommended) return null;
  
  return (
    <div className="language-recommendation">
      <p>æˆ‘ä»¬æ³¨æ„åˆ°æ‚¨å¯èƒ½æ›´å–œæ¬¢ {getLanguageName(recommended)}</p>
      <button onClick={() => switchLanguage(recommended)}>
        åˆ‡æ¢åˆ° {getLanguageName(recommended)}
      </button>
      <button onClick={() => dismissRecommendation()}>
        ä¿æŒå½“å‰è¯­è¨€
      </button>
    </div>
  );
}
```

### 14.2 å¤šè¯­è¨€A/Bæµ‹è¯•

```tsx
// è¯­è¨€åˆ‡æ¢æ•ˆæœA/Bæµ‹è¯•
import { useABTest } from './useABTest';

function LanguageSwitcher() {
  const variant = useABTest('language-switcher', {
    variants: ['dropdown', 'flags', 'text-only'],
    weights: [0.4, 0.3, 0.3]
  });
  
  // è·Ÿè¸ªåˆ‡æ¢è¡Œä¸º
  const trackLanguageSwitch = (newLang: string) => {
    analytics.track('language_switched', {
      from: currentLanguage,
      to: newLang,
      variant,
      timestamp: Date.now()
    });
  };
  
  switch (variant) {
    case 'dropdown':
      return <DropdownLanguageSwitcher onSwitch={trackLanguageSwitch} />;
    case 'flags':
      return <FlagLanguageSwitcher onSwitch={trackLanguageSwitch} />;
    case 'text-only':
      return <TextLanguageSwitcher onSwitch={trackLanguageSwitch} />;
  }
}
```

### 14.3 è¯­è¨€å›é€€ç­–ç•¥

```tsx
// å¤šçº§è¯­è¨€å›é€€
const languageFallbacks = {
  'zh-CN': ['zh-TW', 'zh', 'en'],
  'zh-TW': ['zh-CN', 'zh', 'en'],
  'en-US': ['en-GB', 'en'],
  'en-GB': ['en-US', 'en'],
  'fr-CA': ['fr-FR', 'fr', 'en'],
  'es-MX': ['es-ES', 'es', 'en']
};

async function loadMessagesWithFallback(locale: string) {
  const fallbackChain = [locale, ...(languageFallbacks[locale] || ['en'])];
  
  for (const lang of fallbackChain) {
    try {
      const messages = await import(`./locales/${lang}.json`);
      console.log(`Loaded messages for ${lang}`);
      return messages.default;
    } catch (error) {
      console.warn(`Failed to load ${lang}, trying fallback...`);
    }
  }
  
  throw new Error('No language file available');
}
```

## 15. æ€§èƒ½ä¼˜åŒ–æ·±åº¦å®è·µ

### 15.1 ç¿»è¯‘æ–‡ä»¶é¢„åŠ è½½

```tsx
// é¢„åŠ è½½å¸¸ç”¨è¯­è¨€
function preloadCommonLanguages() {
  const commonLanguages = ['en', 'zh', 'es', 'fr'];
  
  if ('requestIdleCallback' in window) {
    requestIdleCallback(() => {
      commonLanguages.forEach(lang => {
        import(`./locales/${lang}.json`);
      });
    });
  }
}

// åœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨
useEffect(() => {
  preloadCommonLanguages();
}, []);
```

### 15.2 ç¿»è¯‘ç¼“å­˜ä¼˜åŒ–

```tsx
// æŒä¹…åŒ–ç¿»è¯‘ç¼“å­˜
class TranslationCache {
  private cache: Map<string, any> = new Map();
  private dbName = 'translation-cache';
  private version = 1;
  
  async init() {
    // ä»IndexedDBæ¢å¤ç¼“å­˜
    const stored = await this.loadFromDB();
    if (stored) {
      this.cache = new Map(Object.entries(stored));
    }
  }
  
  async get(locale: string) {
    if (this.cache.has(locale)) {
      return this.cache.get(locale);
    }
    
    const messages = await this.fetchMessages(locale);
    this.cache.set(locale, messages);
    await this.saveToDB();
    return messages;
  }
  
  private async loadFromDB() {
    return new Promise((resolve) => {
      const request = indexedDB.open(this.dbName, this.version);
      request.onsuccess = () => {
        const db = request.result;
        const tx = db.transaction('translations', 'readonly');
        const store = tx.objectStore('translations');
        const getRequest = store.get('cache');
        getRequest.onsuccess = () => resolve(getRequest.result);
      };
    });
  }
  
  private async saveToDB() {
    return new Promise((resolve) => {
      const request = indexedDB.open(this.dbName, this.version);
      request.onsuccess = () => {
        const db = request.result;
        const tx = db.transaction('translations', 'readwrite');
        const store = tx.objectStore('translations');
        store.put(Object.fromEntries(this.cache), 'cache');
        tx.oncomplete = () => resolve(true);
      };
    });
  }
}
```

### 15.3 æŒ‰éœ€åŠ è½½ç¿»è¯‘æ¨¡å—

```tsx
// æ¨¡å—åŒ–ç¿»è¯‘åŠ è½½
const translationModules = {
  common: () => import('./locales/common'),
  dashboard: () => import('./locales/dashboard'),
  products: () => import('./locales/products'),
  checkout: () => import('./locales/checkout')
};

function useModuleTranslations(modules: string[]) {
  const [translations, setTranslations] = useState({});
  const { locale } = useLanguage();
  
  useEffect(() => {
    Promise.all(
      modules.map(module => 
        translationModules[module]().then(m => m[locale])
      )
    ).then(results => {
      const merged = Object.assign({}, ...results);
      setTranslations(merged);
    });
  }, [modules, locale]);
  
  return translations;
}

// ä½¿ç”¨
function Dashboard() {
  const t = useModuleTranslations(['common', 'dashboard']);
  
  return <div>{t['dashboard.title']}</div>;
}
```

## 16. ä¼ä¸šçº§å®è·µ

### 16.1 ç¿»è¯‘ç®¡ç†å¹³å°é›†æˆ

```tsx
// ä¸Crowdin/Lokaliseç­‰å¹³å°é›†æˆ
import { CrowdinClient } from '@crowdin/crowdin-api-client';

class TranslationManagement {
  private client: CrowdinClient;
  
  constructor(apiKey: string) {
    this.client = new CrowdinClient({ token: apiKey });
  }
  
  async syncTranslations(projectId: number) {
    // 1. ä¸Šä¼ æºæ–‡ä»¶
    await this.uploadSourceFiles(projectId);
    
    // 2. æ‹‰å–ç¿»è¯‘
    const translations = await this.downloadTranslations(projectId);
    
    // 3. ä¿å­˜åˆ°æœ¬åœ°
    await this.saveTranslations(translations);
    
    return translations;
  }
  
  async uploadSourceFiles(projectId: number) {
    const sourceFiles = await this.extractSourceMessages();
    
    for (const [filename, content] of Object.entries(sourceFiles)) {
      await this.client.sourceFilesApi.createFile(projectId, {
        name: filename,
        content: Buffer.from(JSON.stringify(content)).toString('base64')
      });
    }
  }
  
  async downloadTranslations(projectId: number) {
    const build = await this.client.translationsApi.buildProject(projectId);
    
    // ç­‰å¾…æ„å»ºå®Œæˆ
    await this.waitForBuild(projectId, build.data.id);
    
    // ä¸‹è½½ç¿»è¯‘æ–‡ä»¶
    const download = await this.client.translationsApi.downloadTranslations(
      projectId,
      build.data.id
    );
    
    return download.data;
  }
}
```

### 16.2 ç¿»è¯‘è´¨é‡ä¿è¯

```typescript
// è‡ªåŠ¨ç¿»è¯‘è´¨é‡æ£€æŸ¥
interface QualityCheck {
  missingKeys: string[];
  emptyTranslations: string[];
  inconsistentVariables: string[];
  lengthIssues: Array<{ key: string; ratio: number }>;
}

function checkTranslationQuality(
  source: Record<string, string>,
  target: Record<string, string>
): QualityCheck {
  const issues: QualityCheck = {
    missingKeys: [],
    emptyTranslations: [],
    inconsistentVariables: [],
    lengthIssues: []
  };
  
  // æ£€æŸ¥ç¼ºå¤±çš„key
  Object.keys(source).forEach(key => {
    if (!(key in target)) {
      issues.missingKeys.push(key);
    }
  });
  
  // æ£€æŸ¥ç©ºç¿»è¯‘
  Object.entries(target).forEach(([key, value]) => {
    if (!value || value.trim() === '') {
      issues.emptyTranslations.push(key);
    }
  });
  
  // æ£€æŸ¥å˜é‡ä¸€è‡´æ€§
  Object.entries(source).forEach(([key, sourceText]) => {
    const targetText = target[key];
    if (!targetText) return;
    
    const sourceVars = sourceText.match(/\{[^}]+\}/g) || [];
    const targetVars = targetText.match(/\{[^}]+\}/g) || [];
    
    if (sourceVars.length !== targetVars.length) {
      issues.inconsistentVariables.push(key);
    }
  });
  
  // æ£€æŸ¥é•¿åº¦é—®é¢˜
  Object.entries(source).forEach(([key, sourceText]) => {
    const targetText = target[key];
    if (!targetText) return;
    
    const ratio = targetText.length / sourceText.length;
    if (ratio > 2 || ratio < 0.3) {
      issues.lengthIssues.push({ key, ratio });
    }
  });
  
  return issues;
}

// ä½¿ç”¨
const qualityReport = checkTranslationQuality(
  enMessages,
  zhMessages
);

if (qualityReport.missingKeys.length > 0) {
  console.error('Missing translations:', qualityReport.missingKeys);
}
```

### 16.3 ç¿»è¯‘ç‰ˆæœ¬ç®¡ç†

```typescript
// Git-basedç¿»è¯‘ç‰ˆæœ¬æ§åˆ¶
import simpleGit from 'simple-git';

class TranslationVersionControl {
  private git = simpleGit();
  
  async commitTranslations(locale: string, message: string) {
    await this.git.add(`locales/${locale}.json`);
    await this.git.commit(`[i18n] ${message} (${locale})`);
  }
  
  async reviewChanges(locale: string) {
    const diff = await this.git.diff([`locales/${locale}.json`]);
    return this.parseDiff(diff);
  }
  
  async rollbackTranslation(locale: string, version: string) {
    await this.git.checkout([version, `locales/${locale}.json`]);
  }
  
  private parseDiff(diff: string) {
    const changes = {
      added: [] as string[],
      modified: [] as string[],
      removed: [] as string[]
    };
    
    // è§£ædiffè¾“å‡º
    const lines = diff.split('\n');
    lines.forEach(line => {
      if (line.startsWith('+') && !line.startsWith('+++')) {
        changes.added.push(line.substring(1));
      } else if (line.startsWith('-') && !line.startsWith('---')) {
        changes.removed.push(line.substring(1));
      }
    });
    
    return changes;
  }
}
```

## 17. æµ‹è¯•ç­–ç•¥

### 17.1 è¯­è¨€åˆ‡æ¢æµ‹è¯•

```tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { LanguageProvider } from './LanguageContext';

describe('Language Switching', () => {
  it('should switch language when clicked', async () => {
    render(
      <LanguageProvider>
        <LanguageSwitcher />
        <App />
      </LanguageProvider>
    );
    
    // åˆå§‹è¯­è¨€
    expect(screen.getByText('Hello')).toBeInTheDocument();
    
    // åˆ‡æ¢è¯­è¨€
    fireEvent.click(screen.getByText('ä¸­æ–‡'));
    
    // éªŒè¯åˆ‡æ¢å
    await screen.findByText('ä½ å¥½');
    expect(screen.queryByText('Hello')).not.toBeInTheDocument();
  });
  
  it('should persist language preference', () => {
    render(
      <LanguageProvider>
        <LanguageSwitcher />
      </LanguageProvider>
    );
    
    fireEvent.click(screen.getByText('ä¸­æ–‡'));
    
    // éªŒè¯localStorage
    expect(localStorage.getItem('preferredLanguage')).toBe('zh');
  });
  
  it('should handle invalid language gracefully', () => {
    const { container } = render(
      <LanguageProvider initialLanguage="invalid">
        <App />
      </LanguageProvider>
    );
    
    // åº”è¯¥å›é€€åˆ°é»˜è®¤è¯­è¨€
    expect(container.textContent).toContain('Hello');
  });
});
```

### 17.2 ç¿»è¯‘å®Œæ•´æ€§æµ‹è¯•

```typescript
import fs from 'fs';
import path from 'path';

describe('Translation Completeness', () => {
  const localesDir = path.join(__dirname, '../locales');
  const languages = ['en', 'zh', 'fr', 'es'];
  
  it('should have same keys across all languages', () => {
    const allKeys = languages.map(lang => {
      const filePath = path.join(localesDir, `${lang}.json`);
      const content = JSON.parse(fs.readFileSync(filePath, 'utf-8'));
      return Object.keys(content);
    });
    
    const baseKeys = allKeys[0];
    allKeys.forEach((keys, index) => {
      expect(keys.sort()).toEqual(baseKeys.sort());
    });
  });
  
  it('should not have empty translations', () => {
    languages.forEach(lang => {
      const filePath = path.join(localesDir, `${lang}.json`);
      const content = JSON.parse(fs.readFileSync(filePath, 'utf-8'));
      
      Object.entries(content).forEach(([key, value]) => {
        expect(value).toBeTruthy();
        expect(value.toString().trim()).not.toBe('');
      });
    });
  });
});
```

## 13. æ€»ç»“

è¯­è¨€åˆ‡æ¢å®ç°çš„å…³é”®è¦ç‚¹:

1. **ç”¨æˆ·ä½“éªŒ**: ç®€å•ç›´è§‚çš„åˆ‡æ¢ç•Œé¢
2. **æŒä¹…åŒ–**: ä¿å­˜ç”¨æˆ·è¯­è¨€åå¥½
3. **è‡ªåŠ¨æ£€æµ‹**: æ™ºèƒ½è¯†åˆ«ç”¨æˆ·è¯­è¨€
4. **URLé›†æˆ**: æ”¯æŒURLå‚æ•°æˆ–è·¯å¾„
5. **SEOå‹å¥½**: hreflangå’Œæ­£ç¡®çš„URLç»“æ„
6. **æ€§èƒ½ä¼˜åŒ–**: æ‡’åŠ è½½å’Œé¢„åŠ è½½ç­–ç•¥
7. **æ™ºèƒ½æ¨è**: åŸºäºç”¨æˆ·è¡Œä¸ºçš„è¯­è¨€å»ºè®®
8. **è´¨é‡ä¿è¯**: ç¿»è¯‘å®Œæ•´æ€§å’Œä¸€è‡´æ€§æ£€æŸ¥
9. **ç‰ˆæœ¬ç®¡ç†**: Git-basedç¿»è¯‘ç‰ˆæœ¬æ§åˆ¶
10. **ä¼ä¸šé›†æˆ**: ä¸ç¿»è¯‘ç®¡ç†å¹³å°æ— ç¼å¯¹æ¥

é€šè¿‡å®æ–½å®Œå–„çš„è¯­è¨€åˆ‡æ¢åŠŸèƒ½,å¯ä»¥ä¸ºå…¨çƒç”¨æˆ·æä¾›ä¼˜è´¨çš„å¤šè¯­è¨€ä½“éªŒã€‚

## æ‰©å±•é˜…è¯»

- [i18nextæ–‡æ¡£](https://www.i18next.com/)
- [React-i18nextæœ€ä½³å®è·µ](https://react.i18next.com/latest/using-with-hooks)
- [è¯­è¨€æ£€æµ‹ç­–ç•¥](https://www.w3.org/International/questions/qa-lang-priorities)
- [ç¿»è¯‘ç®¡ç†å·¥å…·å¯¹æ¯”](https://phrase.com/blog/posts/translation-management-systems/)

