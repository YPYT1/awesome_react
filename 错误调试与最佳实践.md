# React é”™è¯¯è°ƒè¯•ä¸æœ€ä½³å®è·µæŒ‡å—

> ğŸ¯ **ç›®æ ‡**ï¼šå­¦ä¼šè¯†åˆ«ã€è°ƒè¯•å’Œé¢„é˜²Reactå¼€å‘ä¸­çš„å¸¸è§é”™è¯¯

## 1. å¸¸è§é”™è¯¯ç±»å‹åŠè§£å†³æ–¹æ¡ˆ

### 1.1 çŠ¶æ€æ›´æ–°ç›¸å…³é”™è¯¯

#### é”™è¯¯ï¼šç›´æ¥ä¿®æ”¹çŠ¶æ€
```jsx
// âŒ é”™è¯¯ï¼šç›´æ¥ä¿®æ”¹çŠ¶æ€å¯¹è±¡
function BadStateUpdate() {
    const [user, setUser] = useState({ name: 'å¼ ä¸‰', age: 25 });
    
    const handleUpdate = () => {
        user.age = 26; // ç›´æ¥ä¿®æ”¹ï¼ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“
        setUser(user); // å¼•ç”¨ç›¸åŒï¼ŒReactè®¤ä¸ºæ²¡æœ‰å˜åŒ–
    };
    
    return (
        <div>
            <p>å§“å: {user.name}, å¹´é¾„: {user.age}</p>
            <button onClick={handleUpdate}>æ›´æ–°å¹´é¾„</button>
        </div>
    );
}

// âœ… æ­£ç¡®ï¼šåˆ›å»ºæ–°å¯¹è±¡
function GoodStateUpdate() {
    const [user, setUser] = useState({ name: 'å¼ ä¸‰', age: 25 });
    
    const handleUpdate = () => {
        setUser(prevUser => ({
            ...prevUser,
            age: 26 // åˆ›å»ºæ–°å¯¹è±¡ï¼Œè§¦å‘é‡æ–°æ¸²æŸ“
        }));
    };
    
    return (
        <div>
            <p>å§“å: {user.name}, å¹´é¾„: {user.age}</p>
            <button onClick={handleUpdate}>æ›´æ–°å¹´é¾„</button>
        </div>
    );
}
```

#### é”™è¯¯ï¼šå¼‚æ­¥çŠ¶æ€æ›´æ–°
```jsx
// âŒ é”™è¯¯ï¼šä¾èµ–è¿‡æ—¶çš„çŠ¶æ€å€¼
function BadAsyncUpdate() {
    const [count, setCount] = useState(0);
    
    const handleMultipleIncrement = () => {
        setCount(count + 1); // count = 0
        setCount(count + 1); // countè¿˜æ˜¯0ï¼
        setCount(count + 1); // countä»ç„¶æ˜¯0ï¼
        // æœ€ç»ˆç»“æœï¼šcount = 1ï¼Œè€Œä¸æ˜¯3
    };
    
    return (
        <div>
            <p>è®¡æ•°: {count}</p>
            <button onClick={handleMultipleIncrement}>è¿ç»­+3</button>
        </div>
    );
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨å‡½æ•°å¼æ›´æ–°
function GoodAsyncUpdate() {
    const [count, setCount] = useState(0);
    
    const handleMultipleIncrement = () => {
        setCount(prev => prev + 1); // prev = 0 â†’ 1
        setCount(prev => prev + 1); // prev = 1 â†’ 2  
        setCount(prev => prev + 1); // prev = 2 â†’ 3
        // æœ€ç»ˆç»“æœï¼šcount = 3
    };
    
    return (
        <div>
            <p>è®¡æ•°: {count}</p>
            <button onClick={handleMultipleIncrement}>è¿ç»­+3</button>
        </div>
    );
}
```

### 1.2 useEffectç›¸å…³é”™è¯¯

#### é”™è¯¯ï¼šæ— é™å¾ªç¯
```jsx
// âŒ é”™è¯¯ï¼šç¼ºå°‘ä¾èµ–å¯¼è‡´æ— é™å¾ªç¯
function InfiniteLoop() {
    const [count, setCount] = useState(0);
    const [data, setData] = useState(null);
    
    useEffect(() => {
        // æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ‰§è¡Œ
        fetchData().then(setData);
        setCount(count + 1); // è§¦å‘é‡æ–°æ¸²æŸ“ â†’ æ— é™å¾ªç¯ï¼
    }); // ç¼ºå°‘ä¾èµ–æ•°ç»„
    
    return <div>è®¡æ•°: {count}</div>;
}

// âœ… æ­£ç¡®ï¼šåˆç†ä½¿ç”¨ä¾èµ–æ•°ç»„
function FixedLoop() {
    const [count, setCount] = useState(0);
    const [data, setData] = useState(null);
    
    useEffect(() => {
        // åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡
        fetchData().then(setData);
    }, []); // ç©ºä¾èµ–æ•°ç»„
    
    useEffect(() => {
        // åªåœ¨countå˜åŒ–æ—¶æ‰§è¡Œ
        console.log('è®¡æ•°å˜åŒ–:', count);
    }, [count]); // ä¾èµ–count
    
    return (
        <div>
            <p>è®¡æ•°: {count}</p>
            <button onClick={() => setCount(c => c + 1)}>+1</button>
        </div>
    );
}
```

#### é”™è¯¯ï¼šè¿‡æ—¶é—­åŒ…
```jsx
// âŒ é”™è¯¯ï¼šè¿‡æ—¶çš„é—­åŒ…å€¼
function StaleClosure() {
    const [count, setCount] = useState(0);
    
    useEffect(() => {
        const interval = setInterval(() => {
            console.log('å½“å‰è®¡æ•°:', count); // æ€»æ˜¯æ˜¾ç¤ºåˆå§‹å€¼0ï¼
        }, 1000);
        
        return () => clearInterval(interval);
    }, []); // countä¸åœ¨ä¾èµ–ä¸­
    
    return (
        <div>
            <p>è®¡æ•°: {count}</p>
            <button onClick={() => setCount(c => c + 1)}>+1</button>
        </div>
    );
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨refæˆ–æ·»åŠ ä¾èµ–
function FixedClosure() {
    const [count, setCount] = useState(0);
    const countRef = useRef(count);
    
    // ä¿æŒrefä¸countåŒæ­¥
    useEffect(() => {
        countRef.current = count;
    }, [count]);
    
    useEffect(() => {
        const interval = setInterval(() => {
            console.log('å½“å‰è®¡æ•°:', countRef.current); // æ˜¾ç¤ºæœ€æ–°å€¼
        }, 1000);
        
        return () => clearInterval(interval);
    }, []); // ç©ºä¾èµ–æ•°ç»„ï¼Œä½¿ç”¨refè·å–æœ€æ–°å€¼
    
    return (
        <div>
            <p>è®¡æ•°: {count}</p>
            <button onClick={() => setCount(c => c + 1)}>+1</button>
        </div>
    );
}
```

### 1.3 äº‹ä»¶å¤„ç†ç›¸å…³é”™è¯¯

#### é”™è¯¯ï¼šäº‹ä»¶å¯¹è±¡é‡ç”¨
```jsx
// âŒ é”™è¯¯ï¼šå¼‚æ­¥ä½¿ç”¨äº‹ä»¶å¯¹è±¡
function BadEventObject() {
    const [value, setValue] = useState('');
    
    const handleChange = (e) => {
        setValue(e.target.value);
        
        // å¼‚æ­¥ä½¿ç”¨äº‹ä»¶å¯¹è±¡
        setTimeout(() => {
            console.log(e.target.value); // å¯èƒ½ä¸ºnullæˆ–undefinedï¼
        }, 1000);
    };
    
    return <input value={value} onChange={handleChange} />;
}

// âœ… æ­£ç¡®ï¼šæå‰ä¿å­˜éœ€è¦çš„å€¼
function GoodEventObject() {
    const [value, setValue] = useState('');
    
    const handleChange = (e) => {
        const newValue = e.target.value; // æå‰ä¿å­˜
        setValue(newValue);
        
        setTimeout(() => {
            console.log(newValue); // ä½¿ç”¨ä¿å­˜çš„å€¼
        }, 1000);
    };
    
    return <input value={value} onChange={handleChange} />;
}
```

## 2. è°ƒè¯•æŠ€å·§å’Œå·¥å…·

### 2.1 æµè§ˆå™¨å¼€å‘è€…å·¥å…·

#### React Developer Tools
```bash
# å®‰è£…Reactå¼€å‘è€…å·¥å…·
# Chromeå•†åº—æœç´¢: React Developer Tools
```

**ä½¿ç”¨æŠ€å·§**ï¼š
1. **ç»„ä»¶æ£€æŸ¥**ï¼šæŸ¥çœ‹ç»„ä»¶æ ‘å’Œprops
2. **çŠ¶æ€ç›‘æ§**ï¼šå®æ—¶è§‚å¯Ÿstateå’Œpropså˜åŒ–
3. **æ€§èƒ½åˆ†æ**ï¼šè¯†åˆ«æ¸²æŸ“æ€§èƒ½é—®é¢˜

#### Consoleè°ƒè¯•
```jsx
function DebugComponent() {
    const [data, setData] = useState(null);
    
    useEffect(() => {
        console.log('ğŸ” useEffectæ‰§è¡Œ', { data });
        
        // æ¡ä»¶æ–­ç‚¹
        if (data && data.length > 10) {
            console.warn('âš ï¸ æ•°æ®é‡è¿‡å¤§:', data.length);
        }
    }, [data]);
    
    return <div>è°ƒè¯•ç»„ä»¶</div>;
}
```

### 2.2 è‡ªå®šä¹‰è°ƒè¯•Hook
```jsx
// è‡ªå®šä¹‰è°ƒè¯•Hook
function useDebug(componentName, dependencies = {}) {
    useEffect(() => {
        console.log(`ğŸ”„ ${componentName} æ¸²æŸ“`, dependencies);
    });
    
    const log = (message, data) => {
        console.log(`ğŸ“ ${componentName}: ${message}`, data);
    };
    
    return { log };
}

// ä½¿ç”¨ç¤ºä¾‹
function MyComponent() {
    const [count, setCount] = useState(0);
    const { log } = useDebug('MyComponent', { count });
    
    const handleClick = () => {
        log('æŒ‰é’®ç‚¹å‡»', { oldCount: count });
        setCount(c => c + 1);
        log('çŠ¶æ€æ›´æ–°å', { newCount: count + 1 });
    };
    
    return <button onClick={handleClick}>è®¡æ•°: {count}</button>;
}
```

## 3. é”™è¯¯è¾¹ç•Œï¼ˆError Boundariesï¼‰

### 3.1 åˆ›å»ºé”™è¯¯è¾¹ç•Œç»„ä»¶
```jsx
import React from 'react';

class ErrorBoundary extends React.Component {
    constructor(props) {
        super(props);
        this.state = { hasError: false, error: null, errorInfo: null };
    }
    
    static getDerivedStateFromError(error) {
        return { hasError: true };
    }
    
    componentDidCatch(error, errorInfo) {
        this.setState({
            error: error,
            errorInfo: errorInfo
        });
        
        // å¯ä»¥åœ¨è¿™é‡Œä¸ŠæŠ¥é”™è¯¯åˆ°ç›‘æ§ç³»ç»Ÿ
        console.error('ğŸš¨ ç»„ä»¶é”™è¯¯:', error, errorInfo);
    }
    
    render() {
        if (this.state.hasError) {
            return (
                <div style={{ 
                    padding: '20px', 
                    border: '1px solid #ff6b6b', 
                    background: '#fff5f5',
                    borderRadius: '5px'
                }}>
                    <h2>ğŸ˜µ ç»„ä»¶å‡ºé”™äº†ï¼</h2>
                    <details style={{ whiteSpace: 'pre-wrap' }}>
                        <summary>é”™è¯¯è¯¦æƒ…</summary>
                        {this.state.error && this.state.error.toString()}
                        <br />
                        {this.state.errorInfo.componentStack}
                    </details>
                    <button 
                        onClick={() => this.setState({ hasError: false })}
                        style={{ marginTop: '10px' }}
                    >
                        é‡è¯•
                    </button>
                </div>
            );
        }
        
        return this.props.children;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
function App() {
    return (
        <ErrorBoundary>
            <MyBuggyComponent />
        </ErrorBoundary>
    );
}
```

### 3.2 é”™è¯¯è¾¹ç•Œæœ€ä½³å®è·µ
```jsx
// åˆ†å±‚é”™è¯¯è¾¹ç•Œ
function App() {
    return (
        <ErrorBoundary fallback={<div>åº”ç”¨çº§é”™è¯¯</div>}>
            <Header />
            
            <ErrorBoundary fallback={<div>ä¸»è¦å†…å®¹é”™è¯¯</div>}>
                <MainContent />
            </ErrorBoundary>
            
            <ErrorBoundary fallback={<div>ä¾§è¾¹æ é”™è¯¯</div>}>
                <Sidebar />
            </ErrorBoundary>
            
            <Footer />
        </ErrorBoundary>
    );
}
```

## 4. æ€§èƒ½ä¼˜åŒ–å’Œé”™è¯¯é¢„é˜²

### 4.1 ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼ï¼ˆStrictModeï¼‰
```jsx
import React from 'react';
import ReactDOM from 'react-dom';

ReactDOM.render(
    <React.StrictMode>
        <App />
    </React.StrictMode>,
    document.getElementById('root')
);
```

**ä¸¥æ ¼æ¨¡å¼çš„ä½œç”¨**ï¼š
- æ£€æµ‹ä¸å®‰å…¨çš„ç”Ÿå‘½å‘¨æœŸä½¿ç”¨
- è­¦å‘Šè¿‡æ—¶çš„APIä½¿ç”¨
- æ£€æµ‹æ„å¤–çš„å‰¯ä½œç”¨
- åœ¨å¼€å‘æ¨¡å¼ä¸‹æ‰§è¡Œä¸¤æ¬¡æ¸²æŸ“ä»¥å‘ç°é—®é¢˜

### 4.2 ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
```jsx
import React, { lazy, Suspense } from 'react';

// æ‡’åŠ è½½ç»„ä»¶
const HeavyComponent = lazy(() => import('./HeavyComponent'));

function App() {
    return (
        <div>
            <Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
                <HeavyComponent />
            </Suspense>
        </div>
    );
}
```

### 4.3 å†…å­˜æ³„æ¼é¢„é˜²
```jsx
function SafeComponent() {
    const [data, setData] = useState(null);
    const isMounted = useRef(true);
    
    useEffect(() => {
        return () => {
            // ç»„ä»¶å¸è½½æ—¶æ ‡è®°
            isMounted.current = false;
        };
    }, []);
    
    useEffect(() => {
        fetchData().then(result => {
            // æ£€æŸ¥ç»„ä»¶æ˜¯å¦ä»ç„¶æŒ‚è½½
            if (isMounted.current) {
                setData(result);
            }
        });
    }, []);
    
    return <div>å®‰å…¨ç»„ä»¶</div>;
}
```

## 5. æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰

### 5.1 ç¼–å†™æµ‹è¯•ç”¨ä¾‹
```jsx
// MyComponent.test.js
import { render, screen, fireEvent } from '@testing-library/react';
import MyComponent from './MyComponent';

test('ç»„ä»¶æ¸²æŸ“æ­£ç¡®', () => {
    render(<MyComponent />);
    expect(screen.getByText('è®¡æ•°: 0')).toBeInTheDocument();
});

test('ç‚¹å‡»æŒ‰é’®è®¡æ•°å¢åŠ ', () => {
    render(<MyComponent />);
    const button = screen.getByText('è®¡æ•°: 0');
    
    fireEvent.click(button);
    expect(screen.getByText('è®¡æ•°: 1')).toBeInTheDocument();
});

test('å¤„ç†è¾¹ç•Œæƒ…å†µ', () => {
    render(<MyComponent initialCount={-1} />);
    expect(screen.getByText('è®¡æ•°: -1')).toBeInTheDocument();
});
```

### 5.2 é”™è¯¯åœºæ™¯æµ‹è¯•
```jsx
test('ç½‘ç»œé”™è¯¯å¤„ç†', async () => {
    // æ¨¡æ‹Ÿç½‘ç»œé”™è¯¯
    jest.spyOn(global, 'fetch').mockRejectedValue(new Error('ç½‘ç»œé”™è¯¯'));
    
    render(<MyComponent />);
    
    // åº”è¯¥æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    await waitFor(() => {
        expect(screen.getByText('åŠ è½½å¤±è´¥')).toBeInTheDocument();
    });
});
```

### ğŸš€ æŒç»­æ”¹è¿›å»ºè®®
1. **ä»£ç å®¡æŸ¥**ï¼šå®šæœŸè¿›è¡Œä»£ç å®¡æŸ¥ï¼Œå­¦ä¹ ä»–äººä¼˜ç§€å®è·µ
2. **æ€§èƒ½ç›‘æ§**ï¼šä½¿ç”¨æ€§èƒ½åˆ†æå·¥å…·è¯†åˆ«ç“¶é¢ˆ
3. **é”™è¯¯ç›‘æ§**ï¼šé›†æˆé”™è¯¯ç›‘æ§ç³»ç»Ÿï¼ˆå¦‚Sentryï¼‰
4. **å­¦ä¹ ç¤¾åŒº**ï¼šå…³æ³¨Reactå®˜æ–¹åšå®¢å’Œç¤¾åŒºæœ€ä½³å®è·µ

---

## 6. React 19ç‰¹å®šè°ƒè¯•æŠ€å·§

### 6.1 Server Componentsè°ƒè¯•

Server Componentsçš„è°ƒè¯•éœ€è¦ç‰¹æ®Šæ–¹æ³•ï¼š
```jsx
// æœåŠ¡ç«¯æ—¥å¿—
async function ServerComponent() {
  console.log('[Server] Component rendering'); // åªåœ¨æœåŠ¡å™¨æ§åˆ¶å°è¾“å‡º
  
  const data = await fetchData();
  
  return <div>{data.title}</div>;
}

// å®¢æˆ·ç«¯æ—¥å¿—
'use client';
function ClientComponent() {
  console.log('[Client] Component rendering'); // åªåœ¨æµè§ˆå™¨æ§åˆ¶å°è¾“å‡º
  
  return <div>Client content</div>;
}
```

### 6.2 useEffectEventè°ƒè¯•

è°ƒè¯•éå“åº”å¼äº‹ä»¶ï¼š
```jsx
function Component({ value, callback }) {
  const handleEvent = useEffectEvent(() => {
    console.log('[EffectEvent] Called with value:', value);
    callback(value);
  });
  
  useEffect(() => {
    console.log('[Effect] Setting up');
    
    const subscription = subscribe(() => {
      handleEvent();
    });
    
    return () => {
      console.log('[Effect] Cleanup');
      subscription.unsubscribe();
    };
  }, []); // ç©ºä¾èµ–ï¼Œä½†handleEventæ€»æ˜¯ä½¿ç”¨æœ€æ–°value
}
```

### 6.3 Hydrationé”™è¯¯è°ƒè¯•

React 19æ”¹è¿›çš„hydrationé”™è¯¯æç¤ºï¼š
```jsx
// å®¢æˆ·ç«¯hydrationé…ç½®
import { hydrateRoot } from 'react-dom/client';

hydrateRoot(
  document.getElementById('root'),
  <App />,
  {
    onRecoverableError(error, errorInfo) {
      // React 19æä¾›è¯¦ç»†çš„hydrationé”™è¯¯ä¿¡æ¯
      console.error('Hydration Error:', {
        message: error.message,
        componentStack: errorInfo.componentStack,
        digest: errorInfo.digest
      });
      
      // ä¸ŠæŠ¥åˆ°ç›‘æ§ç³»ç»Ÿ
      reportToSentry({
        type: 'hydration-error',
        error,
        errorInfo
      });
    }
  }
);
```

### 6.4 ESLint React 19è§„åˆ™

ä½¿ç”¨æœ€æ–°çš„ESLinté…ç½®ï¼š
```json
{
  "extends": [
    "plugin:react-hooks/recommended"
  ],
  "rules": {
    "react-hooks/rules-of-hooks": "error",
    "react-hooks/exhaustive-deps": "error"
  }
}
```

React Compileræ£€æµ‹ï¼š
```jsx
// ESLintä¼šè­¦å‘Šä¸å¿…è¦çš„ä¼˜åŒ–
function Component({ items }) {
  // è­¦å‘Šï¼šReact Compilerå¯ä»¥è‡ªåŠ¨ä¼˜åŒ–
  const sorted = useMemo(() => items.sort(), [items]);
  
  // æ¨èï¼šè®©Compilerè‡ªåŠ¨å¤„ç†
  const sorted = items.sort();
  
  return <List items={sorted} />;
}
```

### 6.5 TypeScriptç±»å‹è°ƒè¯•

React 19çš„ç±»å‹æ”¹è¿›ï¼š
```typescript
// useRefå¿…é¡»æä¾›å‚æ•°
const ref = useRef<HTMLDivElement | null>(null); // æ­£ç¡®
// const ref = useRef<HTMLDivElement>(); // é”™è¯¯

// useReducerè‡ªåŠ¨ç±»å‹æ¨æ–­
const [state, dispatch] = useReducer(reducer, initialState);
// æ— éœ€æ˜¾å¼æ³›å‹

// ReactElement propsç±»å‹æ›´å®‰å…¨
type Props = ReactElement['props']; // unknownï¼ˆæ›´å®‰å…¨ï¼‰
```

### 6.6 Web Componentsè°ƒè¯•

è°ƒè¯•Custom Elementsé›†æˆï¼š
```jsx
function Component() {
  const elementRef = useRef(null);
  
  useEffect(() => {
    if (elementRef.current) {
      // æ£€æŸ¥å±æ€§æ˜¯å¦æ­£ç¡®ä¼ é€’
      console.log('Custom Element properties:', {
        data: elementRef.current.data,
        config: elementRef.current.config
      });
    }
  }, []);
  
  return (
    <my-custom-element
      ref={elementRef}
      data={{ test: 'value' }}
      onCustomEvent={(e) => console.log('Event:', e.detail)}
    />
  );
}
```

---

## 7. React 19æœ€ä½³å®è·µæ€»ç»“

### 7.1 ä¼˜å…ˆä½¿ç”¨æ–°ç‰¹æ€§
```jsx
// æ¨èï¼šä½¿ç”¨use() Hook
function UserProfile({ userId }) {
  const userPromise = fetchUser(userId);
  const user = use(userPromise);
  
  return <div>{user.name}</div>;
}

// æ—§æ–¹å¼ï¼šuseEffect + useState
function OldUserProfile({ userId }) {
  const [user, setUser] = useState(null);
  
  useEffect(() => {
    fetchUser(userId).then(setUser);
  }, [userId]);
  
  if (!user) return <div>Loading...</div>;
  return <div>{user.name}</div>;
}
```

### 7.2 å……åˆ†åˆ©ç”¨React Compiler
```jsx
// React 19ï¼šæ— éœ€æ‰‹åŠ¨ä¼˜åŒ–
function Component({ items }) {
  // Compilerè‡ªåŠ¨ä¼˜åŒ–
  const filtered = items.filter(item => item.active);
  const sorted = filtered.sort((a, b) => a.name.localeCompare(b.name));
  
  return <List items={sorted} />;
}

// React 18ï¼šéœ€è¦æ‰‹åŠ¨ä¼˜åŒ–
function OldComponent({ items }) {
  const filtered = useMemo(
    () => items.filter(item => item.active),
    [items]
  );
  
  const sorted = useMemo(
    () => filtered.sort((a, b) => a.name.localeCompare(b.name)),
    [filtered]
  );
  
  return <List items={sorted} />;
}
```

### 7.3 åˆç†ä½¿ç”¨Server Components
```jsx
// é™æ€å†…å®¹ï¼šServer Component
async function ProductInfo({ productId }) {
  const product = await db.products.findById(productId);
  
  return (
    <div>
      <h1>{product.name}</h1>
      <p>{product.description}</p>
    </div>
  );
}

// äº¤äº’åŠŸèƒ½ï¼šClient Component
'use client';
function AddToCart({ productId }) {
  const [adding, setAdding] = useState(false);
  
  const handleClick = async () => {
    setAdding(true);
    await addToCart(productId);
    setAdding(false);
  };
  
  return <button onClick={handleClick}>Add to Cart</button>;
}
```

### 7.4 ESLintæœ€ä½³å®è·µ
```json
{
  "extends": [
    "plugin:react-hooks/recommended"
  ],
  "rules": {
    "react-hooks/rules-of-hooks": "error",
    "react-hooks/exhaustive-deps": "error"
  },
  "settings": {
    "react-hooks": {
      "additionalEffectHooks": "(useEffectOnce|useUpdateEffect)"
    }
  }
}
```

---

ğŸ’¡ **è®°ä½**ï¼šä¼˜ç§€çš„Reactå¼€å‘è€…ä¸æ˜¯ä¸çŠ¯é”™è¯¯ï¼Œè€Œæ˜¯èƒ½å¤Ÿå¿«é€Ÿè¯†åˆ«ã€è°ƒè¯•å’Œé¢„é˜²é”™è¯¯ã€‚é€šè¿‡å®è·µè¿™äº›æŠ€å·§ï¼Œç‰¹åˆ«æ˜¯React 19çš„æ–°ç‰¹æ€§å’Œå·¥å…·ï¼Œä½ å°†é€æ­¥å»ºç«‹èµ·å¼ºå¤§çš„è°ƒè¯•èƒ½åŠ›å’Œä¸“ä¸šç´ å…»ã€‚

**React 19å¸¦æ¥çš„æ”¹è¿›**ï¼š
- æ›´å¥½çš„é”™è¯¯æç¤ºï¼ˆç‰¹åˆ«æ˜¯hydrationé”™è¯¯ï¼‰
- React Compilerå‡å°‘æ‰‹åŠ¨ä¼˜åŒ–é”™è¯¯
- TypeScriptç±»å‹ç³»ç»Ÿæ›´å®‰å…¨
- ESLintè§„åˆ™æ›´æ™ºèƒ½
- Server Componentså¸¦æ¥æ–°çš„è°ƒè¯•æ¨¡å¼

æŒç»­å­¦ä¹ ï¼ŒæŒç»­è¿›æ­¥ï¼ğŸš€

---

## 8. çŠ¶æ€ç®¡ç†è°ƒè¯•

### 8.1 Contextæ€§èƒ½é—®é¢˜

Contextå¯¼è‡´çš„è¿‡åº¦æ¸²æŸ“ï¼š
```jsx
// é—®é¢˜ï¼šContextå€¼å˜åŒ–å¯¼è‡´æ‰€æœ‰æ¶ˆè´¹è€…é‡æ–°æ¸²æŸ“
const UserContext = createContext();

function App() {
  const [user, setUser] = useState({ name: 'John', theme: 'light' });
  
  return (
    <UserContext value={user}>
      <Profile /> {/* userå˜åŒ–æ—¶é‡æ–°æ¸²æŸ“ */}
      <Settings /> {/* userå˜åŒ–æ—¶é‡æ–°æ¸²æŸ“ */}
      <Sidebar /> {/* userå˜åŒ–æ—¶é‡æ–°æ¸²æŸ“ */}
    </UserContext>
  );
}

// è§£å†³æ–¹æ¡ˆ1ï¼šæ‹†åˆ†Context
const UserDataContext = createContext();
const ThemeContext = createContext();

function App() {
  const [userData, setUserData] = useState({ name: 'John' });
  const [theme, setTheme] = useState('light');
  
  return (
    <UserDataContext value={userData}>
      <ThemeContext value={theme}>
        <Profile /> {/* åªåœ¨userDataå˜åŒ–æ—¶æ¸²æŸ“ */}
        <Settings /> {/* åªåœ¨themeå˜åŒ–æ—¶æ¸²æŸ“ */}
      </ThemeContext>
    </UserDataContext>
  );
}

// è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨useMemoç¨³å®šå¼•ç”¨
function App() {
  const [name, setName] = useState('John');
  const [theme, setTheme] = useState('light');
  
  const value = useMemo(() => ({ name, theme }), [name, theme]);
  
  return (
    <UserContext value={value}>
      {/* åªåœ¨nameæˆ–themeçœŸæ­£å˜åŒ–æ—¶æ‰é‡æ–°æ¸²æŸ“æ¶ˆè´¹è€… */}
    </UserContext>
  );
}
```

è°ƒè¯•Contextæ€§èƒ½ï¼š
```jsx
function ContextConsumer() {
  const value = useContext(MyContext);
  
  // æ·»åŠ æ¸²æŸ“è¿½è¸ª
  useEffect(() => {
    console.log('ContextConsumer rendered with:', value);
  });
  
  return <div>{value.data}</div>;
}
```

### 8.2 Reduxè°ƒè¯•

ä½¿ç”¨Redux DevToolsï¼š
```javascript
import { configureStore } from '@reduxjs/toolkit';

const store = configureStore({
  reducer: rootReducer,
  // å¯ç”¨DevTools
  devTools: process.env.NODE_ENV !== 'production',
  // æˆ–è‡ªå®šä¹‰é…ç½®
  devTools: {
    name: 'My App',
    trace: true,
    traceLimit: 25
  }
});
```

Actionè¿½è¸ªï¼š
```javascript
// æ·»åŠ æ—¥å¿—ä¸­é—´ä»¶
const loggerMiddleware = store => next => action => {
  console.group(action.type);
  console.log('Prev State:', store.getState());
  console.log('Action:', action);
  const result = next(action);
  console.log('Next State:', store.getState());
  console.groupEnd();
  return result;
};

const store = configureStore({
  reducer: rootReducer,
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware().concat(loggerMiddleware)
});
```

### 8.3 Zustandè°ƒè¯•

Zustand devtoolsé›†æˆï¼š
```javascript
import create from 'zustand';
import { devtools } from 'zustand/middleware';

const useStore = create(
  devtools(
    (set) => ({
      count: 0,
      increment: () => set((state) => ({ count: state.count + 1 })),
      decrement: () => set((state) => ({ count: state.count - 1 }))
    }),
    { name: 'CounterStore' }
  )
);
```

çŠ¶æ€å˜åŒ–è¿½è¸ªï¼š
```javascript
const useStore = create((set) => ({
  data: {},
  updateData: (newData) => set((state) => {
    console.log('State changing:', { from: state.data, to: newData });
    return { data: newData };
  })
}));
```

---

## 9. è·¯ç”±å’Œå¯¼èˆªè°ƒè¯•

### 9.1 React Routerè°ƒè¯•

è·¯ç”±çŠ¶æ€ç›‘æ§ï¼š
```jsx
import { useLocation, useNavigate } from 'react-router-dom';

function RouteDebugger() {
  const location = useLocation();
  const navigate = useNavigate();
  
  useEffect(() => {
    console.log('Route changed:', {
      pathname: location.pathname,
      search: location.search,
      hash: location.hash,
      state: location.state
    });
  }, [location]);
  
  return null;
}

function App() {
  return (
    <BrowserRouter>
      <RouteDebugger />
      <Routes>
        {/* routes */}
      </Routes>
    </BrowserRouter>
  );
}
```

å¯¼èˆªé”™è¯¯å¤„ç†ï¼š
```jsx
function SafeNavigation() {
  const navigate = useNavigate();
  
  const handleNavigate = (path) => {
    try {
      navigate(path);
    } catch (error) {
      console.error('Navigation error:', error);
      // å›é€€åˆ°å®‰å…¨é¡µé¢
      navigate('/');
    }
  };
  
  return <button onClick={() => handleNavigate('/page')}>Go</button>;
}
```

### 9.2 Loaderé”™è¯¯è°ƒè¯•

React Router Loaderé”™è¯¯å¤„ç†ï¼š
```javascript
// loader.js
export async function productLoader({ params }) {
  try {
    const product = await fetchProduct(params.id);
    
    if (!product) {
      throw new Response('Product not found', { status: 404 });
    }
    
    return { product };
  } catch (error) {
    console.error('Loader error:', error);
    throw error; // ä¼ é€’ç»™errorElement
  }
}

// route config
{
  path: '/product/:id',
  loader: productLoader,
  element: <ProductPage />,
  errorElement: <ProductError />
}
```

---

## 10. æ ·å¼è°ƒè¯•

### 10.1 CSS-in-JSè°ƒè¯•

Styled-Componentsè°ƒè¯•ï¼š
```jsx
import styled from 'styled-components';

// æ·»åŠ displayNameä¾¿äºè°ƒè¯•
const Button = styled.button.attrs({ 
  'data-component': 'Button' 
})`
  padding: 10px 20px;
  background: ${props => props.primary ? 'blue' : 'gray'};
`;

Button.displayName = 'StyledButton';

// åœ¨DevToolsä¸­æ˜¾ç¤ºä¸º<StyledButton>è€Œä¸æ˜¯<styled.button>
```

ä¸»é¢˜è°ƒè¯•ï¼š
```jsx
import { ThemeProvider } from 'styled-components';

const theme = {
  colors: {
    primary: '#007bff',
    secondary: '#6c757d'
  }
};

// åœ¨å¼€å‘ç¯å¢ƒæ·»åŠ ä¸»é¢˜æ—¥å¿—
if (process.env.NODE_ENV === 'development') {
  console.log('Current theme:', theme);
}

function App() {
  return (
    <ThemeProvider theme={theme}>
      <Components />
    </ThemeProvider>
  );
}
```

### 10.2 Tailwind CSSè°ƒè¯•

æ£€æŸ¥ç”Ÿæˆçš„ç±»åï¼š
```jsx
function Component({ variant }) {
  const className = `btn btn-${variant}`;
  
  // å¼€å‘ç¯å¢ƒæ£€æŸ¥ç±»å
  useEffect(() => {
    if (process.env.NODE_ENV === 'development') {
      console.log('Applied classes:', className);
    }
  }, [className]);
  
  return <button className={className}>Button</button>;
}
```

---

## 11. è¡¨å•è°ƒè¯•

### 11.1 React Hook Formè°ƒè¯•

è¡¨å•çŠ¶æ€ç›‘æ§ï¼š
```jsx
import { useForm } from 'react-hook-form';
import { DevTool } from '@hookform/devtools';

function Form() {
  const { register, handleSubmit, control, formState } = useForm({
    mode: 'onChange'
  });
  
  // ç›‘æ§è¡¨å•çŠ¶æ€
  useEffect(() => {
    console.log('Form State:', {
      isValid: formState.isValid,
      errors: formState.errors,
      isDirty: formState.isDirty,
      dirtyFields: formState.dirtyFields
    });
  }, [formState]);
  
  return (
    <>
      <form onSubmit={handleSubmit(onSubmit)}>
        <input {...register('email', { required: true })} />
        <button type="submit">Submit</button>
      </form>
      
      {/* å¼€å‘ç¯å¢ƒæ˜¾ç¤ºDevTools */}
      {process.env.NODE_ENV === 'development' && (
        <DevTool control={control} />
      )}
    </>
  );
}
```

éªŒè¯é”™è¯¯è°ƒè¯•ï¼š
```jsx
function Form() {
  const { register, formState: { errors } } = useForm();
  
  // è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
  useEffect(() => {
    if (Object.keys(errors).length > 0) {
      console.error('Form validation errors:', errors);
      
      Object.entries(errors).forEach(([field, error]) => {
        console.error(`Field "${field}":`, {
          type: error.type,
          message: error.message,
          ref: error.ref
        });
      });
    }
  }, [errors]);
  
  return (
    <form>
      <input {...register('email', {
        required: 'Email is required',
        pattern: {
          value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,
          message: 'Invalid email address'
        }
      })} />
      {errors.email && <span>{errors.email.message}</span>}
    </form>
  );
}
```

### 11.2 ZodéªŒè¯è°ƒè¯•

SchemaéªŒè¯é”™è¯¯ï¼š
```typescript
import { z } from 'zod';

const userSchema = z.object({
  email: z.string().email(),
  age: z.number().min(18).max(100),
  name: z.string().min(2)
});

function validateUser(data: unknown) {
  const result = userSchema.safeParse(data);
  
  if (!result.success) {
    console.error('Validation failed:');
    result.error.issues.forEach(issue => {
      console.error(`- ${issue.path.join('.')}: ${issue.message}`);
    });
    return null;
  }
  
  return result.data;
}
```

---

## 12. æ•°æ®è·å–è°ƒè¯•

### 12.1 TanStack Queryè°ƒè¯•

React Query DevToolsï¼š
```jsx
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      // å¯ç”¨è¯¦ç»†æ—¥å¿—
      onError: (error) => {
        console.error('Query error:', error);
      },
      onSuccess: (data) => {
        console.log('Query success:', data);
      }
    }
  }
});

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <YourApp />
      {/* å¼€å‘ç¯å¢ƒæ˜¾ç¤ºDevTools */}
      <ReactQueryDevtools initialIsOpen={false} />
    </QueryClientProvider>
  );
}
```

æŸ¥è¯¢çŠ¶æ€è¿½è¸ªï¼š
```jsx
function UserProfile({ userId }) {
  const { data, isLoading, error, isError, isFetching } = useQuery({
    queryKey: ['user', userId],
    queryFn: () => fetchUser(userId)
  });
  
  // è¯¦ç»†çŠ¶æ€æ—¥å¿—
  useEffect(() => {
    console.log('Query state:', {
      isLoading,
      isFetching,
      isError,
      hasData: !!data,
      error
    });
  }, [isLoading, isFetching, isError, data, error]);
  
  if (isLoading) return <div>Loading...</div>;
  if (isError) return <div>Error: {error.message}</div>;
  
  return <div>{data.name}</div>;
}
```

### 12.2 SWRè°ƒè¯•

SWRé…ç½®å’Œæ—¥å¿—ï¼š
```jsx
import useSWR, { SWRConfig } from 'swr';

function App() {
  return (
    <SWRConfig value={{
      onError: (error, key) => {
        console.error('SWR error:', { error, key });
      },
      onSuccess: (data, key, config) => {
        console.log('SWR success:', { data, key });
      },
      onErrorRetry: (error, key, config, revalidate, { retryCount }) => {
        console.log(`Retrying ${key}, attempt ${retryCount}`);
        
        if (retryCount >= 3) return;
        setTimeout(() => revalidate({ retryCount }), 5000);
      }
    }}>
      <YourApp />
    </SWRConfig>
  );
}
```

### 12.3 Fetch/Axiosè°ƒè¯•

è¯·æ±‚æ‹¦æˆªå’Œæ—¥å¿—ï¼š
```javascript
import axios from 'axios';

// åˆ›å»ºaxioså®ä¾‹
const api = axios.create({
  baseURL: 'https://api.example.com'
});

// è¯·æ±‚æ‹¦æˆªå™¨
api.interceptors.request.use(
  config => {
    console.log('Request:', {
      method: config.method,
      url: config.url,
      params: config.params,
      data: config.data
    });
    return config;
  },
  error => {
    console.error('Request error:', error);
    return Promise.reject(error);
  }
);

// å“åº”æ‹¦æˆªå™¨
api.interceptors.response.use(
  response => {
    console.log('Response:', {
      status: response.status,
      data: response.data,
      duration: response.config.metadata?.endTime - response.config.metadata?.startTime
    });
    return response;
  },
  error => {
    console.error('Response error:', {
      message: error.message,
      status: error.response?.status,
      data: error.response?.data
    });
    return Promise.reject(error);
  }
);
```

---

## 13. åŠ¨ç”»å’Œäº¤äº’è°ƒè¯•

### 13.1 Framer Motionè°ƒè¯•

åŠ¨ç”»çŠ¶æ€è¿½è¸ªï¼š
```jsx
import { motion, useAnimation } from 'framer-motion';

function AnimatedComponent() {
  const controls = useAnimation();
  
  const handleAnimate = async () => {
    console.log('Animation starting');
    
    try {
      await controls.start({
        x: 100,
        transition: { duration: 1 }
      });
      console.log('Animation completed');
    } catch (error) {
      console.error('Animation error:', error);
    }
  };
  
  return (
    <motion.div
      animate={controls}
      onAnimationStart={() => console.log('Animation started')}
      onAnimationComplete={() => console.log('Animation completed')}
    >
      Content
    </motion.div>
  );
}
```

### 13.2 æ‹–æ‹½è°ƒè¯•

React DnDè°ƒè¯•ï¼š
```jsx
import { useDrag, useDrop } from 'react-dnd';

function DraggableItem({ id, text }) {
  const [{ isDragging }, drag] = useDrag(() => ({
    type: 'item',
    item: { id, text },
    collect: (monitor) => {
      const collected = {
        isDragging: monitor.isDragging(),
        canDrag: monitor.canDrag()
      };
      
      // è°ƒè¯•æ‹–æ‹½çŠ¶æ€
      console.log(`Item ${id} drag state:`, collected);
      
      return collected;
    }
  }));
  
  return (
    <div ref={drag} style={{ opacity: isDragging ? 0.5 : 1 }}>
      {text}
    </div>
  );
}
```

---

## 14. Next.jså’Œå…¨æ ˆæ¡†æ¶è°ƒè¯•

### 14.1 Server Componentsè°ƒè¯•

æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ—¥å¿—åˆ†ç¦»ï¼š
```jsx
// app/components/ServerComponent.tsx
async function ServerComponent() {
  console.log('[SERVER] Rendering ServerComponent');
  
  const data = await fetchData();
  console.log('[SERVER] Data fetched:', data);
  
  return <div>{data.title}</div>;
}

// app/components/ClientComponent.tsx
'use client';

function ClientComponent() {
  useEffect(() => {
    console.log('[CLIENT] ClientComponent mounted');
  }, []);
  
  return <div>Client content</div>;
}
```

### 14.2 Server Actionsè°ƒè¯•

Actionæ‰§è¡Œè¿½è¸ªï¼š
```javascript
'use server';

export async function submitForm(prevState, formData) {
  console.log('[SERVER ACTION] submitForm called');
  console.log('Form data:', Object.fromEntries(formData));
  
  try {
    const result = await saveToDatabase(formData);
    console.log('[SERVER ACTION] Success:', result);
    return { success: true, data: result };
  } catch (error) {
    console.error('[SERVER ACTION] Error:', error);
    return { success: false, error: error.message };
  }
}
```

### 14.3 SSR/SSGè°ƒè¯•

æ¸²æŸ“æ¨¡å¼è¯†åˆ«ï¼š
```jsx
function Page() {
  useEffect(() => {
    console.log('This runs on client side');
  }, []);
  
  console.log('This runs on both server and client');
  
  return (
    <div>
      <p>Rendered at: {new Date().toISOString()}</p>
      <p>Environment: {typeof window === 'undefined' ? 'Server' : 'Client'}</p>
    </div>
  );
}
```

---

## 15. æ€§èƒ½è°ƒè¯•æ·±å…¥

### 15.1 React Profiler API

è¯¦ç»†çš„æ€§èƒ½åˆ†æï¼š
```jsx
import { Profiler } from 'react';

function App() {
  const onRenderCallback = (
    id,
    phase,
    actualDuration,
    baseDuration,
    startTime,
    commitTime,
    interactions
  ) => {
    console.log('Profiler:', {
      component: id,
      phase, // "mount" or "update"
      actualDuration, // æœ¬æ¬¡æ¸²æŸ“è€—æ—¶
      baseDuration, // æ— ä¼˜åŒ–æ—¶çš„é¢„ä¼°è€—æ—¶
      startTime, // æ¸²æŸ“å¼€å§‹æ—¶é—´
      commitTime, // æäº¤æ—¶é—´
      interactions: Array.from(interactions) // å¯¼è‡´æ¸²æŸ“çš„äº¤äº’
    });
    
    // æ€§èƒ½è­¦æŠ¥
    if (actualDuration > 16) {
      console.warn(`Slow render detected: ${id} took ${actualDuration}ms`);
    }
  };
  
  return (
    <Profiler id="App" onRender={onRenderCallback}>
      <SlowComponent />
      <FastComponent />
    </Profiler>
  );
}
```

### 15.2 Chrome Performance

ä½¿ç”¨Performance APIï¼š
```jsx
function PerformanceMonitor() {
  useEffect(() => {
    // æ ‡è®°å¼€å§‹
    performance.mark('component-render-start');
    
    return () => {
      // æ ‡è®°ç»“æŸ
      performance.mark('component-render-end');
      
      // æµ‹é‡è€—æ—¶
      performance.measure(
        'component-render',
        'component-render-start',
        'component-render-end'
      );
      
      // è·å–æµ‹é‡ç»“æœ
      const measure = performance.getEntriesByName('component-render')[0];
      console.log(`Component render took: ${measure.duration}ms`);
      
      // æ¸…ç†
      performance.clearMarks();
      performance.clearMeasures();
    };
  });
  
  return <div>Monitored Component</div>;
}
```

Web Vitalsç›‘æ§ï¼š
```jsx
import { onCLS, onFID, onLCP, onFCP, onTTFB } from 'web-vitals';

function setupWebVitals() {
  onCLS(metric => {
    console.log('CLS:', metric.value, metric.rating);
    if (metric.value > 0.1) {
      console.warn('Poor CLS detected');
    }
  });
  
  onFID(metric => {
    console.log('FID:', metric.value, metric.rating);
  });
  
  onLCP(metric => {
    console.log('LCP:', metric.value, metric.rating);
    if (metric.value > 2500) {
      console.warn('Poor LCP detected');
    }
  });
  
  onFCP(metric => {
    console.log('FCP:', metric.value);
  });
  
  onTTFB(metric => {
    console.log('TTFB:', metric.value);
  });
}

// åœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨
setupWebVitals();
```

---

## 16. æ„å»ºå’Œå·¥ç¨‹åŒ–è°ƒè¯•

### 16.1 Viteè°ƒè¯•

Viteé…ç½®è°ƒè¯•ï¼š
```javascript
// vite.config.js
import { defineConfig } from 'vite';

export default defineConfig({
  // å¯ç”¨è¯¦ç»†æ—¥å¿—
  logLevel: 'info',
  
  // è‡ªå®šä¹‰æ—¥å¿—
  plugins: [{
    name: 'debug-plugin',
    configResolved(config) {
      console.log('Vite config:', config);
    },
    buildStart() {
      console.log('Build starting...');
    },
    buildEnd() {
      console.log('Build completed');
    }
  }],
  
  // æ„å»ºåˆ†æ
  build: {
    rollupOptions: {
      output: {
        manualChunks(id) {
          console.log('Processing:', id);
          
          if (id.includes('node_modules')) {
            return 'vendor';
          }
        }
      }
    }
  }
});
```

### 16.2 Bundleåˆ†æ

åˆ†æåŒ…å¤§å°ï¼š
```bash
# å®‰è£…åˆ†æå·¥å…·
npm install --save-dev rollup-plugin-visualizer

# vite.config.js
import { visualizer } from 'rollup-plugin-visualizer';

export default defineConfig({
  plugins: [
    visualizer({
      open: true,
      gzipSize: true,
      brotliSize: true
    })
  ]
});
```

---

## 17. å®‰å…¨é—®é¢˜è°ƒè¯•

### 17.1 XSSæ£€æµ‹

æ£€æµ‹æ½œåœ¨çš„XSSé£é™©ï¼š
```jsx
// å®‰å…¨çš„HTMLæ¸²æŸ“æ£€æŸ¥
function SafeComponent({ userInput }) {
  // æ£€æµ‹å±é™©æ¨¡å¼
  useEffect(() => {
    if (/<script|javascript:|onerror=/i.test(userInput)) {
      console.error('Potential XSS detected in input:', userInput);
    }
  }, [userInput]);
  
  // ä½¿ç”¨DOMPurifyæ¸…ç†
  const cleanHTML = DOMPurify.sanitize(userInput);
  
  return <div dangerouslySetInnerHTML={{ __html: cleanHTML }} />;
}
```

### 17.2 CSRFé˜²æŠ¤æ£€æŸ¥

éªŒè¯CSRF tokenï¼š
```javascript
async function fetchWithCSRF(url, options = {}) {
  const token = document.querySelector('meta[name="csrf-token"]')?.content;
  
  if (!token) {
    console.error('CSRF token not found');
    throw new Error('CSRF token missing');
  }
  
  console.log('Making request with CSRF token');
  
  return fetch(url, {
    ...options,
    headers: {
      ...options.headers,
      'X-CSRF-Token': token
    }
  });
}
```

---

## 18. SEOè°ƒè¯•

### 18.1 Metaæ ‡ç­¾æ£€æŸ¥

éªŒè¯SEOå…ƒæ•°æ®ï¼š
```jsx
import { Helmet } from 'react-helmet-async';

function Page({ data }) {
  useEffect(() => {
    // æ£€æŸ¥metaæ ‡ç­¾
    const title = document.querySelector('title')?.textContent;
    const description = document.querySelector('meta[name="description"]')?.content;
    const ogImage = document.querySelector('meta[property="og:image"]')?.content;
    
    console.log('SEO Meta Tags:', {
      title,
      description,
      ogImage
    });
    
    // éªŒè¯å¿…éœ€æ ‡ç­¾
    if (!title) console.warn('Missing title tag');
    if (!description) console.warn('Missing description meta tag');
    if (!ogImage) console.warn('Missing Open Graph image');
  }, []);
  
  return (
    <Helmet>
      <title>{data.title}</title>
      <meta name="description" content={data.description} />
      <meta property="og:image" content={data.image} />
    </Helmet>
  );
}
```

### 18.2 ç»“æ„åŒ–æ•°æ®éªŒè¯

Schema.orgæ•°æ®æ£€æŸ¥ï¼š
```jsx
function ProductPage({ product }) {
  const structuredData = {
    "@context": "https://schema.org",
    "@type": "Product",
    "name": product.name,
    "description": product.description,
    "offers": {
      "@type": "Offer",
      "price": product.price,
      "priceCurrency": "USD"
    }
  };
  
  // éªŒè¯JSON-LD
  useEffect(() => {
    console.log('Structured Data:', JSON.stringify(structuredData, null, 2));
    
    // å¯ä»¥ä½¿ç”¨åœ¨çº¿å·¥å…·éªŒè¯ï¼š
    // https://search.google.com/test/rich-results
  }, [product]);
  
  return (
    <>
      <script type="application/ld+json">
        {JSON.stringify(structuredData)}
      </script>
      <div>{product.name}</div>
    </>
  );
}
```

---

## 19. å›½é™…åŒ–è°ƒè¯•

### 19.1 i18nç¿»è¯‘æ£€æŸ¥

æ£€æµ‹ç¼ºå¤±çš„ç¿»è¯‘ï¼š
```jsx
import { useTranslation } from 'react-i18next';

function Component() {
  const { t, i18n } = useTranslation();
  
  // æ£€æµ‹ç¼ºå¤±ç¿»è¯‘
  const checkTranslation = (key) => {
    const translation = t(key);
    
    if (translation === key) {
      console.warn(`Missing translation for key: ${key} in language: ${i18n.language}`);
    }
    
    return translation;
  };
  
  return (
    <div>
      <h1>{checkTranslation('welcome.title')}</h1>
      <p>{checkTranslation('welcome.description')}</p>
    </div>
  );
}
```

è¯­è¨€åˆ‡æ¢è°ƒè¯•ï¼š
```jsx
function LanguageSwitcher() {
  const { i18n } = useTranslation();
  
  const changeLanguage = async (lng) => {
    console.log(`Changing language from ${i18n.language} to ${lng}`);
    
    try {
      await i18n.changeLanguage(lng);
      console.log('Language changed successfully');
    } catch (error) {
      console.error('Failed to change language:', error);
    }
  };
  
  return (
    <select onChange={e => changeLanguage(e.target.value)}>
      <option value="en">English</option>
      <option value="zh">ä¸­æ–‡</option>
    </select>
  );
}
```

---

## 20. ç§»åŠ¨ç«¯å’Œå“åº”å¼è°ƒè¯•

### 20.1 å“åº”å¼æ–­ç‚¹è°ƒè¯•

ç›‘æ§å±å¹•å°ºå¯¸å˜åŒ–ï¼š
```jsx
function useBreakpoint() {
  const [breakpoint, setBreakpoint] = useState('desktop');
  
  useEffect(() => {
    const checkBreakpoint = () => {
      const width = window.innerWidth;
      
      let newBreakpoint;
      if (width < 640) newBreakpoint = 'mobile';
      else if (width < 1024) newBreakpoint = 'tablet';
      else newBreakpoint = 'desktop';
      
      if (newBreakpoint !== breakpoint) {
        console.log(`Breakpoint changed: ${breakpoint} â†’ ${newBreakpoint}`);
        setBreakpoint(newBreakpoint);
      }
    };
    
    checkBreakpoint();
    window.addEventListener('resize', checkBreakpoint);
    
    return () => window.removeEventListener('resize', checkBreakpoint);
  }, [breakpoint]);
  
  return breakpoint;
}
```

### 20.2 PWAè°ƒè¯•

Service Workerè°ƒè¯•ï¼š
```javascript
// service-worker.js
self.addEventListener('install', (event) => {
  console.log('[SW] Installing...');
  
  event.waitUntil(
    caches.open('v1').then(cache => {
      console.log('[SW] Caching files');
      return cache.addAll(['/index.html', '/app.js', '/styles.css']);
    })
  );
});

self.addEventListener('fetch', (event) => {
  console.log('[SW] Fetching:', event.request.url);
  
  event.respondWith(
    caches.match(event.request).then(response => {
      if (response) {
        console.log('[SW] Serving from cache:', event.request.url);
        return response;
      }
      
      console.log('[SW] Fetching from network:', event.request.url);
      return fetch(event.request);
    })
  );
});
```

---

## 21. Monorepoå’Œæ„å»ºè°ƒè¯•

### 21.1 Turborepoè°ƒè¯•

ä»»åŠ¡æ‰§è¡Œæ—¥å¿—ï¼š
```json
{
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**"],
      "cache": true
    },
    "dev": {
      "cache": false,
      "persistent": true
    }
  },
  "globalEnv": ["NODE_ENV"],
  "ui": "stream"
}
```

è¿è¡Œå‘½ä»¤ï¼š
```bash
# è¯¦ç»†æ—¥å¿—
turbo run build --verbosity=3

# è·Ÿè¸ªä»»åŠ¡ä¾èµ–
turbo run build --graph=graph.html

# å¼ºåˆ¶é‡æ–°æ„å»º
turbo run build --force
```

### 21.2 ä¾èµ–é—®é¢˜è°ƒè¯•

æ£€æŸ¥ä¾èµ–å†²çªï¼š
```bash
# npm
npm list react

# pnpm
pnpm why react

# yarn
yarn why react

# æ£€æŸ¥é‡å¤ä¾èµ–
npx npm-check-duplicates
```

---

## 22. CI/CDè°ƒè¯•

### 22.1 GitHub Actionsè°ƒè¯•

å·¥ä½œæµæ—¥å¿—ï¼š
```yaml
name: CI

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Debug Info
        run: |
          echo "Node version: $(node --version)"
          echo "npm version: $(npm --version)"
          echo "Working directory: $(pwd)"
          echo "Files: $(ls -la)"
      
      - name: Install Dependencies
        run: |
          npm ci
          echo "Dependencies installed"
          
      - name: Build
        run: |
          echo "Starting build..."
          npm run build
          echo "Build artifacts:"
          ls -la dist/
      
      - name: Upload logs
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: build-logs
          path: |
            npm-debug.log
            build-errors.log
```

---

## 23. é”™è¯¯ç›‘æ§å’Œä¸ŠæŠ¥

### 23.1 Sentryé›†æˆ

å®Œæ•´çš„é”™è¯¯ç›‘æ§ï¼š
```jsx
import * as Sentry from '@sentry/react';

Sentry.init({
  dsn: process.env.REACT_APP_SENTRY_DSN,
  environment: process.env.NODE_ENV,
  
  // æ€§èƒ½ç›‘æ§
  tracesSampleRate: 1.0,
  
  // é”™è¯¯è¿‡æ»¤
  beforeSend(event, hint) {
    console.log('Sending error to Sentry:', event);
    
    // è¿‡æ»¤æ‰æŸäº›é”™è¯¯
    if (event.exception?.values?.[0]?.value?.includes('Network error')) {
      return null; // ä¸å‘é€
    }
    
    return event;
  },
  
  // æ·»åŠ é¢å¤–ä¸Šä¸‹æ–‡
  beforeBreadcrumb(breadcrumb) {
    console.log('Adding breadcrumb:', breadcrumb);
    return breadcrumb;
  }
});

// ä½¿ç”¨ErrorBoundary
function App() {
  return (
    <Sentry.ErrorBoundary fallback={<ErrorFallback />}>
      <YourApp />
    </Sentry.ErrorBoundary>
  );
}
```

æ‰‹åŠ¨é”™è¯¯ä¸ŠæŠ¥ï¼š
```jsx
function Component() {
  const handleError = (error) => {
    console.error('Error occurred:', error);
    
    // ä¸ŠæŠ¥åˆ°Sentry
    Sentry.captureException(error, {
      tags: {
        component: 'MyComponent',
        action: 'handleSubmit'
      },
      contexts: {
        data: {
          userId: user.id,
          timestamp: Date.now()
        }
      }
    });
  };
  
  try {
    // æ“ä½œ
  } catch (error) {
    handleError(error);
  }
}
```

### 23.2 è‡ªå®šä¹‰é”™è¯¯è¿½è¸ª

æ„å»ºé”™è¯¯æ”¶é›†ç³»ç»Ÿï¼š
```javascript
class ErrorTracker {
  constructor() {
    this.errors = [];
    this.maxErrors = 100;
  }
  
  track(error, context = {}) {
    const errorInfo = {
      message: error.message,
      stack: error.stack,
      context,
      timestamp: new Date().toISOString(),
      url: window.location.href,
      userAgent: navigator.userAgent
    };
    
    this.errors.push(errorInfo);
    
    if (this.errors.length > this.maxErrors) {
      this.errors.shift();
    }
    
    console.error('Error tracked:', errorInfo);
    
    // å®šæœŸä¸ŠæŠ¥
    if (this.errors.length % 10 === 0) {
      this.flush();
    }
  }
  
  flush() {
    if (this.errors.length === 0) return;
    
    console.log(`Flushing ${this.errors.length} errors`);
    
    fetch('/api/errors', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ errors: this.errors })
    }).then(() => {
      console.log('Errors reported successfully');
      this.errors = [];
    }).catch(err => {
      console.error('Failed to report errors:', err);
    });
  }
}

const errorTracker = new ErrorTracker();

// å…¨å±€é”™è¯¯å¤„ç†
window.addEventListener('error', (event) => {
  errorTracker.track(event.error, {
    type: 'global-error',
    filename: event.filename,
    lineno: event.lineno,
    colno: event.colno
  });
});

// Promise rejectionå¤„ç†
window.addEventListener('unhandledrejection', (event) => {
  errorTracker.track(new Error(event.reason), {
    type: 'unhandled-rejection'
  });
});
```

---

## 24. è°ƒè¯•æœ€ä½³å®è·µæ€»ç»“

### 24.1 è°ƒè¯•æ¸…å•

å¼€å‘ç¯å¢ƒè°ƒè¯•æ¸…å•ï¼š
```
1. æµè§ˆå™¨DevTools
   - Consoleæ—¥å¿—åˆ†æ
   - Networkè¯·æ±‚ç›‘æ§
   - Performanceæ€§èƒ½åˆ†æ
   - React DevToolsç»„ä»¶æ£€æŸ¥

2. ESLintæ£€æŸ¥
   - è¿è¡Œeslintæ£€æŸ¥
   - ä¿®å¤æ‰€æœ‰error
   - è¯„ä¼°warning

3. TypeScriptæ£€æŸ¥
   - è¿è¡Œtsc --noEmit
   - ä¿®å¤ç±»å‹é”™è¯¯
   - å®Œå–„ç±»å‹å®šä¹‰

4. æµ‹è¯•è¿è¡Œ
   - å•å…ƒæµ‹è¯•
   - é›†æˆæµ‹è¯•
   - E2Eæµ‹è¯•

5. æ€§èƒ½æ£€æŸ¥
   - Lighthouseè¯„åˆ†
   - Web VitalsæŒ‡æ ‡
   - Bundleå¤§å°åˆ†æ

6. å®‰å…¨æ£€æŸ¥
   - XSSé£é™©æ‰«æ
   - ä¾èµ–æ¼æ´æ£€æŸ¥ï¼ˆnpm auditï¼‰
   - HTTPSé…ç½®éªŒè¯
```

### 24.2 ç”Ÿäº§ç¯å¢ƒç›‘æ§æ¸…å•

```
1. é”™è¯¯ç›‘æ§
   - Sentryé”™è¯¯è¿½è¸ª
   - è‡ªå®šä¹‰é”™è¯¯æ—¥å¿—
   - é”™è¯¯ç‡ç›‘æ§

2. æ€§èƒ½ç›‘æ§
   - Real User Monitoringï¼ˆRUMï¼‰
   - Core Web Vitals
   - APIå“åº”æ—¶é—´

3. ç”¨æˆ·è¡Œä¸ºç›‘æ§
   - Google Analytics
   - è‡ªå®šä¹‰åŸ‹ç‚¹
   - è½¬åŒ–ç‡è¿½è¸ª

4. åŸºç¡€è®¾æ–½ç›‘æ§
   - æœåŠ¡å™¨å¥åº·æ£€æŸ¥
   - CDNçŠ¶æ€ç›‘æ§
   - æ•°æ®åº“æ€§èƒ½

5. å‘Šè­¦æœºåˆ¶
   - é”™è¯¯ç‡é˜ˆå€¼å‘Šè­¦
   - æ€§èƒ½ä¸‹é™å‘Šè­¦
   - æµé‡å¼‚å¸¸å‘Šè­¦
```

### 24.3 è°ƒè¯•å·¥å…·æ¨è

```
æµè§ˆå™¨å·¥å…·ï¼š
- React Developer Tools
- Redux DevTools
- React Query DevTools
- Apollo Client DevTools

VS Codeæ’ä»¶ï¼š
- ES7+ React/Redux/React-Native snippets
- ESLint
- Prettier
- Error Lens

å‘½ä»¤è¡Œå·¥å…·ï¼š
- why-did-you-renderï¼ˆæ£€æµ‹ä¸å¿…è¦çš„æ¸²æŸ“ï¼‰
- source-map-explorerï¼ˆåˆ†æbundleï¼‰
- lighthouse-ciï¼ˆè‡ªåŠ¨åŒ–æ€§èƒ½æ£€æŸ¥ï¼‰

åœ¨çº¿å·¥å…·ï¼š
- React DevTools Profiler
- Chrome Performance
- Lighthouse
- WebPageTest
```

---

## 25. å¸¸è§é—®é¢˜å¿«é€Ÿå®šä½

### 25.1 é—®é¢˜åˆ†ç±»å’Œå®šä½æµç¨‹

```
ç»„ä»¶ä¸æ¸²æŸ“/ä¸æ›´æ–°ï¼š
1. æ£€æŸ¥stateæ˜¯å¦çœŸçš„å˜åŒ–äº†ï¼ˆå¼•ç”¨ç›¸ç­‰ï¼Ÿï¼‰
2. æ£€æŸ¥æ˜¯å¦ç›´æ¥ä¿®æ”¹äº†state
3. æ£€æŸ¥keyå±æ€§æ˜¯å¦æ­£ç¡®
4. æ£€æŸ¥ç»„ä»¶æ˜¯å¦è¢«memoåŒ…è£¹

Effectä¸æ‰§è¡Œ/é‡å¤æ‰§è¡Œï¼š
5. æ£€æŸ¥ä¾èµ–æ•°ç»„æ˜¯å¦æ­£ç¡®
6. æ£€æŸ¥æ˜¯å¦æœ‰é—­åŒ…é™·é˜±
7. æ£€æŸ¥cleanupå‡½æ•°æ˜¯å¦æ­£ç¡®
8. æ£€æŸ¥StrictModeåŒé‡è°ƒç”¨

æ€§èƒ½é—®é¢˜ï¼š
9. ä½¿ç”¨React Profileråˆ†æ
10. æ£€æŸ¥æ˜¯å¦æœ‰ä¸å¿…è¦çš„æ¸²æŸ“
11. æ£€æŸ¥bundleå¤§å°
12. ä½¿ç”¨Lighthouseåˆ†æ

æ•°æ®è·å–é—®é¢˜ï¼š
13. æ£€æŸ¥ç½‘ç»œè¯·æ±‚ï¼ˆNetwork tabï¼‰
14. æ£€æŸ¥CORSé…ç½®
15. æ£€æŸ¥è®¤è¯token
16. æ£€æŸ¥é”™è¯¯å¤„ç†

æ ·å¼é—®é¢˜ï¼š
17. æ£€æŸ¥CSS specificity
18. æ£€æŸ¥æ ·å¼åŠ è½½é¡ºåº
19. ä½¿ç”¨Computed tabæŸ¥çœ‹æœ€ç»ˆæ ·å¼
20. æ£€æŸ¥CSS-in-JSç”Ÿæˆ
```

### 25.2 å¿«é€Ÿä¿®å¤æ¨¡å¼

```jsx
// å¿«é€Ÿè°ƒè¯•ç»„ä»¶
function QuickDebug({ children, label = 'Component' }) {
  const renderCount = useRef(0);
  renderCount.current++;
  
  useEffect(() => {
    console.log(`[${label}] Mounted`);
    return () => console.log(`[${label}] Unmounted`);
  }, []);
  
  useEffect(() => {
    console.log(`[${label}] Rendered ${renderCount.current} times`);
  });
  
  return <>{children}</>;
}

// ä½¿ç”¨
<QuickDebug label="UserProfile">
  <UserProfile />
</QuickDebug>
```

---

## æ€»ç»“

ä¼˜ç§€çš„Reactå¼€å‘è€…å¿…å¤‡æŠ€èƒ½ï¼š

1. é”™è¯¯è¯†åˆ«èƒ½åŠ›
   - å¿«é€Ÿå®šä½é—®é¢˜æ ¹æº
   - ç†è§£é”™è¯¯ä¿¡æ¯
   - ä½¿ç”¨è°ƒè¯•å·¥å…·

2. è°ƒè¯•æŠ€å·§
   - Consoleæ—¥å¿—ç­–ç•¥
   - DevToolsç†Ÿç»ƒä½¿ç”¨
   - æ–­ç‚¹è°ƒè¯•
   - æ€§èƒ½åˆ†æ

3. é¢„é˜²æªæ–½
   - ä»£ç è§„èŒƒ
   - TypeScriptç±»å‹æ£€æŸ¥
   - ESLinté™æ€åˆ†æ
   - å®Œå–„çš„æµ‹è¯•

4. å·¥å…·ä½¿ç”¨
   - React DevTools
   - Redux DevTools
   - æ€§èƒ½åˆ†æå·¥å…·
   - é”™è¯¯ç›‘æ§ç³»ç»Ÿ

5. æœ€ä½³å®è·µ
   - éµå¾ªReactå®˜æ–¹æŒ‡å—
   - å­¦ä¹ ç¤¾åŒºç»éªŒ
   - æŒç»­æ”¹è¿›ä»£ç 
   - å»ºç«‹å›¢é˜Ÿè§„èŒƒ

React 19å¸¦æ¥çš„è°ƒè¯•æ”¹è¿›è®©é—®é¢˜å®šä½æ›´å¿«ã€é”™è¯¯æç¤ºæ›´æ¸…æ™°ã€å¼€å‘ä½“éªŒæ›´å¥½ã€‚æŒæ¡è¿™äº›è°ƒè¯•æŠ€å·§å’Œæœ€ä½³å®è·µï¼Œå°†å¤§å¹…æå‡ä½ çš„å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ï¼

è®°ä½ï¼šè°ƒè¯•ä¸ä»…æ˜¯ä¿®å¤bugï¼Œæ›´æ˜¯æ·±å…¥ç†è§£Reactã€æå‡æŠ€æœ¯èƒ½åŠ›çš„è¿‡ç¨‹ï¼ğŸ’ª